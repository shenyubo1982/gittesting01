_.Module.define({path:"pcommon/component/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="ui_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,void(t._option.card_leave_hide?t.hideCard():t.closeCard()))}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"ppb/widget/postList/FeedBack",sub:{initial:function(){this.autoResponseHelp(),this.autoResponseForNotLouzhu(),this.autoResponseClickEvt()},autoResponseForNotLouzhu:function(){0!=$(".not-louzhu-response").length&&$(".not-louzhu-response").each(function(e,l){var p=$(l).data("replyHelp"),t="",a={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$(l),closeBtn:!1,level:1,arrowReq:!0};1==p?t='<div class="reply-help-tips">\u697C\u4E3B\u6682\u672A\u5BF9\u6B64\u7B54\u590D\u8FDB\u884C\u8BC4\u4EF7\u54E6~</div>':2==p?t='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u6709\u5E2E\u52A9\u201D\u54E6~</div>':p>2&&(t='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u65E0\u5E2E\u52A9\u201D\u54E6~\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>',a.bubble_css.width=345),a.content=t;var i=new UiBubbleTipBase(a);i.showBubble()})},autoResponseHelp:function(){if(0!=$("#plReplyHelpBubble").length){var e={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("#plReplyHelpBubble"),closeBtn:!1,level:1,arrowReq:!0},l=$("#plReplyHelpBubble").data("replyHelp");1==l?e.content='<div class="reply-help-tips">\u4EB2\uFF0C\u4EE5\u4E0A\u5185\u5BB9\u662F\u5426\u89E3\u51B3\u4E86\u60A8\u7684\u95EE\u9898\u5462\uFF1F</div><div class="reply-help-tips"><label>\u662F<input type="radio" name="p-is-helpable" value="2"/></label><label>\u5426<input type="radio" name="p-is-helpable" value="0"/></label></div><ul class="p-not-helpable"><li><label><input type="radio" value="4" name="why-nothelp"/>\u592A\u7B80\u5355\u7528\u4E0D\u4E0A</li></label><li><label><input type="radio" value="8" name="why-nothelp"/>\u5B57\u592A\u591A\u4E0D\u60F3\u770B</li></label><li><label><input type="radio" value="16" name="why-nothelp"/>\u592A\u590D\u6742\u770B\u4E0D\u61C2</li></label><li><label><input type="radio" value="32" name="why-nothelp"/>\u641C\u7D22\u5230\u7684\u5185\u5BB9\u4E0D\u5339\u914D</li></label></ul>':l>1&&(e.content='<div class="reply-help-tips">\u611F\u8C22\u60A8\u7684\u53CD\u9988\uFF0C\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>');var p=new UiBubbleTipBase(e);p.showBubble(),this.autoResponseClickEvt()}},autoResponseClickEvt:function(){var e=this;$("#plReplyHelpBubble").on("click",".reply-help-tips input",function(){var l=$(this).val(),p={};2==l?($("#plReplyHelpBubble .p-not-helpable").hide(),p={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:l},e.autoResponsePost(p)):$("#plReplyHelpBubble .p-not-helpable").show()}).on("click",".p-not-helpable li input",function(){var l={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:$(this).val()};e.autoResponsePost(l)})},autoResponsePost:function(e){var l=this;$.post("/hermes/commit/help",e,function(e){e.errno||($("#plReplyHelpBubble").html("").data("replyHelp",2),l.autoResponseHelp())},"json")}}});
;_.Module.define({path:"ppb/widget/postList/PostPic",sub:{initial:function(){"album_pb"!=PageData.pageType&&this._bindOpenImg()},_isAlbumImg:function(t){var e=/^http:\/\/[^\/\?]*?\.baidu\.com[:8082]*\/(\w+)\/([^\/\?]+)\/([^\/\?]+)\/(\w+?)\.(?:webp|jpg|jpeg)/;return e.test(t)},_bindOpenImg:function(){for(var t,e,a,s,i=this,p=$("#j_p_postlist").find(".BDE_Image"),n=$.browser.msie&&$.browser.version<=7,r=0,d=p.length;d>r;r++){var c=p[r];if(c&&(t=$(c),a=t.height(),s=t.width(),"true"!==t.attr("ad-dom-img")&&i._isAlbumImg(c.src)&&a>=80&&s>=80&&a*s>=1e4&&(t.click(function(t){var a=t.target||t.srcElement,s=1,i=$(a).tbattr("src"),p=$(a).closest(".l_post");if(p){postData=p.getData(),postData.author.user_name!=PageData.thread.author&&(s=0),e=i.substring(i.lastIndexOf("/")+1,i.lastIndexOf("."));var n=$(a).closest(".j_d_post_content").find("#j_pb_repost"),r="";if(0==n.length)r="http://tieba.baidu.com/photo/p?kw="+PageData.forum.name_url+"&flux=1&tid="+PageData.thread.thread_id+"&pic_id="+e+"&pn=1&fp=2&see_lz="+s;else{var d=n.getData();r="http://tieba.baidu.com/photo/p?kw="+d.fname+"&flux=1&tid="+d.tid+"&pic_id="+e+"&pn=1&fp=2&see_lz="+s}window.open(r,"_blank")}}),n?$(c).css("cursor","pointer").tbattr("title","\u70B9\u51FB\u8FDB\u5165\u8FDE\u7EED\u770B\u56FE\u6A21\u5F0F"):$(c).css("cursor","url('http://tb2.bdstatic.com/tb/static-pb/img/cur_zin.cur'),pointer")),a>999)){var o=$(document.createElement("div")),l=$(document.createElement("div"));html=s>160?'<em class="expand"></em><span class="txt">\u70B9\u51FB\u5C55\u5F00\uFF0C\u67E5\u770B\u5B8C\u6574\u56FE\u7247</span>':'<em class="expand"></em><span class="txt-empty"></span>',l.html(html),o.addClass("replace_div").css("width",s),l.addClass("replace_tip").css("width",s-2);var m=t.clone(!0);o.append(m),o.append(l),t.replaceWith(o)}}}}});
;_.Module.define({path:"ppb/widget/postList/HidePost",sub:{initial:function(){1==PageData.forum.shield_post&&this._bindEvent()},_bindEvent:function(){var e,t,a,s,i=$('<div class="user-hide-post-down"></div>'),o=$('<div class="user-hide-post-action"><a href="javascript:void(0)" class="hide-author"></a></div>'),n=!1,d=!1,r={110000:"\u4F60\u8FD8\u6CA1\u6709\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55\u3002",210009:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002",210004:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002","000000":"\u64CD\u4F5C\u6210\u529F\u3002"},l=function(l){var p={},u=d?void 0:s.content.post_no;1==u?"hide-post"==l?(p.type=2,p.fname=PageData.forum.forum_name,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t):"hide-post"==l?(p.type=3,p.pid=d?s.spid:s.content.post_id,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t),p.ie="utf-8",$.ajax({url:"/tphide/add",data:p,type:"post",dataType:"json",success:function(s){if(0==s.no)if(n=!1,1==u)$.tb.location.setHref("/f?kw="+PageData.forum.forum_name);else if("hide-post"==l)if(a.close(),i.hide(),o.hide(),$("body").append(i).append(o),d===!1)e.parents("div.l_post").remove();else{var p=e.parent().find("li.lzl_single_post");if(p.length<2){e.parents("div.j_lzl_container").hide().find("li.lzl_li_pager").remove();var h=e.parents("div.j_lzl_wrapper");h.find("a.lzl_link_unfold").show().text("\u56DE\u590D"),h.find("span.lzl_link_fold").hide()}e.remove()}else t==PageData.thread.author?$.tb.location.setHref("/f?kw="+PageData.forum.forum_name):$.tb.location.reload();else{a.close();var c=new $.dialog({html:'<div class="user-hide-post-tip">'+(r[s.no]||"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002")+"</div>",title:"\u63D0\u793A",width:400,closeable:!0,draggable:!1,show:!0});setTimeout(function(){c.close(),n=!1},4500)}}})};$("#pb_content").delegate(".user-hide-post-action","click",function(e){var i,o=$(e.target).tbattr("class"),r=d?void 0:s.content.post_no;if("hide-post"==o)i=1==r?"\u9690\u85CF1\u697C\u8D34\u5B50\uFF0C\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u4E2A\u8D34\u5B50\u5417\uFF1F":"\u64CD\u4F5C\u4E4B\u540E\uFF0C\u5C06\u65E0\u6CD5\u6062\u590D\u8FD9\u6761\u8D34\u5B50\u7684\u9690\u85CF\u72B6\u6001<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u6761\u8D34\u5B50\u5417\uFF1F";else{if("hide-author"!=o)return;i=t==PageData.thread.author?'\u9690\u85CF\u7684\u7528\u6237\u4E3A\u672C\u8D34\u7684\u697C\u4E3B\uFF0C\u64CD\u4F5C\u4E4B\u540E\uFF1A\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF\uFF0C\u4E14<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F":'\u64CD\u4F5C\u4E4B\u540E\uFF0C<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F"}i+='<div class="user-hide-post-confirm"><button class="confirm">\u786E\u8BA4</button>&nbsp;&nbsp;<button class="cancel">\u53D6\u6D88</button></div>',a=new $.dialog({html:'<div class="user-hide-post-tip">'+i+"</div>",title:"\u63D0\u793A",width:400,closeable:!1,draggable:!1,show:!0}),$("div.user-hide-post-confirm").click(function(e){var t=$(e.target).tbattr("class");"cancel"==t?a.close():"confirm"==t&&n===!1&&(n=!0,l(o))})}).delegate(".user-hide-post-down","click",function(){var a,i=$(this);i.tbattr("class","user-hide-post-up"),o.css({top:parseInt(i.css("top"))+15,right:parseInt(i.css("right"))+2}).appendTo(e),d===!1?(s=e.parents("div.l_post").getData(),t=s.author.user_name):(s=e.getData(),t=s.user_name),a="\u5BF9\u6211\u9690\u85CF\u8BE5\u7528\u6237\u7684\u6240\u6709\u8D34\u5B503\u5929",o.show().find("a.hide-author").html(a)}).delegate(".user-hide-post-up","click",function(){var e=$(this);e.tbattr("class","user-hide-post-down"),o.hide()}).delegate(".p_content","mouseenter",function(){var t=$(this).parents("div.l_post"),a=t.getData();return""==PageData.user.user_name||PageData.user.user_name==(a&&a.author&&a.author.user_name)?!1:(e=$(this),d=!1,window.postDown=$(this).find(".user-hide-post-down"),void window.postDown.show())}).delegate(".p_content","mouseleave",function(){var e=window.postDown;return"undefined"==typeof e?!1:(e.hasClass("user-hide-post-up")&&e.tbattr("class","user-hide-post-down"),e.hide(),void $(this).find(".user-hide-post-action").hide())}).find("li.lzl_single_post").live("mouseenter","li.lzl_single_post",function(){e=$(this);var t=e.getData();if(""==PageData.user.user_name||PageData.user.user_name==t.user_name)return!1;i.appendTo(e);var a={};PageData.is_posts_admin||PageData.is_thread_admin?(a=e.find(".j_lzl_o_l").position(),i.css({top:a.top,right:536-a.left}).show()):(a=e.find(".lzl_time").position(),i.css({top:a.top,right:536-a.left+50}).show()),d=!0}).live("mouseleave","li.lzl_single_post",function(){i.hasClass("user-hide-post-up")&&i.tbattr("class","user-hide-post-down"),i.hide(),o.hide()}),window.global=window.global||{},window.global.shieldPost=function(){$("body").append(i).append(o)}}}});
;_.Module.define({path:"ppb/widget/postList/PrintFlower",sub:{initial:function(){this._bindEvent()},_bindEvent:function(){var t=this;$("#j_p_postlist").delegate(".j_print_reward","click",function(){var a=$(this),s=a.tbattr("data-pid"),e=a.tbattr("data-uid");t._introducePrintDialog(s,e)}).delegate(".j_click_flower","click",function(){$.stats.track("stamp_flower_show","fudai","frs/pb","click")}).delegate(".j_award_flower","mouseover",function(){$(this).parent().next(".what_flower").css("display","block")}).delegate(".j_award_flower","mouseout",function(){$(this).parent().next(".what_flower").css("display","none")}).delegate(".what_flower","mouseover",function(){$(this).css("display","block")}).delegate(".what_flower","mouseout",function(){$(this).parent().next(".what_flower").css("display","none")})},_introducePrintDialog:function(t,a){var s=this,e='<p class="stamp_title">\u8BF7\u9009\u62E9\u4F60\u8981\u5956\u52B1\u7684\u5370\u82B1\u6570</p>',i='<input type="radio" name="stamp_num" value="5" checked="checked" /><span class="stamp_number">+5</span>',n='<input type="radio" name="stamp_num" value="10"/><span class="stamp_number">+10</span>',p='<input type="radio" name="stamp_num" value="50"/><span class="stamp_number">+50</span>',o='<input type="radio" name="stamp_num" value="1" /><input type="text" class="stamp_number stamp_input"><span class="stamp_error">\u8BF7\u8F93\u5165\u5370\u82B1\u6570</span>',r=i+n+p+o,l='<div class="stamp_button"><a href="#" class="ui_btn ui_btn_m j_notice_ok"><span><em>\u786E\u5B9A</em></span></a><a href="#" class="ui_btn_disable ui_btn_m_disable print_flower_cancel j_notice_no"><span><em>\u53D6\u6D88</em></span></a><p class="stamp_error_tip">\u60A8\u5DF2\u7ECF\u5956\u52B1\u8FC7\u5566\uFF0C\u8BF7\u52FF\u91CD\u590D\u5956\u52B1</p><p class="stamp_error_tip_limit">\u5956\u52B1\u5DF2\u7ECF\u8FBE\u5230\u6BCF\u5929\u4E0A\u9650~</p></div>',_='<div class="stamp_wrapper">'+e+'<div class="stamp_select">'+r+"</div>"+l+"</div>",c=$.dialog.open(_,{title:"\u5370\u82B1\u5956\u52B1",width:428});$(".j_notice_ok").click(function(e){e.preventDefault(),s._stampAjax(t,a)}),this.bind("showtips",function(t,a){a&&setTimeout(function(){c.close()},500)}),$(".j_notice_no").click(function(t){t.preventDefault(),c.close()})},_stampAjax:function(t,a){var s=this,e=$('input:radio[name="stamp_num"]:checked').val(),i=0;if(1==e){if(i=$(".stamp_input").val(),""==i)return $(".stamp_error").css("display","inline-block"),!1}else i=e;var n={kw:PageData.forum.forum_name,tbs:PageData.tbs,add_point:i,uid:a,post_id:t,ie:"utf-8"};$.post("/platform/fortune/addPoint?",n,function(t){t&&0==t.errno?(_html='<div class="stamp_reword_success">\u5956\u52B1\u6210\u529F</div>',$(".stamp_wrapper").append(_html),s.trigger("showtips",!0)):t&&80014==t.errno?($(".stamp_error_tip_limit").css("display","block"),s.trigger("showtips",!1)):($(".stamp_error_tip").css("display","block"),s.trigger("showtips",!1))},"json")}}});
;_.Module.define({path:"ppb/widget/postList/TbmallGuide",requires:["pcommon/component/Card"],sub:{initial:function(){this._bindEvent()},_private_guide_card:"",_guideTimeoutId:"",_bindEvent:function(){var t=this;$("#j_p_postlist").delegate(".j_tbmall_guide","click",function(){e.preventDefault(),$(window).scrollTop($("[name='sub']").offset().top),$(".edui-btn-medal").click(),e.stopPropagation()}).delegate(".j_nameplate","mouseenter",function(){clearTimeout(t._guideTimeoutId),t._showTip($(this))}).delegate(".j_nameplate","mouseleave",function(){clearTimeout(t._guideTimeoutId),t._guideTimeoutId=setTimeout(function(){t._hideTip($(this))},300)})},_showTip:function(e){var t=this;t._private_guide_card&&t._private_guide_card.closeCard();var a=e.offset(),i=(e.hasClass("j_nameplate")||e.hasClass("p_mall_tail")?a.top:a.top+43,e.hasClass("p_mall_tail")?a.left+132:a.left+105,""),l=180;e.hasClass("j_self_has_nameplate")?(i='<a class="pb_nameplate_recast_guide" href="/tbmall/propslist?category=112&ps=24" target="_blank" style="color: #1d53bf;">\u94ED\u724C\u73B0\u5728\u53EF\u4EE5\u91CD\u94F8\u4E86\u54E6~</a>',l=140):e.hasClass("j_self_nameplate")?(i='<a class="pb_nameplate_recast j_nameplate_recast" href="javascript:;" data-nameplate="'+$.json.encode(e.data("field")).replace(/\"/g,"&quot;")+'">\u91CD\u94F8\u94ED\u724C</a>',l=100):i=e.hasClass("j_self_no_nameplate")?'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-ppb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/tshow" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>':'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-ppb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/home" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>',t._private_guide_card=t.use("pcommon/component/Card",{content:i,arrow_dir:"left",arrow_pos:{left:-7,top:9},card_css:{top:a.top+(e.outerHeight()-34)/2,left:a.left+e.outerWidth()+7,width:l,height:50}}),t._private_guide_card.showCard(),t._private_guide_card._j_card.on("mouseenter",function(){clearTimeout(t._guideTimeoutId)}).on("mouseleave",function(){t._private_guide_card.closeCard()})},_hideTip:function(){self._private_guide_card&&self._private_guide_card.closeCard()}}});
;_.Module.define({path:"ppb/widget/postList",requires:["ppb/widget/Posts","album/widget/imgLikeAction","ppb/widget/pic_act_vote","ppb/widget/pic_act_repost","ppb/widget/sub_list/subListTotal"],sub:{initial:function(t){var e=this;this.posts=e.use("ppb/widget/Posts",[{maskDays:t.maskDays}]),this.bindOperatePower(t.threadCate),t.isCategoryEdit&&this.requireInstanceAsync("ppb/widget/Admin/ThreadCategory"),this._loadSubList(t),this._processSaveFaceBubble(),this.use("ppb/widget/postList/FeedBack"),this.use("ppb/widget/postList/PostPic"),this.use("ppb/widget/postList/PostBeyondPush",{firstPost:t.firstPost,beyondChannel:t.beyondChannel}),this.requireInstance("comforum/widget/promoterPostBody",[{pn:t.pn,promoterAttr:t.promoterAttr,promoterMasterTitle:t.promoterMasterTitle,promoterUserIds:t.promoterUserIds}]),this._loadPlaform(),Page.checkLoadedModules("forumList")||(this.use("ppb/widget/postList/HidePost"),this.use("ppb/widget/postList/PrintFlower"),this.use("ppb/widget/postList/TbmallGuide"),this.use("album/widget/imgLikeAction"),this._bindEvents(),this.exposureTrack(),t.firstPost.is_shared&&this.initShare(t.firstPost.post_id),$.stats.track("pbfirst","pbpv","pb","show"))},exposureTrack:function(){function t(){for(var t=0;t<$(".l_post").length;t++)$(".l_post").eq(t).data("pid")&&-1===s.indexOf($(".l_post").eq(t).data("pid"))&&s.push($(".l_post").eq(t).data("pid"))}function e(){if(s.length)for(var t=0;t<s.length;t++)if(-1===a.indexOf(s[t])&&-1===n.indexOf(s[t])){var e=$(".l_post[data-pid='"+s[t]+"']").offset();if(!e)return;try{(e.top>=$(window).scrollTop()+45&&e.top<$(window).scrollTop()+$(window).height()||e.top+e.height>=$(window).scrollTop()+45&&e.top+e.height<$(window).scrollTop()+$(window).height())&&n.push(s[t])}catch(i){}}}function i(){var t={obj_floors:"",tids:"",obj_isads:""};if(0!==n.length){for(var e=0;e<n.length;e++){var i=$(".l_post[data-pid='"+n[e]+"']").eq(0).data("field").content.post_index;e<n.length-1?(t.obj_floors+=i+"|",t.tids+=n[e]+"|",t.obj_isads+="0|"):(t.obj_floors+=i,t.tids+=n[e],t.obj_isads+=0)}a=a.concat(n),n=[],$.stats.track("pc","pb_exposure","ppb","show",{pids:t.tids,obj_ids:t.tids,page_type:"a005",obj_isads:t.obj_isads,obj_task:"common_exp",obj_floors:t.obj_floors})}}var o=this,s=[],a=[],n=[];t(),e(),$(window).scroll(o.throttle(e,10)),setInterval(function(){i()},1e3)},throttle:function(t,e){var i=Date.now();return function(){var o=this,s=arguments,a=Date.now();a-i>=e&&(t.apply(o,s),i=Date.now())}},initShare:function(t){console.log(t);var e=$("#post_content_"+t),i=e.find(".summary .summary_link .video-play");if(i.length){var o=$(".summary .summary_link img");i.css({left:o.width()/2,bottom:o.height()/2})}},_loadSubList:function(t){var e=this;e.use("ppb/widget/postList/Lzl"),t.tailList=PageUnit.load("tail_config"),e._loadSubList=e.use("ppb/widget/sub_list/subListTotal",t),F.use(["datalazyload"],function(t){window.datalazyload=new t($(document.body),{diff:500,autoDestroy:!1,subListOnloadCallback:function(t){e._loadSubList.showLzlPost(t)}})})},_loadPlaform:function(){"12"!=PageData.thread.thread_type||Page.checkLoadedModules("pic_act_vote")||Page.checkLoadedModules("pic_act_repost")||(this.use("ppb/widget/pic_act_vote"),this.use("ppb/widget/pic_act_repost"))},_bindEvents:function(){var t=this,e=$("#pb_content"),i=e.find(".l_post_bright:last"),o=e.find(".left_section").height(),s=e.find(".right_section").height();o>s&&i.addClass("noborder_bottom"),e.delegate(".j_quick_reply, a.p_reply_first","click",function(e){return e.preventDefault(),e.stopPropagation(),PageData.user.is_login?setTimeout(function(){t.fire("wanna_post"),history.pushState("",document.title,$.tb.location.getPathname()+$.tb.location.getSearch())},50):TbCom.process("User","buildLoginFrame",null,null,null,"quick_reply"),!1}).delegate(".j_louzhubiaoshi","mouseenter",function(){var t=$(this),e=t.position(),i={content:"\u70B9\u51FB\u5373\u53EF\u201C\u53EA\u770B\u697C\u4E3B\u201D\u54DF~",arrow_dir:"up",arrow_pos:{left:20},bubble_css:{top:e.top+36,left:e.left,width:140},wrap:t.parent(),closeBtn:!1},o=new UiBubbleTipBase(i);o.showBubble({zIndex:$.getcurzIndex()}),t.one("mouseleave",function(){o.closeBubble()})}).delegate(".j_voice_ad_gif","click",function(){$.stats.track("voice_ad_gif","voice"),$("body").trigger("showvoicedialog",!0)}).delegate(".replace_tip","click",function(){$(this).hide().parent(".replace_div").css("height","auto"),$(this).closest(".j_d_post_content").find(".cnt_act_vote_area").css("z-index",10)}).delegate(".j_lzl_forbidden_tip_close","click",function(){$(this).parent().parent().slideUp()})},_processSaveFaceBubble:function(){var t=$.tb.Storage.get("fisfbb_shown_times")||0,e=$.tb.Storage.get("fisfbb_is_today_shown")||!1,i=new Date;i.setDate(i.getDate()+1),i.setHours(0),i.setMinutes(0),i.setSeconds(0),3>t&&!e&&$(".j_fisfbb").on("click",".j_close",function(){$.tb.Storage.set("fisfbb_is_today_shown",!0,i),$.tb.Storage.set("fisfbb_shown_times",++t),$(this).remove()}).show()},bindOperatePower:function(t){Page.checkLoadedModules("pbAdmin")||((PageData.is_thread_admin||PageData.is_posts_admin)&&_.Module.use("ppb/widget/Admin",[],function(e){e.loadThreadManage(t),e.bindAdminEvents(),e.bindLzlAdminEvents()}),Page.checkLoadedModules("TomsAdmin")||_.Module.use("ppb/widget/TomsAdmin"))}}});
;_.Module.define({path:"ppb/widget/postList/PostBeyondPush",sub:{initial:function(e){this.post=e.firstPost,this.channel=e.beyondChannel,this.game_bar_name=e.gameBarName,this.$root=$("#pb_content"),this.bindEvent()},bindEvent:function(){var e=this;e.$root.on("click",".j-beyond-push-btn",function(){e.showBeyondTypeDialog()})},showBeyondTypeDialog:function(){var e=this,t='<!-- \u63A8\u9001\u5230\u8D34\u5427\u5A31\u4E50\u9891\u9053\u5F00\u5173\u5F39\u7A97 --> <div class="beyond-push-wrapper">  <div class="col2-left">   <label>\u9009\u62E9\u5206\u7C7B\uFF1A</label>  </div>     <div class="col2-right">      <div class="beyond-list">    <% _.each(category, function (cate) { %>                 <span class="item" data-type="<%= cate.id %>"><%= cate.name %></span>             <% }) %>   </div>     </div>   <div class="beyond-submit">   <button class="btn-default btn-middle beyond-submit-btn">\u786E\u5B9A</button>  </div> </div>',s=_.template(t),a=$.dialog,n=new a({html:s(this.channel),title:"\u63A8\u9001\u5230"+this.channel.name,closeable:!0,width:420}),l=n.element;l.on("click",".beyond-list .item",function(){$(this).addClass("selected").siblings().removeClass("selected")}),l.on("click",".beyond-submit-btn",function(){var t=l.find(".beyond-list .selected");e.beyondType=t.data("type"),t.length?(n.hide(),"\u653B\u7565"==t[0].innerText?e.gonglue():e.push(e.beyondType)):new a({html:"\u8BF7\u9009\u62E9\u4E00\u9879\u5206\u7C7B",title:"\u767E\u5EA6\u8D34\u5427",closeable:!0})})},gonglue:function(){var e=this,t={ie:"utf-8",tbs:PageData.tbs,kw:PageData.forum.forum_name,fid:PageData.forum.forum_id,tid:PageData.thread.thread_id,cid:0};$.get("/game/forum/getTabAndLabel?source=0&forum_id="+PageData.forum.forum_id,function(s){var a=[];if(a.push('<div style="width:90%;margin:0 auto; line-height:25px;padding-top:20px">'),a.push("<p>\u5C06\u8BE5\u5E16\u5B50\u5206\u7C7B\u81F3\uFF1A"),a.push('<select class="j_thread_classes">'),a.push('<option value="0" selected>\u672A\u5206\u7C7B</option>'),s=s.data)for(var n=0;n<s.length;n++)a.push('<option value="'+s[n].id+'">'+s[n].sub_tab_name+"</option>");a.push("</select>"),a.push('<select class="j_thread_classes">'),a.push('<option value="0" selected>\u672A\u5206\u7C7B</option>'),a.push("</select>"),a.push("</p>"),a.push("<p>\u63D0\u793A\uFF1A\u60A8\u53EF\u4EE5\u5230\u5427\u52A1\u7BA1\u7406\u9875\u4E2D\u6DFB\u52A0/\u4FEE\u6539\u5206\u7C7B</p>"),a.push('<div style="text-align:center">'),a.push('<input type="button" value="\u63D0\u4EA4" class="btn-sub btn-small j_thread_classes_confirm"><input type="button" value="\u53D6\u6D88" class="btn-sub btn-small j_thread_classes_cancel">'),a.push("</div>"),a.push("</div>");var l=new $.dialog({html:a.join(""),title:"\u8BBE\u7F6E\u653B\u7565\u8D34",width:400,height:140});$("select.j_thread_classes").bind("change",function(){t.cid=this.options[this.selectedIndex].value}),$($("select.j_thread_classes")[0]).bind("change",function(){for(var e=['<option value="0" selected>\u672A\u5206\u7C7B</option>'],t=0;t<s.length;t++)if(s[t].id==this.options[this.selectedIndex].value){for(var a=0;a<s[t].sub_label_list.length;a++)e.push('<option value="'+s[t].sub_label_list[a].id+'">'+s[t].sub_label_list[a].sub_label_name+"</option>");break}$($("select.j_thread_classes")[1]).html(e.join(""))}),$("input.j_thread_classes_confirm").bind("click",function(){var t=$("select.j_thread_classes")[0],s=$("select.j_thread_classes")[1];return 1!==$(s).children().length&&0==s[s.selectedIndex].value?void $.dialog.alert("\u8BF7\u9009\u62E9\u5B50\u5206\u7C7B"):void $.get("/game/forum/getTypeByForumId?forum_id="+PageData.forum.forum_id,function(a){0===a.no?$.post("/beyond/posts/push",{forumId:PageData.forum.forum_id,threadId:PageData.thread.thread_id,beyondType:a.data.guide_type_id,subTabId:t[t.selectedIndex].value,labelId:s[s.selectedIndex].value},function(t){console.log(t),-1!==t.indexOf('"no":0')?(l.close(),new $.dialog({html:"\u611F\u8C22\u4F60\u7684\u53C2\u4E0E\uFF0C\u5E16\u5B50\u6B63\u5728\u7B49\u5F85\u7F16\u8F91\u5BA1\u6838\uFF0C\u6211\u4EEC\u4F1A\u5C06\u7ED3\u679C\u4EE5\u6D88\u606F\u7684\u5F62\u5F0F\u901A\u77E5\u4F60\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85",title:"\u63A8\u9001\u6210\u529F",closeable:!0}),e.$root.find(".post-beyond-push-wrapper").addClass("has-pushed"),callback&&callback()):$.dialog.alert("\u62B1\u6B49\uFF0C\u63A8\u9001\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01")}):(console.log(a),$.dialog.alert("\u53D6\u6D88\u8D44\u8BAF\u8D34\u5931\u8D25"))})}),$("input.j_thread_classes_cancel").bind("click",function(){l.close()})},"json")},push:function(e,t){var s=this,a=$.dialog;$.post("/beyond/posts/push",{beyondType:e,threadId:this.post.thread_id,forumId:this.post.forum_id},function(e){0===e.no?(new a({html:"\u611F\u8C22\u4F60\u7684\u53C2\u4E0E\uFF0C\u5E16\u5B50\u6B63\u5728\u7B49\u5F85\u7F16\u8F91\u5BA1\u6838\uFF0C\u6211\u4EEC\u4F1A\u5C06\u7ED3\u679C\u4EE5\u6D88\u606F\u7684\u5F62\u5F0F\u901A\u77E5\u4F60\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85",title:"\u63A8\u9001\u6210\u529F",closeable:!0}),s.$root.find(".post-beyond-push-wrapper").addClass("has-pushed"),t&&t()):new a({html:"\u62B1\u6B49\uFF0C\u63A8\u9001\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01",title:"\u767E\u5EA6\u8D34\u5427",closeable:!0})},"json")}}});_.Module.define({path:"ppb/widget/scrollEvent",sub:{initial:function(){this.isStartListenScroll=!1,this.initListenFunction(),this.initARAttribute(),this.initScrollEvent(),this.initListenAjaxDom()},initListenFunction:function(){var t=this,i=7;t.startListenARScroll=function(){var e=t.levels,n=$(window).scrollTop()+t.getHalfScreenHeight();for(var o in e){var s=parseInt(o,10),l=e[s].offsetTop,r=e[s].height,a=e[s].templateId,p=e[s].monitorId,c=e[s].isFlaged,u=e[s].type||0;if(n>=l&&l+r>n&&!c){var h=Number(u)!==i?"p0248":"p0272";$.stats.track(h,"tpoint","PB","view",{tpointShow:a,line:"PT",action_type:"VIEW_TRUE",obj_id:a,obj_name:p,obj_cpid:0,obj_good_id:0,obj_throw_type:"BY_POST",err_no:0,user_timestamp:Math.round((new Date).getTime()/1e3),pro:"tieba",mid:"adtpoint",urlkey:"adtpoint",log_ver:1.1}),e[s].isFlaged=!0}}}},initARAttribute:function(){var t=this,i=t.getAutoReplys();t.isExitAutoReply&&(t.levels=i)},initScrollEvent:function(){var t=this,i=$(window);t.isExitAutoReply&&(i.on("scroll",_.throttle(t.startListenARScroll,250)),t.isStartListenScroll=!0)},initListenAjaxDom:function(){var t=this,i=$(window);$(document).on("startListenScroll",function(){t.initARAttribute(),!t.isExitAutoReply&&t.isStartListenScroll&&(i.off("scroll",t.startListenARScroll),t.isStartListenScroll=!1),t.isExitAutoReply&&!t.isStartListenScroll&&t.initScrollEvent()})},getAutoReplys:function(){var t=this,i={},e=null;return t.isExitAutoReply=!1,$(".l_post").each(function(n){var o=$(this).data("isautoreply"),s=$(this).data("field"),l="",r="";if(s&&s.content&&s.content.pb_tpoint&&(e=s.content.pb_tpoint,l=e.monitor_id,r=e.tp_type),o||0===o){var a=$(this).height(),p=$(this).offset().top,c={offsetTop:p,height:a,isFlaged:!1,templateId:o,monitorId:l,type:r};i[n]=c,t.isExitAutoReply=!0}}),i},getHalfScreenHeight:function(){return $(window).height()/2}}});_.Module.define({path:"tbmall/widget/TbeanSafeAjax",requires:["tbmall/widget/TbeanSafe"],sub:{initial:function(a){this.options=a||{}},ajax:function(a){var t=this,e=a.success||function(){},n=a.data||{},s=function(s){var i=t.use("tbmall/widget/TbeanSafe",{json:s,sucCallback:function(e){var s=$.extend({},n,e),i=$.extend({},a);i.data=s,t.ajax(i)},tbeanOptions:t.options});i.needCheck()||e(s)};return a.success=s,a.type=a.type||"post",a.dataType=a.dataType||"json",$.ajax(a)},post:function(a,t,e){var n={url:a,data:t,success:e};return this.ajax(n)}}});_.Module.define({path:"common/widget/messenger",requires:["common/widget/messenger/messengerProcesser","common/widget/messenger/messengerTarget"],sub:{initial:function(e,n){if(!e)throw new Error("Messenger name must be asigned");var s=n||"[PROJECT_NAME]";this.name=e,this.prefix=s.toString(),this.supportPostMessage="postMessage"in window,this.origins=[],this.processer=this.requireInstance("common/widget/messenger/messengerProcesser"),this.targets={},this._initListen()},addTarget:function(e,n){this.targets[n]=this.requireInstance("common/widget/messenger/messengerTarget",[this.prefix,e,n])},registerCommand:function(e){this.processer.registerCommand(e)},registerOrigin:function(e){var n=0;for("string"==typeof e&&(e=[e]),n;n<e.length;n++)this.origins.push(e[n])},send:function(e){var n,s=this.targets;for(n in s)s.hasOwnProperty(n)&&s[n].send(e)},_warn:function(e){window.console&&window.console.warn&&window.console.warn(e)},_initListen:function(){var e=this,n=function(n){var s="";if("object"==typeof n){if(!n.data||"string"!=typeof n.data)return void(window.console&&console.warn("The received message is not type of string"));if(s=n.data,/^ignoredProject/.test(s))return;if(s.substring(0,e.prefix.length)!==e.prefix)return void(window.console&&console.warn("The msg type is not avaliable in project "+e.prefix));if(n.origin&&!e._checkOrigin(n.origin))return void(window.console&&console.warn("The post origin is not avaliable in project "+e.prefix))}else if(s=n,/^ignoredProject/.test(s))return;s=s.slice(e.prefix.length),s=e._escapeHTML(s);try{s=$.parseJSON(s)}catch(i){throw new Error("The JSON string is not valid")}var r=e.processer.process(s)||{};s.command&&s.shake&&s.shake_id&&e.send($.json.encode({command:s.command+"@"+s.shake_id+"@success",shake:!0,shake_id:s.shake_id,data:r}))};window.messenger=e,this.supportPostMessage?"addEventListener"in document?window.addEventListener("message",n,!1):"attachEvent"in document&&window.attachEvent("onmessage",n):window.navigator[this.prefix+this.name]=n},_escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\"/g,"&quot;")},_checkOrigin:function(e){var n=0,s=this.origins.length;for(n;s>n;n++)if(this.origins[n]===e)return!0;return!1}}});
;_.Module.define({path:"common/widget/messenger/messengerProcesser",requires:[],sub:{_failCommandCacheList:{},initial:function(){this.commandMap={common_login:$.proxy(this.common_login,this),common_register:$.proxy(this.common_register,this),exception_all:$.proxy(this.exception_all,this)}},registerCommand:function(o){this.checkExistCommand(o)&&(this.commandMap=$.extend(this.commandMap,o)),this.processFailCommand(o)},checkExistCommand:function(o){var n;for(n in o)if(o.hasOwnProperty(n)&&n in this.commandMap)return void(window.console&&console.warn('The command "'+n+'" is already exist'));return!0},processFailCommand:function(o){var n;for(n in o){var i=this._failCommandCacheList[n];o.hasOwnProperty(n)&&i&&this.process(i)}},process:function(o){if(!(o.command&&o.command in this.commandMap))return this._failCommandCacheList[o.command]=o,void(window.console&&console.warn("Please check or register the data processing command"));var n=this.commandMap[o.command];return n(o.data)},common_login:function(){PageData&&PageData.user&&!PageData.user.is_login&&this.requireInstanceAsync("common/widget/LoginDialog",[],function(){})},common_register:function(o){var n=o.return_url||"//tieba.baidu.com",i="https://passport.baidu.com/v2/?reg&tpl=tb&u="+n;window.open(i)},exception_all:function(){throw new Error("Processing data exception")}}});
;_.Module.define({path:"common/widget/messenger/messengerTarget",requires:[],sub:{initial:function(e,t,r){var i="";if(arguments.length<3?i="Target error: target and name are both requied":"object"!=typeof t?i="Target error: target itself must be window object":"string"!=typeof r&&(i="Target error: target name must be string type"),i)throw new Error(i);this.prefix=e,this.target=t,this.name=r},send:function(e){var t="postMessage"in window;if(t)this.target.postMessage(this.prefix+e,"*");else{var r=window.navigator[this.prefix+this.name];if("function"!=typeof r)throw new Error("Target error: target callback function is not defined");var i=$.tb.location,o={origin:i.getProtocol()+"//"+i.getHost(),data:this.prefix+e};r(o,window)}}}});_.Module.define({path:"common/widget/baseUserData",requires:[],sub:{initial:function(){},route:{getTdou:"//tieba.baidu.com/tbmall/getUserTd"},_item_cache_last_total_tdou:0,_parrScores:null,_parrProps:null,getUserName:function(){return PageData.user.user_nickname||PageData.user.name||PageData.user.name_url},getUserTdou:function(){var e=PageData.user,r=this._parrScores||e.Parr_scores;return r&&!$.isEmptyObject(r)?r.scores_money+r.scores_other:0},getShowName:function(){return PageData.user.name_show||PageData.user.user_name},isMemeber:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return!!r},getMemberLevel:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return r},getMemberIcon:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevelExpire(e),a=this.getMemberIconByLevel(r);return a},getMemberIconByLevel:function(e){e&&(e=parseInt(e));var r="",a="",t="";switch(e){case-1:r=" icon-vip1-gray-18 base_member_icon",a="\u8D34\u5427\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458";break;case 1:r=" icon-vip1-18 base_member_icon",a="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u4F1A\u5458";break;case-2:r=" icon-vip2-gray-18 base_member_icon",a="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;case 2:r=" icon-vip2-18 base_member_icon",a="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;default:r="",a=""}var s={level:e,icon:r,title:a,action_title:t};return s},isLogin:function(){return PageData.user.is_login},needUpdateTdou:function(){var e=PageData.user.mParr_props||PageData.user.Parr_props,r=PageData.user.Parr_scores;return!(e&&r)},_getMaxLevel:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return 1e3*s.end_time>a&&parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10)),r},_getMaxLevelExpire:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10),1e3*s.end_time<=a&&(r=0-r)),r},getTdou:function(e,r){var a=this;a._get_tdou_ajax&&a._get_tdou_ajax.abort(),a._get_tdou_ajax=$.ajax({type:"get",url:a.route.getTdou+"?"+new Date,data:{},cache:!1,dataType:"json"}).success(function(a){e.call(r,a)})},getUserTreasure:function(){return PageData.user.Parr_scores?PageData.user.Parr_scores.treasure_coin_total||0:0}}});_.Module.define({path:"common/widget/cashierDialog",requires:["common/widget/messenger"],sub:{sub_iframe_name:"cashier_dialog_iframe",windowId:"window_iframe_app_"+(new Date).getMilliseconds(),_iframe_dialog:null,initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon()},getTpl:function(){var e='<div class="cashier_dialog base_user_data"><div class="cashier_dialog_header"><div class="header_title"><span class="header_icon"></span>#{title}</div><div class="user_info"><span class="title_acc">\u8D26\u53F7\uFF1A<span class="#{member} j_member_icon"></span><a class="title_acc_name j_member_red">#{user_name}</a></span><span class="title_remain">T\u8C46\u4F59\u989D\uFF1A<span class="title_remain_num"><span class="user_tdou_icon"></span><span  class="j_tdou">#{tdou_num}<span></span></span></span></div><a class="header_close j_header_close"></a></div><div class="tdou_cashier_wrap" id="tdou_cashier_wrap"><iframe id="cashier_dialog_iframe" class="cashier_dialog_iframe" src="#{cashier_url}" frameborder="0" style="border: 0"></iframe></div></div>';return e},buildCashierIframe:function(e){return $.tb.format(this.getTpl(),e)},showDialog:function(e){var a=this;a._iframe_dialog&&$(".tdou_member_cashier_iframe_dialog").remove(),this.options=e||{},PageData.pay_fr=e.fr,PageData.pay_track=e.track;var i=e.cashier_url,s=this.member.action_title,t={user_name:this.dataProxy.getUserName(),tdou_num:0,member:this.member.icon,cashier_url:i,title:s||"\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},r=a.buildCashierIframe(t),n={modal:!0,showTitle:!1,fixed:!0,width:726,height:564,hideOnclose:!1,holderClassName:"tdou_member_cashier_iframe_dialog",draggable:!0,html:r};a._iframe_dialog=new $.dialog(n),a._iframe_dialog.show(),a._setBody(),("ordinary_member_icon"==$.trim(this.member.icon)||"super_member_icon"==$.trim(this.member.icon))&&a._iframe_dialog.element.find(".j_member_red").addClass("member_red"),a.updateTdou(),a.wrap=a._iframe_dialog.element,PageData.tdou_dianquan_iframe_dialog=a._iframe_dialog,a.track("show"),a.bindEvent(),a.initMessager()},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},bindEvent:function(){var e=this;e.wrap.find(".j_header_close").on("click",function(){e.closeMain()})},closeMain:function(){var e=PageData.tdou_dianquan_iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.tdou_dianquan_iframe_dialog,this.track("\u5173\u95ED\u7A97\u53E3")},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},initMessager:function(){var e=this;if(!e.MessageInstance){e.MessageInstance=e.requireInstance("common/widget/messenger",[e.windowId,"tdou_pay"]);var a=window.document.getElementById(e.sub_iframe_name);e.MessageInstance.addTarget(a.contentWindow,e.sub_iframe_name);var i=["http://db.baidu.com","http://pay.baidu.com"];e.MessageInstance.registerOrigin(i),e.MessageInstance.registerCommand({encourage_dianquan_readystatechange:$.proxy(e.onReadyStateChange,this),encourage_dianquan_close:$.proxy(e.onClose,this)})}},sendMessage:function(e){var a=this;if(a.MessageInstance){var i="";"object"==typeof e&&(i=JSON.stringify(e)),a.MessageInstance.targets[a.sub_iframe_name].send(i)}},onReadyStateChange:function(e){if(e)switch(e.status){case 2e3:this.updateMember(e.data),this.track("\u652F\u4ED8\u6210\u529F");break;case 3e3:this.onClose();break;case 3001:this.onClose(),this.track("\u518D\u6B21\u8D2D\u4E70")}},onClose:function(){this.closeMain()},updateTdou:function(){var e=this;e.dataProxy.getTdou(function(e){if(e&&0===e.no){var a=e.data.Parr_scores,i=a?a.scores_money+a.scores_other:0;$(".tdou_member_cashier_iframe_dialog .j_tdou").html(i)}},this)},updateMember:function(e){var a=this,i=a.dataProxy.getMemberIconByLevel(e.user_level);$(".tdou_member_cashier_iframe_dialog .j_member_icon").addClass(i.icon);var s=e.user_level;s&&(s=parseInt(s),s>0&&$(".tdou_member_cashier_iframe_dialog .j_member_red").addClass("member_red"))},track:function(e){$.stats.track(PageData.pay_track||"memberpay","cashierDialog-"+PageData.pay_fr,PageData.product,e||"click")}}});_.Module.define({path:"common/widget/qianbaoCashierDialog",requires:["common/widget/baseUserData"],sub:{iframeContainerId:"qianbao_cashier_payment_channel_wrap",qianbaoLbscashierUrl:"//zhifu.baidu.com/static/epic/fe_wallet_cashier/page/iframe/cashier.js?t="+(new Date).getTime(),services:{createOrder:"/tbmall/getPayUrl",getOrder:"/tbmall/getorder"},initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData")},createMain:function(a,e,t){var i=this;PageData.qianbao_cashier=i,i.setLoading(),$.isFunction(t)&&t(i.$root),i.changeoPayAmount(a,e),i.qianbao_params_json=i.getParams(a)},buildCashier:function(a,e){var t=this;t.cashier?t.cashier.updateOrder(a):(1==e?t.cashier=new window.lbscashier({onmessage:t.onMessage,containerId:t.iframeContainerId,data:a,height:340}):2==e&&(t.cashier=new window.lbscashier({onmessage:t.onMessage,containerId:t.iframeContainerId,data:a,height:420})),$("#cashier-iframe").css({border:"none"}))},onMessage:function(a){var e=PageData.qianbao_cashier;if(!a)return void console.log("onmessage null");var t=a.type,i=a.data,s=a.option,o=s&&s.channel,n=!1;if("updateOrder"===t)e.clearPayLoading();else if("pay"===t)switch(i){case"submit":if("wechat"===o||"alipayqr"===o||"gameyeepay"===o||"mobileyeepay"===o)return;e.showPaymentTip(),e.track("pay-submit");break;case"addcard":break;case"success":e.track("pay-success");var r="wechat"===o||"alipayqr"===o||"gameyeepay"===o||"mobileyeepay"===o?!0:!1;r?(n=!0,e.checkQrcodePaymentResult()):e.showPaymentTip(r)}else if("qrcodeAlipay"===t)switch(i){case"success":e.showPaymentTip(),e.track("alipay-qrcode-success")}else if("qrcodeWechat"===t)switch(i){case"success":e.showPaymentTip(),e.track("wechat-qrcode-success")}n||e.clearLoading()},getSmallUser:function(){var a=PageData.user.id,e=a%2;return!e},showDialog:function(a,e,t,i){var s=this;1==t?$.stats.track("all","\u6253\u5F00\u4F1A\u5458\u6536\u94F6\u53F0","all","show"):2==t&&$.stats.track("all","\u6253\u5F00T\u8C46\u8BA2\u5355\u652F\u4ED8\u9875","all","show"),s.product=a.product,$.JsLoadManager.loadUrl(s.qianbaoLbscashierUrl,function(){s.buildDialog(e),s.createMain(a.qianbao_params,t,i)})},buildDialog:function(a){var e=this;if(e._iframe_dialog){if($(".qianbao_cashier_iframe_dialog").size()>0&&!$(".qianbao_cashier_iframe_dialog").is(":hidden"))return;$(".qianbao_cashier_iframe_dialog").remove()}var t={modal:!0,showTitle:!1,fixed:!0,width:717,height:638,hideOnclose:!1,holderClassName:"qianbao_cashier_iframe_dialog",draggable:!0,html:e.getDialogTpl(a)};e._iframe_dialog=new $.dialog(t),e._iframe_dialog.show(),e._setBody(),e.$root=e._iframe_dialog.element,e.track("show")},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},getDialogTpl:function(a){var e=this,t="member"===e.product?'<div class="qianbao_cashier_agreement">\u8BF7\u52A1\u5FC5\u5BA1\u9605\u5E76\u63A5\u53D7<a href="https://tieba.baidu.com/tb/vip_eula.html">\u300A\u8D34\u5427\u4F1A\u5458\u670D\u52A1\u534F\u300B</a>\u6240\u6709\u6761\u6B3E\uFF0C\u5426\u5219\u60A8\u65E0\u6743\u4F7F\u7528\u672C\u670D\u52A1</div>':'<div class="qianbao_cashier_agreement">\u8BF7\u52A1\u5FC5\u5BA1\u9605\u5E76\u63A5\u53D7<a href="https://tieba.baidu.com/tb/tdouprecautions.html">\u300AT\u8C46\u8D2D\u4E70\u987B\u77E5\u300B</a>\u6240\u6709\u6761\u6B3E\uFF0C\u5426\u5219\u60A8\u65E0\u6743\u4F7F\u7528\u672C\u670D\u52A1\u3002<div class="protocol"><a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_pc.html">\u5145\u503C\u653B\u7565</a>|<a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_show.html">\u9650\u989D\u67E5\u8BE2</a></div></div>',i='<div class="qianbao_cashier_dialog j_qianbao_cashier_dialog"><!-- htmlcs-disable -->  <div class="loading j_qianbao_cashier_loading">      <table height="100%" width="100%">          <tbody><tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                                  <p class="j_loading_text">\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...</p>              </td>          </tr>          </tbody>      </table>  </div><!-- htmlcs-disable -->  <div class="qiaobao_pay_loading j_pay_loading">      <table height="100%" width="100%">          <tbody>          <tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                  <p class="j_loading_text">\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>              </td>          </tr>          </tbody>      </table>  </div><div class="qianbao_cashier_payment_goods_wrap">#{goodsShowTpl}</div><div class="qianbao_cashier_payment_channel_wrap" id="'+e.iframeContainerId+'"></div>'+t+"</div>",s={goodsShowTpl:a};return i=$.tb.format(i,s)},qianbaoSecure:function(){var a={};a.templist=[];var e="passport.baidu.com";return a.set_pass_domain=function(a){switch(a){case"passport.baidu.com":case"wappass.baidu.com":case"passport.rdtest.baidu.com":case"passport.qatest.baidu.com":e=a}},a.pin=function(e,t){var i=window.Image?new Image:document.craeteElement("img"),s=function(a){s=function(){},t&&t(a)};i.onload=function(){s()},i.onerror=function(){s("failed")},a.templist.push(i),i.src=e},a}(),changeoPayAmount:function(a,e){var t=this,i=a;t.qianbao_params_json=t.getParams(a),t.buildCashier(i,e)},closeDialog:function(){var a=this,e=a._iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.qianbao_cashier,clearTimeout(a.timerId),clearTimeout(a.checkPaymentId),a.track("\u5173\u95ED\u7A97\u53E3")},getParams:function(a){var e={};if(!a)return e;var t=/orderId=[^&]*/,i=t.exec(a);if(1==i.length){var s=i[0].split("=");e.orderId=s[1]||""}return e},getPageUrl:function(){var a=$.tb.location.getHref();return a=a.replace(/&customerId=.*|\?customerId=.*/g,"")},checkPaymentResult:function(){var a=this;a.getPaymentResult("ok",function(e){a.showPaymentSuccess(e)},function(e){a.showPaymentFailure(e)})},checkQrcodePaymentResult:function(){this.setLoading("check"),this.checkPaymentResult()},getPaymentResult:function(a,e,t){var i=this;i.setLoading();var s={order_id:i.qianbao_params_json.orderId},o={product:i.product,userName:i.dataProxy.getUserName()};i._checkPaymentResult&&i._checkPaymentResult.abort();var n=5,r=function(){n--,s.polling=5-n,clearTimeout(i.checkPaymentId),i._checkPaymentResult=$.ajax({type:"GET",url:i.services.getOrder,data:s,dataType:"json"}).success(function(s){var c=s.data.db_money||0;c/=100;var l=s.data.scores_total;if(!l){var d=s.data.given_scores||0;l=1e3*c+d+i.dataProxy.getUserTdou()}o=$.extend(o,{payAmount:c.toFixed(2),totalScores:l,payTdou:(s.data.given_scores||0)+(10*s.data.db_money||0)});var p=s.data.member_info;if(p){var _="yyyy-MM-dd",u=1e3*parseInt(p.create_time),m=1e3*parseInt(p.end_time);o=$.extend(o,{create_time:$.dateFormat(new Date(u),_),end_time:$.dateFormat(new Date(m),_)})}0==s.no?(i.clearLoading(),clearTimeout(i.checkPaymentId),e&&e(o),n=5):n>0&&"ok"===a?i.checkPaymentId=setTimeout(r,1e3):(i.clearLoading(),t&&t(o))})};i.checkPaymentId=setTimeout(r,1e3)},setLoading:function(a){var e=this,t=e.$root.find(".j_qianbao_cashier_loading");if(!t.is(":visible")){var i={loading:"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...",paying:"\u5F88\u52AA\u529B\u7684\u5145\u503C\u4E2D...",check:"\u67E5\u8BE2\u5145\u503C\u7ED3\u679C\u4E2D..."};t.show(),t.find(".j_loading_text").html(i[a]||i.loading)}},clearLoading:function(){var a=this,e=a.$root.find(".j_qianbao_cashier_loading");1==e.length&&e.hide()},showPaymentTip:function(a){var e=this,t=e.$root.find(".j_qianbao_payment_tip");1==t.length&&t.remove(),e.$root.find(".j_qianbao_cashier_dialog").append(baidu.template('<!-- htmlcs-disable -->  <section class="qianbao_payment_tip j_qianbao_payment_tip ">      <div class="tip_dialog">          <div class="tip_dialog_content">              <%if(isQuickPay){%>              <p class="description">\u60A8\u5DF2\u6210\u529F\u652F\u4ED8</p>              <%} else {%>              <p class="description">\u8BF7\u5728\u65B0\u6253\u5F00\u9875\u9762\u4E0A\u5B8C\u6210\u5145\u503C</p>              <%}%>              <p class="description-tips">\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>              <div class="center">                  <a class="btn_default btn_sub btn-middle j_close qianbao_pay_tip_btn j_try_pay_again" style="margin-right: 20px;">\u5931\u8D25\uFF0C\u91CD\u65B0\u652F\u4ED8</a>                  <a class="btn_default btn-middle btn-encourage j_pay_ok qianbao_pay_tip_btn">\u652F\u4ED8\u6210\u529F</a>              </div>          </div>          <span class="tip_dialog_close j_close"></span>      </div>      <span class="middle-helper"></span>  </section>',{isQuickPay:a})),t=e.$root.find(".j_qianbao_payment_tip"),t.find(".j_close").on("click",function(){e.hidePaymentTip(),e.getPaymentResult("fail",function(a){e.showPaymentSuccess(a)},function(){e.trigger("event_tdou_qianbao_pay_again")})}),t.find(".j_pay_ok").on("click",function(){e.checkPaymentResult(),e.hidePaymentTip()})},hidePaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");e&&e.remove()},showPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");e.show(),e.find(".j_loading_text").html("\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...")},clearPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");1==e.length&&e.hide()},showPaymentSuccess:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic success_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83B7\u53D6\u6210\u529F\uFF01</span>          <p style="text-align:center">\u60A8\u53EF\u4EE5\u5728<span class="pay_amount">\u6211\u7684T\u8C46\u94B1\u5305</span>\u4E2D\u67E5\u770B\u8BE6\u7EC6\u4FE1\u606F</p>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503C\u6210\u529F\uFF01</span>          <%}%>      </div>        <%if(product == \'tdou\'){%>      <p><label>\u8D26\u53F7\uFF1A</label><%=userName%></p>      <p><label>\u83B7\u8D60T\u8C46\uFF1A</label><span class="pay_amount"><%=payTdou%></span>T\u8C46</p>      <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>      <%}else if(product == \'member\'){%>      <p><label>\u4F1A\u5458\u8D77\u59CB\u65E5\u671F\uFF1A</label><span class="member_date"><%=create_time%></span></p>        <p><label>\u4F1A\u5458\u7ED3\u675F\u65E5\u671F\uFF1A</label><span class="member_date"><%=end_time%></span></p>      <%}%>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_close ">              <%if(product == \'tdou\'){%>              \u7EE7\u7EED\u83B7\u53D6              <%}else if(product == \'member\' || product == \'packet\'){%>              \u7EE7\u7EED\u5145\u503C              <%}%>          </a>      </div>      <p style="text-align:center"><span class=" second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3</p>  </div>  ',a);e.updateUserInfo(a.totalScores),e.showPaymentResult(t)},showPaymentFailure:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic fialed_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83B7\u53D6\u5931\u8D25\uFF01</span>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503C\u5931\u8D25\uFF01</span>          <%}else if(product == \'packet\'){%>          <span class="result_txt">\u5145\u503C\u5931\u8D25\uFF01</span>          <%}%>      </div>      <p><label>\u8D26\u53F7\uFF1A</label><%=userName%></p>      <p><label>\u83B7\u8D60T\u8C46\uFF1A</label><span class="pay_amount"><%=payTdou%></span>T\u8C46</p>      <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_repay ">              <%if(product == \'tdou\'){%>              \u91CD\u65B0\u83B7\u53D6              <%}else if(product == \'member\' || product == \'packet\'){%>              \u91CD\u65B0\u5145\u503C              <%}%>          </a>      </div>        <p style="text-align:center">          <span class="second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3          <a href="//tieba.baidu.com/hermes/feedback?category=pay">\u8FDB\u884C\u53CD\u9988</a>      </p>  </div>  ',a);e.showPaymentResult(t)},updateUserInfo:function(a){PageData.user.Parr_scores.scores_total=a,this.$root.find(".j_tdou").html(a)},showPaymentResult:function(a){var e=this;e.$root.find(".j_qianbao_cashier_dialog").append($(a));var t=e.$root.find(".j_qiaobao_pay_result_dialog .j_second"),i=5,s=function(){return i--,0==i?void e.closeDialog():(t.html(i),void(e.timerId=setTimeout(s,1e3)))};e.timerId=setTimeout(s,1e3),e.$root.on("click",".j_qiaobao_pay_result_dialog .j_close",function(){e.closeDialog()}).on("click",".j_qiaobao_pay_result_dialog .j_repay",function(){clearTimeout(e.timerId),e.$root.find(".qiaobao_pay_result_dialog").remove(),e.trigger("event_tdou_qianbao_pay_again")})},track:function(a,e,t){var i=this;$.stats.track(a,e||"qianbaoCashierDialog-"+i.product,PageData.product+"-"+(t||"qianbao-cashier-"+i.product),"click")}}});_.Module.define({path:"user/widget/userApi",requires:[],sub:{initial:function(){},checkUniversalMembershipOf:function(e){return $.getPageData("mParr_props.level.props_id",0,e)>0&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkOverdueSuperMembershipOf:function(e){return 2==$.getPageData("mParr_props.level.props_id")&&1e3*$.getPageData("mParr_props.level.end_time",0,e)<1*new Date},checkSuperMemberShipOf:function(e){return 2===this.getUniversalMemberLevelOf(e)&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkSingleForumMembershipOf:function(e,r){var t=$.getPageData("mParr_props.forum_member",0,e);return t?t[r]&&1e3*t[r].end_time>1*new Date:!1},getUniversalMemberLevelOf:function(e){return this.checkUniversalMembershipOf(e)?$.getPageData("mParr_props.level.props_id",0,e):0}}});_.Module.define({path:"user/widget/Icons",requires:["IconCard","IconsBookView","IconsBookTip","IconsBookControl","IconsBookCommon"],sub:{iconClassList:{0:"",1:"icon-crown-vip",2:["icon-crown-super-vip","icon-crown-super-v1","icon-crown-super-v2","icon-crown-super-v3","icon-crown-super-v4","icon-crown-super-v5"],3:["icon-crown-year-vip","icon-crown-year-v1","icon-crown-year-v2","icon-crown-year-v3","icon-crown-year-v4","icon-crown-year-v5"]},overdueSuperIconList:["icon-crown-super-non","icon-crown-super-non1","icon-crown-super-non2","icon-crown-super-non3","icon-crown-super-non4","icon-crown-super-non5"],initial:function(){this._buySlot=$(".j_icon_slot_buy"),this._icon_book_wrap=$(".j_book_icon"),this.common=this.use("IconsBookCommon"),PageUnit.load("icons_category"),this.userApi=this.requireInstance("user/widget/userApi",[])},getCrownIconClass:function(e,i){var n=$.getPageData("vipInfo.v_level",0,e),t=this.userApi.getUniversalMemberLevelOf(e),r=$.getPageData("vipInfo.v_status",0,e);r=parseInt(r,10),t=3===r?3:t;var a="";if(i){if(this.userApi.checkOverdueSuperMembershipOf(e))return this.overdueSuperIconList[n];if(0===t)return a="icon-crown-super-non"}switch(t){case 0:a=this.iconClassList[t];break;case 1:a=this.iconClassList[t];break;case 2:case 3:a=this.iconClassList[t][n]}return a},getPreIconHtml:function(e,i,n){var t={};t.mParr_props=e,i=i||t;var r,a=["\u8D34\u5427\u4F1A\u5458","\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"],o="",s=Math.round((new Date).getTime()/1e3),c=$.getPageData("forum.forum_id",0);this.userApi.checkSingleForumMembershipOf(i,c)&&(o='<div class="pre_icon_wrap pre_icon_wrap_theme"><a class="icon_tbworld icon-vip3-16" title="\u672C\u5427\u4F1A\u5458" href="/tbmall/tshow" onclick="return false" target="_blank"></a></div>');var l="";return e&&e.level&&e.level.end_time>s?(l=this.getCrownIconClass(i),o='<div class="pre_icon_wrap pre_icon_wrap_theme1">',r=e.level.props_id,o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[r-1]+'"></a>',o+="</div>"):n&&(l=this.getCrownIconClass(i,!0),o='<span class="pre_icon_wrap pre_icon_wrap_theme1">',r=$.getPageData("level.props_id",0,e),o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[r-1]+'"></a>',o+="</span>"),o},getTbvipIconHtml:function(e,i,n){i=i?i:1,n=n?n:"";var t="";return e&&e.type&&(t='<span class="tbvip_icon_wrap tbvip_icon_wrap_theme'+i+" "+n+'"><a class="icon_tbvip icon_tbvip_type'+e.type+'" href="/tbvip/index"target="_blank" title="'+e.intro+'"></a></span>'),t},getIconsHtml:function(e,i,n){var n=n?n:5,t=e.new_iconinfo,r=0;for(var a in t)r++;var o='<span class="icon_wrap  icon_wrap_theme1">',s=0;if(!t){var c=e.iconinfo;if(c){var l=c[0];o+=this._getOldHtml(l,1)}}for(var _ in t){var p=t[_];if(s==n)break;if($.isEmptyObject(p)){if("1"==_){var c=e.iconinfo;if(!$.isEmptyObject(c)){var l=this._getReplaceIcon(c,t);if(!l)continue;o+=this._getOldHtml(l,1),s++}}}else this.common.isShowDurationIcon(p)&&(o+=this._getIconHtml(p,1),s++)}return o+="</span>"},_getReplaceIcon:function(e,i){if($.isEmptyObject(i))return e[0];for(var n=0;n<e.length;n++){var t=e[n];if(!this._judgeIconInNewiconinfo(i,t))return t}return null},_judgeIconInNewiconinfo:function(e,i){if($.isEmptyObject(e))return!1;if($.isEmptyObject(i))return!1;for(var n in e){var t=e[n];if(t&&t.name==i.name)return!0}return!1},_imgSize:{1:14,2:18},_oldIconTitle:{is_lottery_1:"\u94C1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_2:"\u94DC\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_3:"\u94F6\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_4:"\u91D1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_coreuser_1:"\u8D34\u5427\u6838\u5FC3\u7528\u6237",is_verify_1:"\u767E\u5EA6\u8D34\u5427\u4F01\u4E1A\u5E73\u53F0\u8BA4\u8BC1",user_type_1:"\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1",is_battle_1:"\u8D34\u5427\u62F3\u738B",is_welfare_1:"\u798F\u5229\u5370\u8BB0"},_getOldHtml:function(e,i){var n="",t=e.sprite[e.value];if(!t)for(var r in e.sprite){if(e.sprite[r]&&(0!=e.value||"meizhi_level"==e.name)){t=e.sprite[r];break}return n}var a=e.icon+"?stamp="+t.split(",")[0];switch(background='style="background: url('+a+") no-repeat center center; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+a+',sizingMethod=scale); background-size: 14px 14px"',e.name){case"meizhi_level":var o=e.value;o=o?o:0,o>=2&&(o-=2,n+='<a class="old_icon_size" '+background+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+o+'"></span></a>');break;case"is_member":n+='<a class="old_icon_size" '+background+' target="_blank"  class=" icon_fanclub"  title="\u7C89\u4E1D\u4F1A\u5458"></a>';break;default:n+=e.title_url?'<a class="old_icon_size" '+background+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>':'<span class="old_icon_size" '+background+' title="'+this._oldIconTitle[e.name+"_"+e.value]+'"  locate="'+e.name+"_"+e.value+'"></span>'}return n},_getIconHtml:function(e,i){var n,t,r,a,o,i=i||1,s=50,c="",l="//tb1.bdstatic.com/tb/cms/com/icon/";if(n=e.sprite[e.value],!n)for(var _ in e.sprite){if(e.sprite[_]&&(0!=e.value||"meizhi_level"==e.name)){n=e.sprite[_];break}return c}t=n.split(","),r=t[0],a=t[1];var p=l+e.category_id+"_"+this._imgSize[i]+".png?stamp="+r;switch(o='style="background: url('+p+") no-repeat -"+a*s+"px  -"+(i-1)*s+'px;"',e.name){case"meizhi_level":var u=e.value;u=u?u:0,u>=2&&(u-=2,c+="<a "+o+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+u+'"></span></a>');break;case"is_member":c+="<a "+o+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(e.title_url)c+="<a "+o+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>';else{{e.title}c+="<span "+o+' title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"></span>'}}return c}}});
;_.Module.define({path:"user/widget/Icons/IconsBookControl",requires:["IconsBookView","IconsBookTip","IconCard","IconsBookMessagebox","IconsBookGetIcon"],sub:{_icon_book:null,_icon_book_ajax:null,_icon_user_action:"",_icon_tab_loaded:{},_tip:null,_messagebox:null,tabLen:0,_slot_no:0,_icon_info:{},_current_tab_index:0,_selected_icon_name:"",_target_ele:null,_option:{width:655},_slot_buy_price:[0,0,100,1e4,3e4,5e4,1e4,2e4,1e5],initial:function(){var o=this;o._wrap=$("body"),o._view=o.use("user/widget/Icons/IconsBookView");var e=PageData.category_info,t=e.category_list||[{category_id:"101",category_name:"\u8DB3\u7403"},{category_id:"102",category_name:"\u661F\u5EA7"},{category_id:"104",category_name:"\u5176\u4ED6"}];o.defaultCategoryId=o._getDefaultCategoryId(e.default_category),o.bindIconBookHookEvents(t)},bindIconBookHookEvents:function(o){var e=this;e._wrap.delegate(".j_icon_slot_buy","mouseenter",function(){e.__timeoutId&&clearTimeout(e.__timeoutId),e.closeAllCard(),e._icon_user_action="buy_slot",e._target_ele=$(this),e._selected_icon_name="";var o=$(".j_icon_slot").length;return e._slot_no=1,e.buySlot({add_slot_no:o+1,price:e._slot_buy_price[o+1],action:"buy_slot"},$(this)),!1}),e._wrap.delegate(".j_icon_slot_buy","mouseleave",function(){return e.__timeoutId&&clearTimeout(e.__timeoutId),e.__timeoutId=setTimeout(function(){e._messagebox&&e._messagebox.hideBox()},200),!1}),e._wrap.delegate(".j_icon_slot","click",function(t){e.closeAllCard(),e._setIconRefresh($(this)),e._icon_user_action="replace_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot"),a=$(this).tbattr("data-name");e._selected_icon_name=a,e._slot_no=_;var i="",n={};for(var c in n)n[c].name==a&&(i=n[c].category_id);e.initIconBook({slot_no:_,category_info:o,icon_id:a,action:"replace_icon",category_id:i},$(this)),t.preventDefault()}),e._wrap.delegate(".j_slot_null_icon","click",function(t){t.preventDefault(),e.closeAllCard(),e._selected_icon_name="",e._setIconRefresh($(this)),e._icon_user_action="buy_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot");e._slot_no=_;e.initIconBook({slot_no:_,category_info:o,icon_id:"",action:"buy_icon"},$(this))}),e._wrap.delegate(".j_icon_slot","hover",function(o){var e=$(this);if(!e.hasClass("j_slot_null_icon")){var t=$(this).tbattr("data-name"),_=($(this).tbattr("data-slot"),{});if(_){var a=null;for(var i in _)if(_[i].name==t){a=_[i];break}if(a&&a["level_"+a.value]){var n=a["level_"+a.value],c="url("+n.icon_1+") no-repeat",r=o||event;if("mouseenter"==r.type){var s={background:c},l=e.css("background");l||(l=e[0].style.background),e.data({bg:l}),e.css(s),e.addClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").addClass("icon_slot_refresh_hover")}else{var l=e.data("bg"),s={background:l};e.css(s),e.removeClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").removeClass("icon_slot_refresh_hover")}}}}})},buySlot:function(o,e){var t=this;t._messagebox||(t._messagebox=t.use("user/widget/Icons/IconsBookMessagebox")),t._messagebox.is_leave_close=!0,t._messagebox.showBox(o,e)},initIconBook:function(o,e){var t=this,_=o.category_info;t.closeIconBook();var a=t._view.getTabItem(_),i={content:a,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:e,attr:"id='icon_book_tab'",wrap:$("body")};if(t._icon_book=t.use("user/widget/Icons/IconCard",i),t._icon_book.showCard({type:"delayShow",time:200}),t.initTab(),o.icon_id){var n=t._getTabIdByCategory(o.category_id);t._selected_icon_name=o.icon_id,t._showTab(n,o.icon_id)}else t._showTab(t._getDefaultIndex(t.defaultCategoryId));$.stats.track("\u5370\u8BB0\u4E2D\u5FC3\u6D6E\u5C42","icon_system")},closeIconBook:function(){var o=this;o._tip&&o._tip.closeTip(),o._icon_book&&(o._icon_book.closeCard(),o._icon_book=null)},initTab:function(){var o=this;o.tabLen=$(".icon_book_tab_head li").length,o._bindHeadEvents()},_bindHeadEvents:function(){var o=this;$(".icon_book_tab_head").delegate("li","click",function(){var e=$(this).index();o._showTab(e),o._tip&&o._tip.hideTip()}),$(".icon_book_close").click(function(){return $("#icon_book_tab").remove(),o._tip&&(o._tip.hideTip(),o._tip=null),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),!1}),$(".icon_book_close").hover(function(){$(this).addClass("icon_book_close_hover")},function(){$(this).removeClass("icon_book_close_hover")})},_showTab:function(o,e){var t=this;$(".icon_book_tab_head .head_inner").each(function(){!$(this).hasClass("space")&&$(this).parent().index()<t.tabLen-1&&$(this).addClass("space")}),0>o?"0":$("#tab_head_"+(o-1)+" div.space").removeClass("space"),$(".icon_book_tab_head li.tab_active").removeClass("tab_active").addClass("tab_deactive"),$("#tab_head_"+o).removeClass("tab_deactive").addClass("tab_active"),$(".icon_book_tab_body div.tab_body_item_active").removeClass("tab_body_item_active"),$("#tab_content_"+o).addClass("tab_body_item_active"),e=e||t._selected_icon_name,t._loadTabContent(o,e),t._current_tab_index=e},_loadTabContent:function(o,e){var t=this,_='<div class="icon_book_error">\u6B63\u5728\u52AA\u529B\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>';$("#tab_content_"+o).html(_);var a={ie:"utf-8"},i=$("#tab_head_"+o).tbattr("data-categoryId");a.tbs=PageData.tbs,a.category_id=i,t._icon_book_ajax&&t._icon_book_ajax.abort(),t._icon_book_ajax=$.ajax({type:"post",url:"/icon/submit/icon",data:a,dataType:"json"}).success(function(_){if(_&&0===_.no){var a=_.data,n=a.icon_info,c=t._view.getTabContent(n,e,i);$("#tab_content_"+o).html(c),t._bindTabContenEvent(o),t.initScroll(o),t._icon_tab_loaded[o]=!0,t._icon_info["category_"+o]=a.icon_info}else{var c='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$("#tab_content_"+o).html(c),$("#icon_book_reload").on("click",function(){return t._loadTabContent(o),!1})}})},_bindTabContenEvent:function(){var o=this;o._tip||(o._tip=o.use("user/widget/Icons/IconsBookTip",[o]));var e=$("#icon_book_wrap");e.on("mouseenter",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").addClass("icon_border_hover")}).on("mouseleave",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").removeClass("icon_border_hover")}),e.delegate(".icon_wrap .icon_box_place","mouseenter",function(){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.normal||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}),e.delegate(".icon_view","mouseleave",function(){setTimeout(function(){o._tip&&o._tip.hideTip&&o._tip.hideTip()},1500)}),e.delegate(".collect_icon_wrap .icon_box_place","mouseenter",function(){if(!($(this).children(".icon_locked").length>0)){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.advanced||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}}),e.delegate(".collect_icon_wrap .icon_box_place","mouseleave",function(){setTimeout(function(){o._tip.hideTip()},6e3)})},_getTabIdByCategory:function(o){for(var e=this,t=$(".icon_book_tab_head li"),_=0;_<t.length;_++)if($(t[_]).tbattr("data-categoryId")==o)return _;return e._getDefaultIndex(e.defaultCategoryId)},_getDefaultCategoryId:function(o){var e="";for(var t in o)e=t;return e},_getDefaultIndex:function(o){for(var e=$(".icon_book_tab_head li"),t=0;t<e.length;t++)if($(e[t]).tbattr("data-categoryId")==o)return t},initScroll:function(o){var e=this,t=$("#tab_content_"+o+" .icon_wrap");t&&t.length>0&&e.bindArrowScrollEvent("icon_wrap");var _=$("#tab_content_"+o+" .collect_icon_wrap");_&&_.length>0&&e.bindArrowScrollEvent("collect_icon_wrap")},bindArrowScrollEvent:function(o){var e=this;$("."+o).delegate(".icon_wrap_scroll_arrow","hover",function(){$(this).hasClass("arrow_disable")||$(this).toggleClass("arrow_hover")}),$("."+o).delegate(".right_arrow","click",function(){e._move("left",o),e._tip&&e._tip.hideTip()}),$("."+o).delegate(".left_arrow","click",function(){e._move("right",o),e._tip&&e._tip.hideTip()})},_move:function(o,e){var t=this,_=0,a=$($(".tab_body_item_active ."+e+" .icon_view")[0]).tbattr("total-col");switch(a=parseInt(a),o){case"left":_=t._moveLeft(a,e);break;case"right":_=t._moveRight(a,e)}_&&$(".tab_body_item_active .icon_wrap .icon_list").animate({left:_},300);var i=55*a;_&&(_=Math.abs(parseInt(_)),_+550>=i?($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").addClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")):($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")),0==_&&($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").addClass("arrow_disable")))},_moveLeft:function(o,e){var t=0,_=o;if(!(10>=_)){var a=55*_,i=$(".tab_body_item_active ."+e+" .icon_list").css("left"),n=Math.abs(parseInt(i));n%55!=0&&(n=n%55*55);var c=a-n;if(c>550)return t=n+165,"-"+t+"px"}},_moveRight:function(o,e){var t=0,_=o;if(!(10>=_)){var a=$(".tab_body_item_active ."+e+" .icon_list").css("left"),i=parseInt(a);if(!(i>=0))return t=Math.abs(i)-165,0>t&&(t=0),"-"+t+"px"}},closeAllCard:function(){var o=this;o._tip&&o._tip.closeTip(),o._messagebox&&o._messagebox.hideBox(),o.closeIconBook(),o._removeIconRefresh()},_setIconRefresh:function(o){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),o.children(".j_icon_slot_refresh").addClass("icon_slot_refresh")},_removeIconRefresh:function(){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}}});
;_.Module.define({path:"user/widget/Icons/IconsBookGetIcon",requires:["IconsBookCommon"],sub:{_dialog:null,initial:function(){this.common=this.use("IconsBookCommon")},get:function(){return this._dialog},show:function(){this._dialog.show()},hide:function(){this._dialog.hide()},close:function(){this._dialog.close()},_init:function(o){var i={modal:!0,showTitle:!1,fixed:!0,width:290,height:180},n=this;i.html='<div class="icon_book_dialog_wrap">'+o+"</div>",this._dialog=new $.dialog(i),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").click(function(o){o.preventDefault(),n._dialog.close()}),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},getOneIcon:function(o){var i=this;if(!o)return void i._handleError();var n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;if(!n.icon_info)return void i._handleError();i.showOneIcon(n.icon_info)}else o&&2380009===o.no?$.dialog.alert("\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01"):i._handleError()})},_handleError:function(){var o=this,i=o._getErrorTpl();o._init(i),o.show(),this._dialog.element.find(".icon_book_dialog_wrap .ui_btn").click(function(){$.tb.location.reload()})},showOneIcon:function(o){var i=this,n=i._getOneIconTpl(o);i._init(n),i.show()},_getOneIconTpl:function(o){if(o){var i=this._getIconStyle(o),n={styleBg:i,iconTitle:o.title},s=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86#{iconTitle}</div>','<div class="icon_msgbox_get_icon">','<div class="msg_icon_get_one" style="left:110px;background: #{styleBg}"></div>','<div class="msg_icon_get_two"></div>','<div class="msg_icon_get_three"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return $.tb.format(s,n)}},showDurationIcon:function(o,i){var n=[];n.push(o),this.showIconList(n,i,"duration")},showIconList:function(o,i,n){var s=this,t={hide_btn:!1,close_callback:function(){},close_time:0};t=$.extend(t,i);var c=s._getIconListTpl(o,t.hide_btn,n);s._init(c),s.show(),t.close_time&&parseInt(t.close_time)>0&&setTimeout(function(){s._dialog.close()},parseInt(t.close_time)),t.close_callback&&"function"==typeof t.close_callback&&s._dialog.onclose(function(){t.close_callback()})},_getIconListTpl:function(o,i,n){var s=this,t=PageData.user.portrait;if(o||$.isArray(o)){for(var c=[],a=[],e="",_=i?"":['<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>"].join(""),l=0;l<o.length;l++){var d=s._getIconFormatInfo(o[l],o.length);c.push(d.iconTitle),a.push(d.iconTpl)}if(c=c.join(","),a=a.join(""),n&&"duration"==n){var r=this.common.getIconExpired(o[0]);r>-1&&(e="<span>\u6709\u6548\u5929\u6570\uFF1A"+r+"</span><br>")}var g=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86'+c+"</div>",'<div class="icon_msgbox_get_icon clearfix">',a,"</div>",_,'<p class="icon_book_go_home">',e,'<a href="/home/main?id='+t+'&fr=icon" target="_blank">\u53BB\u6211\u7684\u4E2A\u4EBA\u4E2D\u5FC3\u67E5\u770B>></a>',"</p>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return g}},_getIconFormatInfo:function(o,i){var n=this._getIconStyle(o),s={iconTpl:'<div class="msg_icon_get msg_icon_get_'+parseInt(i)+'" style="left:110px;'+n+'"></div>',styleBg:n,iconTitle:o.title};return s},_getIconStyle:function(o){var i=0,n=0,s="//tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png",t=o.sprite[o.value].split(","),c=50,a=t[0],e=t[1];i=2*c,n=e*c;var _="background: url("+s+"?stamp="+a+") no-repeat -"+n+"px -"+i+"px;";return _},_getErrorTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u672A\u77E5\u9519\u8BEF</div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;">',"<span><em>\u5237\u65B0</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return o}}});
;_.Module.define({path:"user/widget/Icons/IconsBookTip",requires:["IconCard","IconsBookMessagebox","IconsBookCommon"],sub:{_icon_book_tip:null,_icon_data:null,_ajax:null,_control:null,_msgbox:null,_option:{width:"535px"},_is_show:!1,spriteImgSize:36,initial:function(o){var i=this;i.common=this.use("IconsBookCommon"),i._control=o[0]},getControl:function(){return this._control},showTip:function(o,i){if(o){var n=this,t=$("#icon_book_tip");0==t.length&&$(".icon_card_wrap").append(this._getWrapTpl()),t=$("#icon_book_tip"),n._setContent(o);var e=$(".j_icon_book_tip .j_tip_up_arrow"),s=i.position(),a=s.top,c=s.left-5,r=i.parents(".icon_view"),p=r.position(),l=parseInt(p.left)+15,d=a+106;i.parents(".collect_wrap").length>0&&(d+=146),t.css({display:"block",visibility:"visible",top:d+"px",left:l+"px","z-index":2e4});var u=parseInt(c)+25;e.css({left:u+"px"}),n._bindEvents(),$(".icon_book_tip .j_tip_icon_price").html("\u6D88\u8017"+o.icon_info.price+"T\u8C46"),n._icon_data=o,$("#j_icon_book_action_btn").one("click",function(){var i=!0,t=0,e=PageData.user.Parr_scores;e&&(t=e.scores_other+e.scores_money);var s=-1;if(s=n._icon_data.price?n._icon_data.price:n._icon_data.icon_info.price,s>0&&0>t-s&&(i=!1,$(".icon_book_tip .icon_action_wrap").html(n._getNoRemainTip()),$("#j_icon_book_recharge_btn").click(function(){_.Module.use("common/widget/TchargeDialog")})),o.in_use)1==parseInt(o.slot_no)?n._replaceIcon4FirstSlot(o):n._replaceIcon4OtherSlot(o);else if(i){var a=$("#j_icon_book_action_btn em");a.length>0&&a.html("\u8D2D\u4E70\u4E2D"),n._buyIconRequest(o)}})}},hideTip:function(){var o=this;o._is_show||o.closeTip()},closeTip:function(){tip=$("#icon_book_tip"),(tip||0!=tip.length)&&tip.remove()},_bindEvents:function(){var o=$("#icon_book_tip"),i=this;o.bind("mouseenter",function(){i._is_show=!0}).bind("mouseleave",function(){i._is_show=!1,i.hideTip()})},_replaceIcon4FirstSlot:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showReplaceFirstSlotBox(o,n,i._replaceIcon4OtherSlot,i)},_replaceIcon4OtherSlot:function(o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o.icon_id,n.slot_no=o.slot_no,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;i._refreshAfterReplace(n.icon_info)}else o&&2270028===o.no?(i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou()):$.dialog.alert(o&&2380009===o.no?"\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01":"\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01")})},_refreshAfterReplace:function(){var o=this;setTimeout(function(){o.closeTip()},0),o._msgbox||(o._msgbox=o.use("user/widget/Icons/IconsBookMessagebox")),o._msgbox.replaceIconSuccess(o)},_buyIcon:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showBuyIconBox(o,n,i._buyIconRequest,i)},_buyIconRequest:function(o){var i=this,n={ie:"utf-8"};n.tbs=$.getPageData("tbs"),n.icon_name=o.icon_id,n.level=o.value,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:n,dataType:"json"}).success(function(o){o&&0===o.no?i.common.redirect(o.data,"\u5370\u8BB0\u4E2D\u5FC3TIP",function(o){var t=$.getPageData("user.Parr_scores",{});t.scores_total=$.getPageData("data.data.user_info.scores",0,o),console.log(o),$(".j_userinfo_scores_num").html(t.scores_total);var e=$(".icon_box_place[data-id="+n.icon_name+"]");e.removeClass("icon_not_use"),e.find(".j_icon_subscript").removeClass("icon_locked"),i.closeTip()}):o&&2270028===o.no?(i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou()):$.dialog.alert("\u7CFB\u7EDF\u9519\u8BEF, \u8BF7\u7A0D\u5019\u518D\u8BD5")})},_refreshAfterBuy:function(o){this._refreshAfterReplace(o)},_setContent:function(o){var i=this._getTpl(o);$("#icon_book_tip").html(i)},_getWrapTpl:function(){var o=['<div id="icon_book_tip" class="icon_tip_card_wrap">',"</div>"].join("");return o},_getNoRemainTip:function(){var o=['<div class="icon_action" style="padding-top: 10px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: block">T\u8C46\u4E0D\u8DB3</div>','<a href="javascript:void(0)" id="j_icon_book_recharge_btn" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getTpl:function(o){var i=this,n=o.icon_info,t=n.sprite[n.value].split(","),e=50,s=t[0],_=t[1],a=0,c=_*e,r="//tb1.bdstatic.com/tb/cms/com/icon/"+n.category_id+"_"+i.spriteImgSize+".png",p=" background:url("+r+"?stamp="+s+") no-repeat -"+c+"px -"+a+"px;",l="",d=i.common.getIconExpired(n);d>-1&&(l='<span style="margin-left: 20px;">\u5269\u4F59\u65F6\u95F4\uFF1A'+d+"\u5929</span>");var u=n.title,b=n.intro,g=n.intro_url,m={background_img:p,desc_title:u+l||"\u5370\u8BB0",desc_detail:b||"",desc_link:g||"//tieba.baidu.com/",btn_value:o.in_use?"\u66FF\u6362":"\u8D2D\u4E70",price_info_display:1==o.in_use?"none":"block",padding_top:o.in_use?"20":"10",in_use_display:"none",in_use_text:"",button_display:0==o.in_use&&0==n.price?"none":"block"};i._judgeCommIconInSlot(o.icon_id)&&(m.button_display="none"),"none"==m.button_display&&(m.in_use_display="display",m.in_use_text="\u4F7F\u7528\u4E2D",m.price_info_display="none"),0==o.in_use&&0==n.price&&(m.in_use_text="\u6D3B\u52A8\u83B7\u53D6");var v=['<div class="icon_book_tip j_icon_book_tip">','<div class="tip_up_arrow j_tip_up_arrow"></div>','<div class="tip_body">','<div class="tip_icon">','<div class="tip_icon_img" style="#{background_img}}"></div>',"</div>",'<div class="icon_desc">','<div class="icon_desc_title"><span>#{desc_title}</span></div>','<div class="icon_desc_detail"><span>#{desc_detail}</span><a href="#{desc_link}"  target="_blank"><span style="padding-left:5px;">\u8BE6\u60C5 >></span></a></div>',"</div>",'<div class="icon_action_wrap">','<div class="icon_action" style="padding-top:#{padding_top}px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: #{price_info_display}"></div>','<div class="j_tip_icon_use tip_icon_use" style=" margin-bottom:5px;display: #{in_use_display}">#{in_use_text}</div>','<a href="javascript:void(0)" id="j_icon_book_action_btn" class="ui_btn ui_btn_m icon_book_action_btn" style="height: 27px; border-radius: 3px;display: #{button_display}"><span><em>#{btn_value}</em></span></a>',"</div>","</div>","</div>","</div>"].join("");return $.tb.format(v,m)},_judgeCommIconInSlot:function(o){var i={};for(var n in i){var t=this.common.isShowDurationIcon(i[n]);if(i[n].name==o&&t)return!0}return!1}}});
;_.Module.define({path:"user/widget/Icons/IconsBookView",requires:["IconsBookTip","IconsBookCommon"],sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96C6\u9F5032\u4E2A\u56FD\u65D7\u5370\u8BB0\u5956\u52B1\u3010\u8D34\u5427\u4E16\u754C\u676F\u3011\u5370\u8BB0",102:"\u96C6\u9F5012\u4E2A\u661F\u5EA7\u5370\u8BB0\u53EF\u4EE5\u83B7\u5F9712\u4E2A\u9EC4\u91D1\u7248\u661F\u5EA7\u5370\u8BB0",103:"",104:""},spriteImgSize:36,initial:function(){},_getTabPanelTpl:function(){var o=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return o},getTabItem:function(o){var i=this,t=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join(""),n=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join(""),a="",c="",l=0;for(var e in o)l++;var r=0;for(var e in o){var s={index:r,category_id:e,title:o[e].name,separator_cls:r==l-1?"":"space"};r++,a+=$.tb.format(t,s),c+=$.tb.format(n,s)}var _={tabHead:a,tabContent:c},d=i._getTabPanelTpl();return $.tb.format(d,_)},getTabContent:function(o,i,t){var n="",a="",c=this,l=0,e=0;if(o=o||{},o.normal&&!o.advanced){var r=o.normal||[],s=r.length;return l=5,e=1>=s/50?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a}if(o.advanced&&o.advanced){var r=o.normal||[],_=o.advanced||[],s=r.length,d=_.length,v="";return l=2,e=1>=s/20?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a+=c._getDownArrowHtml(),e=1>=d/20?10:s%2==0?Math.floor(d/2):Math.floor(d/2)+1,v+=c._getPositionIconListHtml(_,e,null,t),a+=c._getAdvancedIconWrap(null,l,e,v,t),c.tabIconsContentCongfig.adv={row:l,col:10,total_col:e},a}return a},_getCommIconWrap:function(o,i,t,n){var a={arrow_top:5==i?100:45,arrow_visiblity:t>10?"visible":"hidden",height_cls:5==i?"icon_wrap_5":"",icon_list:n,total_col:t},c=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(c,a)},_getAdvancedIconWrap:function(o,i,t,n,a){var c=this,l={title:c._collect_icon_title[a],arrow_visiblity:t>10?"visible":"hidden",icon_list:n,total_col:t},e=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(e,l)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,i,t,n){for(var a="",c=this,l=!1,e=o.length,r=0,s=0,_=0;e>_;_++){r=Math.floor(_/i),s=_%i;var d=55*r,v=55*s;l=t&&t==o[_].name?!0:!1;var b="";b=0==o[_].is_advanced?c._getCommonIconTpl(o[_],d,v,n,l):c._getAdvIconTpl(o[_],d,v,n),a+=b}return a},_getCommonIconTpl:function(o,i,t,n,a){var c=this,l=o.sprite[o.value].split(","),e="//tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+c.spriteImgSize+".png",r=50,s=l[0],_=l[1],d=0,v=_*r,b="background: url("+e+"?stamp="+s+") no-repeat -"+v+"px -"+d+"px;",p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,in_use_cls:1==o.in_use?"":" icon_not_use",selected_cls:a?" icon_selected":"",level:o.value,background:b,locked_cls:0==o.in_use?" icon_locked":""};c._judgeCommIconInSlot(o)&&(p.selected_cls="icon_selected");var u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="j_icon_subscript icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeCommIconInSlot:function(o){var i=this,t=o.name,n={};for(var a in n){if("1"==a&&$.isEmptyObject(n[a])){var c=this._getOldIconinfoInSlot();if(t==c)return!0}if(n[a].name==t){i.common=this.use("IconsBookCommon");var l=i.common.isShowDurationIcon(o);return l?!0:!1}}return!1},_getOldIconinfoInSlot:function(){var o=$(".j_icon_slot").first();if(o){var i=o.tbattr("data-slot");return i}return null},_getAdvIconTpl:function(o,i,t,n){var a=this,c=o.sprite[o.value].split(","),l=50,e=c[0],r=c[1],s=2*l,s=0,_=r*l,d="//tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+a.spriteImgSize+".png",v="background: url("+d+"?stamp="+e+") no-repeat -"+_+"px -"+s+"px;",b=o.is_collected,p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,clocked_cls:1==b?" ":" icon_locked",level:o.value,background:v},u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeAdvIconLocked:function(o,i){var t=!1;switch(i=parseInt(i)){case 101:break;case 102:if(o){for(var n=0;n<o.length;n++)if(!o[n].in_use){t=!0;break}t=12==n&&0==t?!1:!0}else t=!0;break;case 103:break;case 104:}return t}}});
;_.Module.define({path:"user/widget/Icons/IconsBookMessagebox",requires:["IconCard","IconsBookCommon"],sub:{_icon_book_message_box:null,_icon_data:null,_is_show:!1,_option:{width:290},is_leave_close:!1,spriteImgSize:36,setLeaveClose:function(o){this.is_leave_close=o},initial:function(){this.common=this.use("IconsBookCommon")},showBox:function(o,i){var s=this;s._showBox(i),s.generatorBuySlot(o),s._bindEvents()},hideBox:function(){var o=this;o._is_show||o._icon_book_message_box&&(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null)},_bindEvents:function(){var o=this,i=$(".icon_card_wrap");i.bind("mouseenter",function(){o.is_leave_close&&(o._is_show=!0)}),i.bind("mouseleave",function(){o.is_leave_close&&(o._is_show=!1,o.hideBox())})},generatorBuySlot:function(o){var i=this,s=i._getBuySlotTpl(o);$(".icon_book_msgbox_body").html(s),$(".icon_book_msgbox .ui_btn").one("click",function(){i.buySlot(o)})},showReplaceFirstSlotBox:function(o,i,s,n){var _=this;setTimeout(function(){n.closeTip()},0),_._showBox(i);var c=_._getReplaceFirstSlotTipTpl(o);$(".icon_book_msgbox_body").html(c),$(".icon_book_msgbox .ui_btn").click(function(){s.call(n,o)})},showBuyIconBox:function(o,i,s,n){var c=this;setTimeout(function(){n.closeTip()},0),c._showBox(i);var e=c._getBuyIconTpl(o);$(".icon_book_msgbox_body").html(e),$(".icon_book_msgbox .ui_btn").click(function(){var i=0,e=PageData.user.Parr_scores;if(e&&(i=e.scores_other+e.scores_money),i-o.icon_info.price<0){var t=c._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(t),void $(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})}s.call(n,o.icon_info,function(){var o=c._buyIconSuccess();$(".icon_book_msgbox_body").html(o)})})},buySlot:function(o){var i=this,s=0,n=$.getPageData("user.Parr_scores",{});n&&(s=n.scores_other+n.scores_money+n.scores_fetch);var c=o.price||o.icon_info.price;if(c>0&&0>s-c){var e=i._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(e),void $(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})}var t={ie:"utf-8",slot_no:o.add_slot_no||1};t.tbs=PageData.tbs,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/addslot",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no)i.common.redirect(o.data,"\u5370\u8BB0\u4E2D\u5FC3\u5361\u7247",function(o){var s=i._addSuccess();$(".icon_book_msgbox_body").html(s),i._refreshSlotList();var n=$.getPageData("data.data.user_info.scores",0,o);i._updateTdouAccount(0,n,0)});else if(o&&2270028===o.no)i.hasNotEnoughTdou();else{var s='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$(".icon_book_msgbox_body").html(s),$("#icon_book_reload").on("click",function(){return $.tb.location.reload(),!1})}})},_updateTdouAccount:function(o,i,s){var n=PageData.user.Parr_scores;n&&(n.scores_other=o,n.scores_money=i,n.scores_fetch=s,$(".j_userinfo_scores_num").html(o+i))},_showBox:function(o){var i=this;i.hideBox();var s=i._getTpl(),n={content:s,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:o,attr:"id='icon_book_message_box'",wrap:$("body")};i._icon_book_message_box=i.use("user/widget/Icons/IconCard",n),i._icon_book_message_box.showCard({type:"delayShow",time:200}),i._bindCloseEvent()},_bindCloseEvent:function(){var o=this;$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){o._icon_book_message_box?(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null):$("#icon_book_message_box").length>0&&$("#icon_book_message_box").remove(),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}),$(".icon_book_msgbox .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},_getTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">',"</div>",'<div class="icon_book_msgbox_close"></div>',"</div>",'<div class="icon_book_down_arrow"></div>',"</div>"].join("");return o},_refreshSlotList:function(){var o=$(".j_icon_slot").length,i=28*o,s='<a href="javascript:void(0)" data-slot="'+(o+1)+'" data-name="" title="\u70B9\u51FB\u6DFB\u52A0\u5370\u8BB0" class="j_slot_null_icon j_icon_slot icon_slot_null_icon" style="top:0px;left:'+i+'px"><div class=" j_icon_slot_refresh"></div></a>';$(".icon_slot_wrap .icon_add_solt").css({left:28*(o+1)}),$(".icon_slot_wrap .icon_add_solt").before(s),8==$(".j_icon_slot").length&&$(".icon_add_solt").remove()},_addSuccess:function(){var o=['<div class="icon_msgbox_title"></div>','<div class="icon_msgbox_detail">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u5370\u8BB0\u63D2\u69FD</div>'].join("");return o},_buyIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u65B0\u5370\u8BB0</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u5FEB\u53BB\u56FE\u9274\u770B\u770B\u5427</em></span></a>',"</div>"].join("");return o},_replaceIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u5370\u8BB0\u66FF\u6362\u6210\u529F</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a  href="javascript:void(0)" class="ui_btn ui_btn_m j_replace_ok" style="height: 27px; border-radius: 3px;"><span><em>\u786E\u5B9A</em></span></a>',"</div>"].join("");return o},_hasNotEnoughTdou:function(){var o=['<div class="icon_msgbox_title">T\u8C46\u4E0D\u8DB3</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u7ACB\u5373\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getBuySlotTpl:function(o){var i={price:o.price},s=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u8017#{price}T\u8C46\u5F00\u542F\u5370\u8BB0\u63D2\u69FD</div>','<div class="icon_msgbox_detail" style="padding-top:15px;">(\u5F00\u542F\u540E\u514D\u8D39\u66F4\u6362\u5370\u8BB0)</div>','<div class="icon_msgbox_action" style="padding-top: 25px;">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5F00\u542F</em></span></a>',"</div>"].join("");return $.tb.format(s,i)},_getReplaceFirstSlotTipTpl:function(o){var i=this,s=o.old_icon_info,n=o.icon_info,_=this.common.isShowDurationIcon(s),c=_?i._getIconBackground(s):"",e=i._getIconBackground(n),t={old_background:c,background:e},a=['<div class="icon_msgbox_title">\u70B9\u51FB\u66FF\u6362\u5F53\u524D\u5370\u8BB0</div>','<div class="icon_msgbox_icon_replace_detail">','<div class="msg_icon_replace_current" style="#{old_background}"></div>','<div class="msg_icon_replace_arrow"></div>','<div class="msg_icon_replace_new" style="#{background}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px"><span><em>\u66FF\u6362</em></span></a>',"</div>"].join("");return $.tb.format(a,t)},_getIconBackground:function(o){var i=0,s=0,n="//tb1.bdstatic.com/tb/cms/com/icon/"+o.category_id+"_"+this.spriteImgSize+".png";if(o){var _=o.sprite[o.value].split(","),c=50,e=_[0],t=_[1];i=0,s=t*c;var a="background: url("+n+"?stamp="+e+") no-repeat -"+s+"px -"+i+"px;";return a}return""},_getBuyIconTpl:function(o){var i=this,s=i._getIconBackground(o.icon_info),n={price:o.icon_info.price,background:s},_=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u801710000T\u8C46\u8D2D\u4E70\u8BE5\u5370\u8BB0</div>','<div class="icon_msgbox_icon_buy">','<div class="msg_icon_buy_icon" style="#{background}}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u8D2D\u4E70</em></span>","</a>","</div>"].join("");return $.tb.format(_,n)},hasNotEnoughTdou:function(o){var i=this;o||(o=$(".icon_wrap .j_icon_slot_refresh")),i._showBox(o);var s=i._hasNotEnoughTdou();$(".icon_book_msgbox_body").html(s),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})},replaceIconSuccess:function(o){var i=this,s=$(".icon_wrap .icon_slot_refresh");s&&(s=s.parent()),i._showBox(s);var n=i._replaceIconSuccess();if($(".icon_book_msgbox_body").html(n),$(".icon_book_msgbox_body .j_replace_ok").on("click",function(){$.tb.location.reload()}),$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){$.tb.location.reload()}),o){var _=o.getControl();_&&_.closeIconBook()}}}});
;_.Module.define({path:"user/widget/Icons/IconsBookCommon",requires:["common/widget/Tdou/TdouViewPay"],sub:{initial:function(){},isDurationIcon:function(e){return e&&4==e.type?!0:!1},getIconExpired:function(e){var n=-1;if(!e)return n;var r=e.type,t=e.end_time,o=Env.server_time/1e3;return 4==r&&t>=o&&(n=((t-o)/86400).toFixed(1)),n},redirect:function(e,n,r){e=e||{},e.from=n,e.chargeType="platform";var t=this;t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&r(e)}),t.payment.createMain(e)},isShowDurationIcon:function(e){if(!e)return!1;var n=e.type,r=e.end_time,t=Env.server_time/1e3;return 4!=n?!0:r>=t?!0:!1}}});
;_.Module.define({path:"user/widget/Icons/IconCard",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="icon_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show,this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/widget/baseDialogUserBar",requires:["common/widget/baseUserData","common/widget/Icons"],sub:{tpl:'<div class="base_dialog_user_bar base_user_data">      <%if(!is_tdou_info_display){%>          <div class="header_title_member">              <span>\u73A9\u8D34\u5427 \u4EAB\u7279\u6743</span>          </div>      <%}else{%>            <div class="header_title">              <span class="header_icon"></span>              <span>                  <%=title%>              </span>          </div>          <div class="user_info">              <span class="title_acc">\u8D26\u53F7\uFF1A                  <%= userIcon %>                      <a class="title_acc_name <%=member_red%> ">                          <%=user_name%>                      </a>              </span>              <span class="tdou_remain">T\u8C46\u4F59\u989D\uFF1A                  <span class="tdou_remain_num">                      <span class="user_tdou_icon"></span>                      <span class="j_tdou">                          <%=tdou_num%>                      </span>                  </span>              </span>          </div>      <%}%>            <a class="header_close j_header_close"></a>  </div>',initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon(),this.icon=this.requireInstance("user/widget/Icons")},getUserBarTemplate:function(e){var a=this,s="",r=!0;e&&"getmember"==e?(s=a.member.action_title,r=!1):s="\u83B7\u53D6T\u8C46";var t="";("ordinary_member_icon"==$.trim(a.member.icon)||"super_member_icon"==$.trim(a.member.icon))&&(t=" member_red ");var i=this.icon.getPreIconHtml($.getPageData("user.mParr_props"),$.getPageData("user"),!0),n={user_name:a.dataProxy.getUserName(),tdou_num:a.dataProxy.getUserTdou(),member:a.member.icon,member_red:t,title:s,is_tdou_info_display:r,userIcon:i},m=window._.template(a.tpl,n);return m}}});_.Module.define({path:"common/widget/qianbaoPurchaseMember",requires:["common/widget/qianbaoCashierDialog","common/widget/baseUserData","common/widget/baseDialogUserBar"],sub:{$root:null,memberOptions:null,id:"qianbao_purchase_member",carouselA:null,carouselB:null,target:"",size:"",defaultA:"",defaultB:"",is_autopay:"",initial:function(){var e=this;window.pageUnit=window.pageUnit||{};var t=window.pageUnit;t[this.id]||(t[this.id]=$.ajax({url:"/theme/getPage",type:"GET",data:{id:["qianbao_purchase_member_hot_message","qianbao_purchase_member_member_types"]},dataType:"json"}).done(function(i){i=i.data||{},t[e.id]={hotMessage:i.qianbao_purchase_member_hot_message||"\u8FD8\u7B49\u4EC0\u4E48\u5347\u7EA7\u5E74\u8D39\u4F1A\u5458\uFF0C\u7ECF\u9A8C\u589E\u957F\u66F4\u5FEB\uFF01",memberTypes:i.qianbao_purchase_member_member_types||"super, normal"},t[e.id].memberTypes=t[e.id].memberTypes.split(/\s*,\s*/g)}).fail(function(){t[e.id]={hotMessage:"\u8FD8\u7B49\u4EC0\u4E48\u5347\u7EA7\u5E74\u8D39\u4F1A\u5458\uFF0C\u7ECF\u9A8C\u589E\u957F\u66F4\u5FEB\uFF01",memberTypes:["super","normal"]}})),e.cashierDialog=e.requireInstance("common/widget/qianbaoCashierDialog"),e.baseData=e.requireInstance("common/widget/baseUserData"),e.baseDialogUserBar=this.requireInstance("common/widget/baseDialogUserBar"),e.vip3Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-plus-vip3_487ffa0.png",e.vip4Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-plus-vip4_23cb1b2.png",e.icon1Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_super_first_pc_27ff0ed.png",e.icon2Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_super_second_pc_39a5284.png",e.icon3Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_super_third_pc_614294d.png",e.icon4Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_normal_first_pc_9e02559.png",e.icon5Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_normal_second_pc_ca769da.png",e.icon3Tip="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_attention_pc_f71bce9.png",e.return_url=e.cashierDialog.getPageUrl(),e.cashierDialog.bind("event_tdou_qianbao_pay_again",e.payAgain,e)},memberInit:function(){$.ajax({type:"GET",url:"/tbmall/member/recharge",cache:!1,dataType:"json"}).success(function(e){if(0==e.no){var t=e.user.name;if(e.goods_info.member){var i=e.goods_info.member.money_info;$(".j_list_1050001").html("");for(var a=0;a<i.length;a++){var o=i[a].discount?i[a].discount:"",n=1==i[a].default?" selected":"",s=i[a].tag_name?'<div class="tag_name">'+i[a].tag_name+"</div>":"";$(".j_list_1050001").append('<li class="time_item j_order_update j_time_item j_vip_month_'+i[a].months+n+'">'+s+'<div class="time-type vip_money" for="vip_money_'+i[a].months+'" id="vip_money_'+i[a].months+'" data-value='+i[a].months+n+'><div class="money_icon"></div>'+i[a].money/100+'</div><div class="time-type vip_des" for="vip_des_'+i[a].months+'" id="vip_des_'+i[a].months+'" data-value="'+i[a].months+'">'+o+'</div><div class="time-type vip_month" for="vip_month_'+i[a].months+'" id="vip_month_'+i[a].months+'" data-value='+i[a].months+">"+i[a].months+"\u4E2A\u6708</div></li>")}}else $(".j_type_1050001").css("display","none");if(e.goods_info.adv_member){var r=e.goods_info.adv_member.money_info;$(".j_list_1050002").html("");for(var a=0;a<r.length;a++){var o=r[a].discount?r[a].discount:"",n=1==r[a].default?" selected":"",s=r[a].tag_name?'<div class="tag_name">'+r[a].tag_name+"</div>":"",c=2==r[a].goods_type?"is_autopay_1":"",m=1==r[a].has_autopay_goods?"has_autopay_goods_"+r[a].months:"";$(".j_list_1050002").append('<li class="time_item '+c+" "+m+" j_order_update j_time_item j_vip_month_"+r[a].months+n+'" data-isAutoplay='+r[a].is_autopay+">"+s+'<div class="time-type '+m+' vip_money" for="vip_money_'+r[a].months+'" id="vip_money_'+r[a].months+'" data-value='+r[a].months+n+'><div class="money_icon"></div>'+r[a].money/100+'</div><div class="time-type '+m+' vip_des" for="vip_des_'+r[a].months+'" id="vip_des_'+r[a].months+'" data-value="'+r[a].months+'">'+o+'</div><div class="time-type '+m+' vip_month" for="vip_month_'+r[a].months+'" id="vip_month_'+r[a].months+'" data-value='+r[a].months+">"+r[a].months+"\u4E2A\u6708</div></li>")}}else $(".j_type_1050002").css("display","none");$(".member-info .user-name").html(t)}})},carouselIcon:function(e,t){function i(e,t){s=1,c++,o(c,t),c==t&&($(".slide-div ."+e+"-icon").css("left",0),c=1),$(".slide-div ."+e+"-icon").stop().animate({left:-c*r},1e3);setTimeout(function(){s=0},1e3)}function a(e,t){s=1,c--,o(c,t),-1==c&&($(".slide-div ."+e+"-icon").css({left:-(t-1)*r}),c=t-2),$(".slide-div ."+e+"-icon").animate({left:-c*r},1e3);setTimeout(function(){s=0},1e3)}function o(e,t){0==e||e==t-1?$(".button-left").addClass("no-optional"):$(".button-left").removeClass("no-optional"),e==t-2?$(".button-right").addClass("no-optional"):$(".button-right").removeClass("no-optional")}var n=this,s=0;n.target=e,n.size=t,$(".slide-div ."+e+"-icon").css("left","0");var r=300,c=0;$(".j_qianbao_cashier_dialog").off("click").on("click",".button-left",function(){$(this).hasClass("no-optional")||0!=s||a(n.target,n.size)}).on("click",".button-right",function(){$(this).hasClass("no-optional")||0!=s||i(n.target,n.size)})},payAgain:function(){var e=this;e.showDialog(e.memberOptions)},showDialog:function(e){var t=this;t.product=e.product||"member",t.memberOptions=e,t.member=t.baseData.getMemberIcon();$.now(),new Date("2018-07-10 00:00:00").getTime(),new Date("2018-08-31 24:00:00").getTime();t.initMemberId="1050002",t.initMemberCount="3",t.is_autopay="0",t.getPayMemberOrder(t.initMemberId,t.initMemberCount,t.is_autopay,function(e){var i={qianbao_params:e};t.showMember(i);var a=t.cashierDialog.getParams(e);t.orderId=a.orderId})},showMember:function(e){var t=this,i=window.pageUnit;if(i[this.id].done)return void(i[this.id]=i[this.id].done(function(){t.showMember(e)}));e.hotMessage=e.hotMessage||i[this.id].hotMessage,e.memberTypes=e.memberTypes||i[this.id].memberTypes;var a=e.qianbao_params||"",o=$.extend(e,{baseDialogUserBarTpl:t.baseDialogUserBar.getUserBarTemplate("getmember"),vip3Src:t.vip3Src,vip4Src:t.vip4Src,icon1Src:t.icon1Src,icon2Src:t.icon2Src,icon3Src:t.icon3Src,icon4Src:t.icon4Src,icon5Src:t.icon5Src,icon1Tip:t.icon1Tip,icon2Tip:t.icon2Tip,icon3Tip:t.icon3Tip,type_1050001:2==t.member.level||-2==t.member.level?" hide_type_1050001":""}),n=window.baidu.template('<!-- htmlcs-disable -->\r\n<div class="qianbao_cashier_purchase_member base_user_data">\r\n    <%- baseDialogUserBarTpl %>\r\n    <div class="member_cashier_wrap j_member_cashier_wrap" id="member_cashier_wrap">\r\n        <div class="member_wrap">\r\n            <ul class="member_list j_member_list">\r\n                <li class="member_item recommend j_order_update  j_type_1050002">\r\n                    <div class="member-type" id="ptype-1050002" data-name="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458" data-value="1050002">\r\n                        <img src="<%- vip4Src %>">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\r\n                    </div>\r\n                </li>\r\n                <li class="member_item j_order_update j_type_1050001 <%- type_1050001 %>">\r\n                    <div class="member-type" id="ptype-1050001" data-name="\u8D34\u5427\u4F1A\u5458" data-value="1050001">\r\n                        <img src="<%- vip3Src %>">\u8D34\u5427\u4F1A\u5458\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="member-info">\r\n            <div>\u5145\u503C\u8D26\u53F7\uFF1A\r\n                <span class="user-name"></span>\r\n            </div>\r\n            <div class="slide-content">\r\n                <div class="slide-title">\u5F00\u901A\u540E\u83B7\u5F97:</div>\r\n                <div class="slide-div j_slide_1050002">\r\n                    <ul class="super-icon">\r\n                        <li>\r\n                            <img src="<%- icon1Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon2Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon3Src %>">\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <div class="slide-div j_slide_1050001 no-picked" style="display: none">\r\n                    <ul class="member-icon">\r\n                        <li>\r\n                            <img src="<%- icon4Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon5Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon4Src %>">\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <ul id="controler">\r\n                    <li class="button-left no-optional"></li>\r\n                    <li class="button-right"></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n        <div class="member_time_wrap">\r\n            <ul class="time_list j_time_list j_list_1050002"></ul>\r\n            <ul class="time_list j_time_list j_list_1050001"></ul>\r\n            <div class="form-tip">\r\n                <div class="single_selection"></div>\r\n                <span>\u5230\u671F\u540E\u81EA\u52A8\u7EED\u8D39 (\u53EF\u968F\u65F6\u53D6\u6D88) </span>\r\n                <a target="_blank" href="//tieba.baidu.com/tb/viprenew_eula.html" class="rule-tip"><img src="<%- icon3Tip %>"></a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',o),s={qianbao_params:a,product:"member"},r=1;t.cashierDialog.showDialog(s,n,r,function(e){t.$root=e,t.initUI(t.initMemberId,t.initMemberCount,t.is_autopay),t.bindEvents()})},initUI:function(e,t,i){var a=this;a.selectedUI(e,t,i),a.memberInit(),a.carouselIcon("super",4)},selectedUI:function(e,t){var i=this;i.$root.find(".j_member_list li").removeClass("selected"),i.$root.find(".j_type_"+e).addClass("selected"),i.$root.find(".slide-div").css("display","none"),i.$root.find(".j_slide_"+e).css("display","block"),i.$root.find("#controler .button-left").addClass("no-optional"),i.$root.find("#controler .button-right").removeClass("no-optional"),i.$root.find(".j_time_list").css("display","none"),i.$root.find(".j_list_"+e).css("display","flex"),i.$root.find(".j_time_list li").removeClass("selected");var a=i.$root.find("#vip_month_"+t);$(".j_type_"+e).hasClass("selected")&&($(".j_type_icon").css("display","none"),$(".j_type_icon_"+e).css("display","block")),a.length?(a.parents("li.j_time_item").addClass("selected"),i.$root.find("#month-custum").val("")):i.$root.find(".j_custum_time").addClass("selected")},updatePayUI:function(e,t,i){var a=this;a.cashierDialog.showPayLoading(),e&&t&&a.getPayMemberOrder(e,t,i,function(e){a.cashierDialog.changeoPayAmount(e)})},bindEvents:function(){var e=this,t=120,i=0;e.$root.find(".single_selection").off("click").on("click",function(t){t.stopPropagation(),$(this).hasClass("picked")?($(this).removeClass("picked"),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none"),i=0):($(this).addClass("picked"),$(".j_vip_month_1").css("display","none"),$(".is_autopay_1.j_vip_month_1").css("display","block"),i=1),e.selectedUI("1050002","1",i),e.updatePayUI("1050002","1",i)}),e.$root.find(".qianbao_cashier_agreement a").on("click",function(e){e.stopPropagation(),$.stats.track("\u4ED8\u6B3E\u5F39\u7A97\u5E95\u90E8","\u5F00\u901A/\u7EED\u8D39\u4F1A\u5458\u670D\u52A1\u534F\u8BAE\u70B9\u51FB",PageData.page?PageData.page:"other","click")}),e.$root.on("click",".member_item",function(t){t.stopPropagation(),t.preventDefault();var a=$(t.target),o="",n="";o=a.data("value"),n=e.$root.find(".j_time_list li.selected .time-type").data("value"),n||(n=e.$root.find("#month-custum").val()),$(".form-tip").css("display","none"),"1050001"==o?(i=0,""!==e.defaultA?n=e.defaultA:"",e.carouselIcon("member",3),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none")):"1050002"==o&&(""!==e.defaultB?n=e.defaultB:"",e.carouselIcon("super",4)),e.selectedUI(o,n,i),e.updatePayUI(o,n,i),$.stats.track("swich_membertype_"+("1050001"==o?"\u8D34\u5427\u4F1A\u5458":"\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"),"membertype-switch",PageData.page,"click")}),e.$root.on("click",".time-type",function(t){var a="",o="",n=e.$root.find(".j_member_list li.selected .member-type");t.stopPropagation(),t.preventDefault();var s=$(t.target);e.$root.find("#month-custum").val(""),o=s.data("value"),a=n.data("value"),1050001==a&&($(".form-tip").css("display","none"),i=0),$(".single_selection").removeClass("picked"),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none"),s.hasClass("has_autopay_goods_1")?$(".form-tip").css("display","flex"):($(".form-tip").css("display","none"),i=0),e.selectedUI(a,o,i),e.updatePayUI(a,o,i),$.stats.track("choose_custom_"+o,"memberCashier",PageData.page?PageData.page:"other","click",{member_type:n.data("name")})}),e.$root.find("#month-custum").on("input propertychange",function(){var i=/^[1-9]\d*$/,a=$(this),o=a.val();(o&&!i.test(o)||i.test(o)&&o>t)&&(o=o.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),o=Math.min(t,o),0==o&&(o=1),a.val(o),e.showCustomMonthBubble());var n=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(n,o)}).on("focus",function(i){var a=$(i.target);e.$root.find(".j_time_list li").removeClass("selected"),e.$root.find(".j_custum_time").addClass("selected"),e.cashierDialog.showPayLoading();var o=a.val(),n=/^[1-9]\d*$/;(o&&!n.test(o)||n.test(o)&&o>t)&&(o=o.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),o=Math.min(t,o),0==o&&(o=1),a.val(o),e.showCustomMonthBubble());var s=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(s,o)}),e.$root.find(".j_header_close").on("click",function(){e.cashierDialog.closeDialog()}),e.$root.find(".j_vip_month_12").hover(function(){e.showMonth12Bubble()},function(){e.hideMonth12Bubble()})},getPayMemberOrder:function(e,t,i,a){var o=this,n={terminal:"pc",pay_type:1,channel:2,memberId:e,memberCount:t,pageUrl:o.return_url,fr:""};1==i?n.is_autopay=1:"",n.fr=1==i?203:129,o._getPayMemberAjax&&o._getPayMemberAjax.abort(),o._getPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/getPayUrl",data:n,cache:!1,dataType:"json"}).success(function(e){if(0==e.no)a&&a(e.data.return_url);else if(1990055==e.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var t="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),i="https://passport";$.JsLoadManager.use([i+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(t/6e4),i+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(t/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show()})},updatePayMemberOrder:function(e,t,i,a){var o=this,n={terminal:"pc",pay_type:1,channel:2,order_id:i,memberId:e,memberCount:t,pageUrl:o.return_url};o._upPayMemberAjax&&o._upPayMemberAjax.abort(),o._upPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/upOrder",data:n,cache:!1,dataType:"json"}).success(function(e){0==e.no&&a&&a(e.data)})},createBubble:function(e){var t=$.extend(e,{arrow_dir:"down",arrow_pos:{left:30},closeBtn:!1,level:1,arrowReq:!0});return new UiBubbleTipBase(t)},showMonth12Bubble:function(){var e=this;e.hideCustomMonthBubble();var t=e.$root.find(".j_vip_month_12");if(!e.bubble_month_12){var i={content:"\u4E00\u6B21\u6027\u5F00\u901A12\u4E2A\u6708\u4EE5\u4E0A\u4F1A\u5458\uFF0C\u8D60\u9001\u8FDE\u7EED\u7B7E\u5230\u53613\u5F20",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_month_12=e.createBubble(i)}e.bubble_month_12.showBubble()},hideMonth12Bubble:function(){var e=this;e.bubble_month_12&&e.bubble_month_12.hideBubble()},showCustomMonthBubble:function(){var e=this,t=e.$root.find(".j_custum_time");if(!e.bubble_custom_month){var i={content:"\u4E00\u6B21\u6027\u53EA\u80FD\u5F00\u901A120\u4E2A\u6708\u8D34\u5427\u4F1A\u5458",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_custom_month=e.createBubble(i)}e.bubble_custom_month.showBubble()},hideCustomMonthBubble:function(){var e=this;e.bubble_custom_month&&e.bubble_custom_month.hideBubble()}}});_.Module.define({path:"common/widget/payMember",requires:["common/widget/qianbaoPurchaseMember","common/widget/Tdou/TdouOpenType"],sub:{pay_member_url:"/tbmfall/getPayUrl",PayMemberUrl:"/tbmall/getMyPayType",CASHIER:1,QIANBAO:2,initial:function(){var e=this;e.cashierDialog=e.requireInstance("common/widget/cashierDialog"),e.qianbaoPayMember=e.requireInstance("common/widget/qianbaoPurchaseMember"),e.openTypeList=e.requireInstance("common/widget/Tdou/TdouOpenType",{type:"member"})},showCashier:function(e){var a=this,i=e||{};$.extend(i,{fr:i.fr||"",track:"memberpay"}),this.opt=i,a._openCtrl("dialog"),a.payType=a.QIANBAO,a.payTypeCtrl()},_openCtrl:function(e){var a=this,i=a.openTypeList.getOpenType(a.opt.scene_id);switch(e="win"===e||"dialog"===e?e:i){case"win":a.openNewWindow();break;case"dialog":}},openNewWindow:function(){this.win=window.open("")},openDialog:function(){var e=this.opt;1==this.payType?this.cashierDialog.showDialog(e):this.qianbaoPayMember.showDialog(e)},_getPayType:function(e){var a=this,i=this.opt.scene_id;e?(a.payType=e,a.payTypeCtrl()):(e=1,$.ajax({type:"GET",dataType:"json",url:a.PayMemberUrl,data:{terminal:"pc",pay_type:"member",id:i},success:function(i){0==i.no&&(e=Number(i.data.pay_type_id)||1),a.payType=e,a.payTypeCtrl()}}))},payTypeCtrl:function(){var e=this;e.openDialog()}}});_.Module.define({path:"common/widget/payment_dialog_title",requires:["common/widget/base_user_data","user/widget/icons"],sub:{initial:function(e){var s=this,t={title:"",isNameShow:!1,isTdouShow:!1,isMemberShow:!1,onClose:$.noop};s.opts=$.extend(t,e),s.$container=e.$container,s.baseUserData=s.requireInstance("common/widget/base_user_data"),s.userIcon=s.requireInstance("user/widget/icons"),s.rendTitle(),s.bindEvents()},getMemberIcon:function(){var e=window.PageData.user,s=this.userIcon.getPreIconHtml($.getPageData("mParr_props",{},e),e,!0);return s},getIsMember:function(){var e=this.baseUserData.getMemberIcon().icon,s="";return("ordinary_member_icon"==$.trim(e)||"super_member_icon"==$.trim(e)||e.indexOf("vip1-18")>0||e.indexOf("vip2-18")>0)&&(s=" member-red "),s},getUserName:function(){var e=this.baseUserData.getUserName()||"";return{name:e,formateName:e.length>8?e.slice(0,8)+"...":e}},getUserTdou:function(){return this.baseUserData.getUserTdou()||0},getTreasureNum:function(){return this.baseUserData.getUserTreasure()||0},rendTitle:function(){var e=this,s=e.opts,t=_.template('<div class="payment-dialog-title">     <h4 class="payment-dialog-title-txt"><%=title%></h4>     <div class="payment-dialog-title-user">         <%if(isNameShow){%>         <div class="user-name">             <span class="payment-user-name-title">\u5E10\u53F7\uFF1A</span><span title="<%=userName[\'name\']%>" class="orange-txt <%=memberClass%>"><%=memberIcon%><%=userName[\'formateName\']%></span>         </div>         <%}%>         <%if(isTdouShow){%>         <div class="user-tdou">             T\u8C46\u4F59\u989D\uFF1A<i class="icon-tbean"></i><span class="orange-txt"><%=userTdouNum%></span>         </div>         <%}%>         <%if(isMemberShow){%>         <div class="user-member">         </div>         <%}%>         <%if(isTreasureShow){%>         <div class="user-treasure">             \u593A\u5B9D\u5E01\uFF1A<span class="orange-txt"><%=userTreasureNum%></span>         </div>         <%}%>     </div>     <a href="javascript:;" class="payment-dialog-title-close j-payment-close"></a> </div> ')({title:s.title||"",isNameShow:s.isNameShow,isTdouShow:s.isTdouShow,isMemberShow:s.isMemberShow,isTreasureShow:s.isTreasureShow,memberClass:e.getIsMember(),userName:e.getUserName(),userTdouNum:e.getUserTdou(),memberIcon:e.getMemberIcon(),userTreasureNum:e.getTreasureNum()});e.$container&&e.$container.html(t)},bindEvents:function(){var e=this;e.$container.on("click",".j-payment-close",function(){e.opts.onClose()})}}});_.Module.define({path:"common/widget/show_dialog",sub:{initial:function(t){var e=this;e.container=t.container,e.$container=e.container.element,e.type=t.type,e.top=parseInt(e.$container.css("top"),10),e.height=e.$container.outerHeight()},show:function(){var t=this,e="show";switch(t.type){case"top-pop":t.topPop(e);break;case"bigger":t.biggerShow(e);break;default:t.showDefault(e)}},close:function(){var t=this,e="close";switch(t.type){case"top-pop":t.topPop(e);break;case"bigger":t.biggerShow(e);break;default:t.showDefault(e)}},getOriginSize:function(){var t=$(".dialogJ");if($.isEmptyObject(t))return{width:0,height:0};var e=t.eq(t.length-2);return{width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}},getEndSize:function(){return{width:this.$container.outerWidth(),height:this.$container.outerHeight(),top:this.$container.css("top"),left:this.$container.css("left")}},biggerShow:function(t){var e=this,i=e.getOriginSize(),o=e.getEndSize();"show"===t?(e.$container.css({width:i.width,height:i.height,top:i.top,left:i.left}),e.container.show(),e.$container.animate({width:o.width,height:o.height,top:o.top,left:o.left})):e.$container.animate({width:i.width,height:i.height,top:i.top,left:i.left},function(){e.container.close()})},topPop:function(t){var e=this;"show"===t?(e.$container.css({top:-(e.top+e.height)}),e.container.show(),e.$container.animate({top:e.top})):e.$container.animate({top:-(e.top+e.height)},function(){e.container.close()})},showDefault:function(t){var e=this;"show"===t?e.container.show():e.container.close()}}});_.Module.define({path:"common/widget/qianbaoPurchaseTdou",requires:["common/widget/qianbaoCashierDialog","common/widget/baseUserData","common/widget/baseDialogUserBar"],sub:{$root:null,tryOptions:null,payOptions:null,initial:function(){var a=this;a.cashierDialog=a.requireInstance("common/widget/qianbaoCashierDialog"),a.baseData=a.requireInstance("common/widget/baseUserData"),a.baseDialogUserBar=this.requireInstance("common/widget/baseDialogUserBar"),a.cashierDialog.bind("event_tdou_qianbao_pay_again",a.payAgain,a)},payAgain:function(){var a=this;a._buy_icon_ajax&&a._buy_icon_ajax.abort(),a._buy_icon_ajax=$.ajax({type:"get",url:"/tbmall/getPayUrl",data:a.tryOptions,cache:!1,dataType:"json"}).success(function(e){if(e&&1990055===e.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var o="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),i="https://passport";$.JsLoadManager.use([i+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(o/6e4),i+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(o/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else{var n=e.data;a.payOptions.qianbao_params=n.return_url,a.payOptions.iconCount=n.iconCount,a.payOptions.iconId=n.iconId,a.showDialog(a.payOptions,a.tryOptions)}})},showDialog:function(a,e){var o=this;o.tryOptions=e,o.payOptions=a,o.product=a.product||"tdou";var i=a.iconId||"suiji",n=a.iconCount||1,t={};o.getIconInfo(function(e){var s=$.extend({},e.data,{"package":e.package},{custom_price:e.custom_price});for(var c in s)s[c].iconId==i&&(t={iconId:i,iconCount:n,iconImg:s[c].picUrl,memeberTdou:parseInt(1.05*n*s[c].non_member_t),tdou:n*s[c].non_member_t,name:s[c].name,qianbao_params:a.qianbao_params},t.pay_tdou=2==o.baseData.getMemberLevel()?t.memeberTdou:t.tdou);o.showIcon(t)},o)},showCustomDialog:function(a,e){var o=this;o.tryOptions=e,o.payOptions=a,o.product=a.product||"tdou";var i=a.iconId||"suiji",n=a.iconCount||1,t=a.iconIdFlag||"suiji",s=a.vip_extra_percent||5,c=1+s/100,r={};o.getIconInfo(function(e){for(var s in e.data)e.data[s].iconIdFlag="normal_"+e.data[s].iconId;e.package&&(e.package.iconIdFlag="package_"+e.package.iconId),e.custom_price&&(e.custom_price.iconIdFlag="custom_"+e.custom_price.iconId);var p=$.extend({},e.data,{"package":e.package},{custom_price:e.custom_price});for(var d in p)p[d].iconIdFlag==t&&(r={iconId:i,iconCount:n,iconImg:p[d].picUrl,memeberTdou:1===e.setting.vip_extra_switch?parseInt(n*c*p[d].non_member_t):n*p[d].non_member_t,tdou:n*p[d].non_member_t,name:p[d].name,qianbao_params:a.qianbao_params},r.pay_tdou=2==o.baseData.getMemberLevel()?r.memeberTdou:r.tdou);o.showIcon($.extend({},r,{vip_extra_percent:e.setting.vip_extra_percent,vip_extra_switch:e.setting.vip_extra_switch,is_mem:e.user_info.is_mem}))},o)},showIcon:function(a){var e=this,o=a.qianbao_params||"",i=$.extend(a,{baseDialogUserBarTpl:e.baseDialogUserBar.getUserBarTemplate(),isSuperMember:2==a.is_mem?!0:!1}),n=_.template('<div class="qianbao_cashier_purchase_tdou ">     <%=baseDialogUserBarTpl%>     <div class="qianbao_cashier_goods">         <div class="order_info clearfix" style="display: block;">             <label class="title order_label">\u5546\u54C1\u8BA2\u5355\uFF1A</label>             <section class="order_desc clearfix">                 \u672C\u6B21\u83B7\u53D6<i class="icon-tbean"></i><span class="tdou_num"><%=pay_tdou%></span>\uFF0C\u9700\u8981\u8D2D\u4E70\u4EE5\u4E0B\u5370\u8BB0\u6765\u5B8C\u6210             </section>         </div>         <div class="goods_list">             <label class="title goods_title">\u8D2D\u4E70\u5546\u54C1\uFF1A</label>              <div class="icon_item">                 <div class="icon_desc">                     <%if(isSuperMember) {%>                         <p>\u8D85\u7EA7\u4F1A\u5458\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=memeberTdou%></span></p>                     <%} else {%>                         <p>\u975E\u8D85\u7EA7\u4F1A\u5458\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=tdou%></span></p>                     <%}%>                 </div>                 <div class="icon_img_box">                     <div class="icon_info" data-id="<%=iconId%>" data-price="1000" data-amount="110000">                         <img class="icon_img" src="<%=iconImg%>">                         <p class="tdou_text"><%=name%><span id="iconCount"><%=iconCount%></span>\u4E2A<span class="expire_date">\uFF08\u6709\u6548\u671F\uFF1A<span class="day"><%=iconCount%></span>\u5929\uFF09</span></p>                     </div>                 </div>             </div>             <%if(false) {%>             <p class="super-member-tips">                 <i class="icon-crown-super-vip"></i>\u5427\u8D85\u7EA7\u4F1A\u5458\u52A0\u9001<span class="orange-txt"><%=vip_extra_percent%>%</span>\uFF0C\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=memeberTdou%></span>             </p>             <%}%>         </div>     </div> </div> ')(i),t={qianbao_params:o,product:e.product},s=2;e.cashierDialog.showDialog(t,n,s,function(a){e.$root=a,e.bindEvents()})},bindEvents:function(){var a=this;a.$root.find(".qianbao_cashier_agreement a").on("click",function(a){a.stopPropagation(),$.stats.track("\u4ED8\u6B3E\u5F39\u7A97\u5E95\u90E8","\u83B7\u53D6T\u8C46\u4F1A\u5458\u670D\u52A1\u534F\u8BAE\u70B9\u51FB",PageData.page?PageData.page:"other","click")}),a.$root.find(".j_header_close").on("click",function(){a.cashierDialog.closeDialog()})},getIconInfo:function(a,e){var o=this,i={ie:"utf-8"};i.tbs=PageData.tbs,o._get_icon_ajax&&o._get_icon_ajax.abort(),o._get_icon_ajax=$.ajax({type:"get",url:"/tbmall/gettdouiconinfo",data:i,cache:!1,dataType:"json"}).success(function(o){a.call(e,o)})}}});_.Module.define({path:"common/widget/tdou_get",requires:["common/widget/base_user_data","common/widget/payment_dialog_title","common/widget/show_dialog","common/widget/tdou/tdou_data","common/widget/qianbao_purchase_tdou"],sub:{tdouOptionsHeight:71,payChannel:2,URL:{getTdouIconInfo:"/tbmall/gettdouiconinfo"},iconInfoList:[],orderNum:1,iconId:"",iconIdFlag:"",iconData:null,vip_extra_percent:5,amount_pay_limit:0,high_limit:999999,RATE:1e3,initial:function(t){var e=this;e.opts=t,e.initDialog(),e.baseUserData=e.requireInstance("common/widget/base_user_data"),e.dataProxy=e.requireInstance("common/widget/tdou/tdou_data",{scores:e.baseUserData.getUserTdou(),level:e.baseUserData.getMemberIcon().level}),e.getUserMember(),e.getTdouIconInfo(function(t){e.vip_extra_percent=t.setting.vip_extra_percent,e.amount_pay_limit=t.setting.amount_pay_limit,e.renderContainer(t),e.bindEvents(),e.defaultSelect(t),e.clearLoading()})},defaultSelect:function(t){var e=this;if(t.package)this.$dialog.find(".j-tdou-select").eq(0).click();else for(var i in e.iconInfoList)1===e.iconInfoList[i].is_default&&this.$dialog.find(".j-tdou-select").eq(i).click();this.$tdouSelectView.show()},getUserMember:function(){var t=this.baseUserData.getMemberIcon();this.isSuperMember=2==t.level?!0:!1},getTdouIconInfo:function(t){var e=this,i={tbs:window.PageData.tbs,ie:"utf-8"};$.get(e.URL.getTdouIconInfo,i,function(i){0==i.no?(i.normal_list=[i.data.tbxiaotietie,i.data.ff14,i.data.tbzhangyu,i.data.tbxiaoxiong],e.iconInfoList=i.normal_list,t&&t(i)):e.errorTips("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u5019\u91CD\u8BD5")})},initDialog:function(){var t=this;$(".tdou-get-dialog").length&&$(".tdou-get-dialog").remove(),t.dialog=new $.dialog({html:_.template('<div class="tdou-get-dialog-container">     <section class="tdou-get-dialog-container-loading">         <img src="<%=url%>" class="loading-img">         <p>\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </section> </div>')({url:"//tb2.bdstatic.com/tb/static-common/widget/tdou_get/images/icon-loading_f0da091.gif"}),show:!1,holderClassName:"tdou-get-dialog",escable:!1,showTitle:!1,height:440,width:620}),t.$dialog=t.dialog.element,t.dialogCtrl=t.requireInstance("common/widget/show_dialog",{container:t.dialog,type:"top-pop"}),t.dialogCtrl.show()},renderContainer:function(t){var e=this;t.package&&(e.dialog.height(500),e.$dialog.find(".tdou-get-dialog-container").css("height","500"));var i=_.template('<section class="tdou-get-dialog-title"></section>  <section class="tdou-get-dialog-user">       <span class="main-title">\u5145\u503C\u8D26\u53F7:</span><%=user_info[\'user_name\']%> </section>  <div class="tdou-get-dialog-main"> <div class="main-title">\u9009\u62E9T\u8C46:</div>  <div class="tdou-options-active"> </div>  <%if(obj[\'package\']){%> <%var package_price = package[\'dubi\'] / 100;%> <section class="tdou-get-dialog-package j-tdou-select" data-name="package" id="<%=package[\'iconId\']%>" data-top="20" data-left="-2" data-icon={"num":"<%=package[\'non_member_t\']%>","price":"<%=package_price%>"}>     <img src="<%=package[\'pc_package_pic\']%>" /> </section> <%}%>  <section class="tdou-get-dialog-selection">      <ul class="tdou-selection-list">         <%             var top = obj[\'package\'] ? 110 : 26;             var left = -135;             for(var i in normal_list) {             var item = normal_list[i];             left += 133;              var tbmall_price = item[\'dubi\'] / 100;         %>          <li class="tdou-options j-tdou-select" data-name="normal" id="<%=item[\'iconId\']%>" data-top="<%=top%>" data-left="<%=left%>" data-icon={"num":"<%=item[\'non_member_t\']%>","price":"<%=tbmall_price%>"}>             <div class="tdou-info">                 <i class="icon-tbean"></i><span class="tdou-num"><%= parseFloat(item[\'non_member_t\']).toLocaleString().split(\'.\')[0]%></span>             </div>             <div class="icon-div">                 <img class="icon-img" src="<%=item[\'picUrl\']%>" />                 <span class="icon-text"><%=item[\'name\']%><%=item[\'validity\']%>\u5929</span>             </div>             <div class="price-div">                 <div class="money_icon"></div>                 <span class="price"><%=tbmall_price%></span>             </div>         </li>         <%}%>     </ul> </section> <%var custom_price_i = custom_price[\'dubi\'] / 100;%> <section class="tdou-get-dialog-custom tdou-get-dialog-custom-tdou-select" data-name="custom" id="<%=custom_price[\'iconId\']%>" data-top="233" data-left="-2" data-icon={"num":"<%=custom_price[\'non_member_t\']%>","price":"<%=custom_price_i%>"}>     <div class="tdou-info">         <span class="tdou-num orange-txt"><i class="icon-tbean"></i><span class="custom-change-txt">0</span></span>         <div class="icon-div">             <img class="icon-img" src="<%=custom_price[\'picUrl\']%>" />             <span class="icon-text"><%=custom_price[\'name\']%><%=custom_price[\'validity\']%>\u5929</span>         </div>     </div>     <div class="price-div">         <div class="money_icon"></div><input class="j-input-select input-select" type="text" pattern="d" placeholder="\u81EA\u5B9A\u4E49\u91D1\u989D"/>     </div> </section> <section class="tdou-get-dialog-money">  <span class="all-pay-money">\u9700\u652F\u4ED8:<b class="cash-num-view-txt change-txt">0</b>\u5143</span>  <%if (setting[\'vip_extra_switch\'] == 1 && setting[\'vip_extra_percent\'] != 0){%>  <span class="vip-extra-money">\u5171\u83B7\u8D60:<b class="tdou-num-view-txt change-txt"></b>T\u8C46</span>  <%}%>  <%if (setting[\'vip_extra_switch\'] == 1 && setting[\'vip_extra_percent\'] != 0){%>    <span class="vip-show"><ins class="icon-vip2-18"></ins>\u8D85\u7EA7\u4F1A\u5458\uFF0C\u5C06\u52A0\u9001<%=setting[\'vip_extra_percent\']%>%</span>  <%}%> </section> <section class="tdou-get-dialog-btn">     <a href="javascript:;" class="payment-btn j-get-tdou">\u7ACB\u5373\u652F\u4ED8</a>     <%if (setting[\'amount_pay_limit\'] > 0){%>       <%var limit = setting[\'amount_pay_limit\'] / 10000 %>       <a class="high-pay">\u5927\u4E8E<%=limit%>\u4E07\u4EBA\u6C11\u5E01\u65F6\uFF0C\u4F7F\u7528\u7F51\u94F6\u652F\u4ED8\u66F4\u5B89\u5168</a>     <%}%> </section> </div> <section class="tdou-get-dialog-container-bottom">     \u8BF7\u52A1\u5FC5\u5BA1\u9605\u5E76\u63A5\u53D7<a target="_blank" href="http://tieba.baidu.com/tb/tdouprecautions.html">\u300AT\u8C46\u8D2D\u4E70\u987B\u77E5\u300B</a>\u6240\u6709\u6761\u6B3E\uFF0C \u5426\u5219\u60A8\u65E0\u6743\u4F7F\u7528\u672C\u670D\u52A1\u3002     <div class="protocol">         <a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_pc.html">\u5145\u503C\u653B\u7565</a>|<a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_show.html">\u9650\u989D\u67E5\u8BE2</a>     </div> </section> ')(t);e.$dialog.find(".tdou-get-dialog-container").append(i),e.$dialogTitle=e.$dialog.find(".tdou-get-dialog-title"),e.$tdouSelectView=e.$dialog.find(".tdou-options-active"),e.$tdouCustom=e.$dialog.find(".tdou-get-dialog-custom"),e.$cashView=e.$dialog.find(".cash-num-view-txt"),e.$tdouNumView=e.$dialog.find(".tdou-num-view-txt"),e.$loadingView=e.$dialog.find(".tdou-get-dialog-container-loading"),e.$getTouBtn=e.$dialog.find(".j-get-tdou"),e.addTitle(),e.trackCtrl("view")},addTitle:function(){var t=this,e={$container:t.$dialogTitle,title:"\u83B7\u53D6T\u8C46",isNameShow:!0,isTdouShow:!0,onClose:function(){t.dialogCtrl.close()}};t.requireInstance("common/widget/payment_dialog_title",e)},changeTdouOptions:function(t){var e=t.tbattr("id"),i=Number(t.data("top")),a=Number(t.data("left")),o=this.$tdouSelectView,n=$(t).width(),s=t.data("name")&&"custom"==t.data("name")?$(t).height():$(t).height()-2;this.iconData=t.data("icon"),this.iconId=e,this.iconIdFlag=t.data("name")+"_"+e,o.show(),this.$tdouCustom.removeClass("tdou-get-dialog-custom-tdou-select"),this.$dialog.find(".price-div").removeClass("orange-txt"),t.find(".price-div").addClass("orange-txt"),"custom"!=t.data("name")||t.hasClass("tdou-get-dialog-custom-tdou-select")||(o.hide(),t.addClass("tdou-get-dialog-custom-tdou-select")),o.animate({left:a,top:i,width:n,height:s},"fast","swing",function(){}),this.orderViewUpdate()},customViewUpdate:function(t){var e=0==t?"":t,i=/(\d+?)(?=(?:\d{3})+$)/g;this.$dialog.find(".custom-change-txt").html((1e3*t+"").replace(i,"$1,")),this.$dialog.find(".j-input-select").val(e)},orderViewUpdate:function(){var t=this;if(t.orderNum&&t.iconId){var e=t.iconData,i=t.orderNum,a=Number(e.price)*i,o=Number(e.num)*i;t.isSuperMember&&(o+=o*t.vip_extra_percent/100),t.$cashView.html(a),t.$tdouNumView.html(o)}else t.$cashView.html(0),t.$tdouNumView.html(0)},getTdou:function(){var t=this,e=$.tb.location.getHref();t.setLoading();var i=t.opts&&t.opts.consumption_path||0;t.dataProxy.payIcon(t.iconId,t.orderNum,t.buyIcon,t,e,i,t.payChannel)},buyIcon:function(t){var e=this;if(t&&0==t.no){e.cashier=e.requireInstance("common/widget/qianbao_purchase_tdou");var i=t.data,a=e.$tdouNumView.html(),o=e.opts&&e.opts.consumption_path||0,n=$.extend({product:"tdou",consumption_path:o,goods_cost_tdou:a,pay_type:6,pay_channel:e.payChannel,iconIdFlag:e.iconIdFlag,vip_extra_percent:e.vip_extra_percent},{qianbao_params:i.return_url,iconCount:i.iconCount,iconId:i.iconId}),s={ie:"utf-8",tbs:window.PageData.tbs,terminal:"pc",pay_type:6,iconId:i.iconId,iconIdFlag:e.iconIdFlag,vip_extra_percent:e.vip_extra_percent,pageUrl:i.return_url||"",margin:a,goodsCost:a,fr:o||0,channel:e.payChannel};e.cashier.showCustomDialog(n,s),setTimeout(function(){e.clearLoading()},1e3)}else if(t&&11e4===t.no)e.requireInstance("common/widget/login_dialog");else if(t&&1990055===t.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var c="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),d="https://passport";$.JsLoadManager.use([d+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(c/6e4),d+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(c/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else setTimeout(function(){e.clearLoading()},1e3)},clearLoading:function(){var t=this;t.$loadingView.hide(),t.$getTouBtn.removeClass("loading")},setLoading:function(){this.$loadingView.show(),this.$getTouBtn.addClass("loading")},changePaymentBtnStatus:function(t){""===t?this.$getTouBtn.addClass("payment-disable").removeClass("j-get-tdou"):this.$getTouBtn.removeClass("payment-disable").addClass("j-get-tdou")},bindEvents:function(){var t=this;t.$dialog.on("click",".j-tdou-select",function(e){var i=$(e.currentTarget);t.orderNum=1,t.changeTdouOptions(i),t.customViewUpdate(0),t.trackCtrl("choose",i[0].id),t.$getTouBtn.removeClass("payment-disable").addClass("j-get-tdou")}).on("click",".j-get-tdou",function(e){var i=$(e.target);i.hasClass("loading")||(t.getTdou(),t.dialogCtrl.close(),t.trackCtrl("pay"))}).on("click",".j-get-member",function(){$.stats.track("T\u8C46\u94B1\u5305","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u83B7\u53D6T\u8C46\u70B9\u51FB\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"})}).on("focus",".j-input-select",function(){var e=$(this);t.trackCtrl("choose");var i=parseInt(e.val(),10);i||(i=""),t.orderNum=i,t.changePaymentBtnStatus(i),t.changeTdouOptions(e.parents(".tdou-get-dialog-custom"))}).on("input",".j-input-select",function(){var e=$(this),i=parseInt(e.val(),10);if(i)if(i>t.high_limit){var a=i+"";i=parseInt(a.slice(0,a.length-1),10)}else i=i;else i="";e.val((i+"").replace(/[^\d]*/gi,"")),t.changePaymentBtnStatus(i),t.orderNum=i,t.orderViewUpdate(),t.customViewUpdate(i),Number(i)>Number(t.amount_pay_limit)&&t.amount_pay_limit>0?t.$dialog.find(".high-pay").show():t.$dialog.find(".high-pay").hide()})},trackCtrl:function(t,e){var i="custom",a=e;switch(e||(a="tbxiaoniu"),t){case"view":$.stats.track("show-"+i,"TdouCashier","","view",{tdouViewType:i});break;case"choose":$.stats.track("choose-"+i+"-"+a,"TdouCashier","","click",{tdouViewType:i});break;case"pay":$.stats.track("buy-"+i,"TdouCashier","","click",{tdouViewType:i})}}}});_.Module.define({requires:["common/widget/tdou_get"],path:"common/widget/tchargeDialog",sub:{initial:function(e){var t=this;$.stats.track("all","\u6253\u5F00T\u8C46\u6536\u94F6\u53F0","all","show"),t.requireInstanceAsync("common/widget/Tdou",[],function(c){e&&e.chargeType&&"platform"==e.chargeType?c.factory("payment",e):(e&&(t.consumption_path=e.consumption_path,t.desc=e.desc,t.current_need_tdou=e.current_need_tdou,t.is_direct_cashier=e.is_direct_cashier),e&&t.is_direct_cashier?c.factory("auto_direct",e):t.requireInstance("common/widget/tdou_get",e))})}}});_.Module.define({requires:["common/widget/LoginDialog","common/widget/payMember"],path:"common/widget/JoinVipDialog",sub:{objGet:function(i,e,o){o=void 0===o?null:o,e=e.split(".");var t,n=i;for(t in e){if(!("object"==typeof n&&e[t]in n))return o;n=n[e[t]]}return n},objSet:function(i,e,o){return i[e]=o,i},initial:function(){},getMemberDialog:function(i,e){var o=this;return this.objGet(window,"PageData.user.is_login",!1)?(this.gotoCashier(i,e),!1):(o.requireInstance("common/widget/LoginDialog"),!1)},gotoCashier:function(i,e){var o=this.requireInstance("common/widget/payMember"),t=this.objSet({},"fr",i||"\u8D2D\u4E70\u4F1A\u5458");t=this.objSet(t,"scene_id",e||0),o.showCashier(t)}}});_.Module.define({path:"tbmall/widget/forumMemberDialog",requires:["tbmall/widget/tbean_safe_ajax","common/widget/cashierDialog","common/widget/messenger","common/widget/baseUserData","common/widget/payMember","common/widget/tcharge_dialog"],sub:{opts:{},tplData:{forums:null,bdRpTime:[1,3,6,12]},tpl:{hd:'<p class="title"><i class="forum-member-dialog-title-icon"></i>#{title}</p>'},bt:window.baidu.template,pageData:window.PageData||{},Dialog:$.dialog,initial:function(e){if(!$.getPageData("user.is_login",0))return this.requireInstanceAsync("common/widget/LoginDialog",["","userBar"]),void 0;var t=this,i={};i.is_show_features=!0,i.is_show_forum=!0,i.current_time_order=1,i.current_option=null,i.current_time_unit=3,i.current_forum_id="",i.current_forum_name="",i.isCurForumMember=!1,i.forums=null,i.celebrity_type=-1,this.opts=$.extend({},i,e),this.tplData.forums=this.opts.forums,this.opts.scores=this.opts.scores||this.pageData.scores,this.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,this.forumMemberTitle="\u5355\u5427\u4F1A\u5458",!this.opts.isCurForumMember&&this._checkIsForumMember(),this.safeAjax=this.requireInstance("tbmall/widget/tbean_safe_ajax"),this.showDialog({showTitle:!1,width:710,html:t.buildInitHtml(),scrollable:!1}),t.bindEvents(),this.JoinVipDialog=this.requireInstance("common/widget/JoinVipDialog"),t.setDefaultContent()},setDefaultContent:function(){this._dialog.element.find(".j_pertime_unit:eq("+this.opts.current_time_order+")").click()},checkTdouEnough:function(){var e=this,t=e.getTimeValue(),i=parseInt(5e3*t);e.tdouInUser<i?(e._dialog.element.find(".not-enough-tbean-alert").css("display","inline-block"),e._dialog.element.find(".get-tdou-text").show(),e._dialog.element.find(".j_charge_tdou").addClass("btn-disabled")):(e._dialog.element.find(".not-enough-tbean-alert").hide(),e._dialog.element.find(".get-tdou-text").hide(),e._dialog.element.find(".j_charge_tdou").removeClass("btn-disabled"))},_checkIsForumMember:function(){var e=this.opts.current_forum_id;if(e){var t=$.getPageData("user.mParr_props.forum_member."+e);this.opts.isCurForumMember=t&&1e3*+t.end_time>+new Date}},bindEvents:function(){var e=this;this._dialog.element.on("click",".charge_tdou_agreement a",function(e){e.stopPropagation(),$.stats.track("\u5151\u6362\u5F39\u7A97\u5E95\u90E8","\u5151\u6362\u5355\u5427\u4F1A\u5458\u670D\u52A1\u534F\u8BAE\u70B9\u51FB",PageData.page?PageData.page:"other","click")}),this._dialog.element.on("click",".j_charge_tdou",function(){if(!$(this).hasClass("btn-disabled")){if($.isArray(e.opts.forums)&&!e.opts.current_forum_id)return e.showForumError(),void 0;var t=e.getTimeValue();return e.util._isPositiveDigital(t)?parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),void 0):(e.initBuyMember(t),void 0):(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0)}}),this._dialog.element.on("click",".j_close_excharge",function(t){t.preventDefault(),e.closeDialog()}),this._dialog.element.on("click",".j_pertime_unit",function(t){t.preventDefault(),e.changeCurrentOpt($(this),"current_time_unit"),e._closeTipBubble(),e.changeTdouNum(),e.checkTdouEnough(),$("#customTime").val("")}),this._dialog.element.on("focus","#customTime",function(){e.changeCurrentOpt($(this).closest(".j_customTime_unit"),"current_time_unit"),e.changeTdouNum()}),this._dialog.element.on("keyup","#customTime",function(){var t=$(this).val();return $.trim(t).length>0&&!e.util._isPositiveDigital(t)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),e.changeTdouNum(),void 0):(e._closeTipBubble(),e.checkTdouEnough(),e.changeTdouNum(),void 0)});var t=e._dialog.element.find(".select-forum-list-container"),i=e._dialog.element.find(".select-forum-input");this._dialog.element.on("click",".select-forum-input",function(){e.hideForumError(),t.show()}),this._dialog.element.on("mouseleave",".sel_forum",function(){t.hide()}),this._dialog.element.on("click",".select-forum-list-container span",function(){e.opts.current_forum_id=$(this).data("id"),e.opts.current_forum_name=$(this).html(),e._checkIsForumMember(),i.val($(this).html()),t.hide()}),this._dialog.element.on("click",".open-super-member",function(){e.closeDialog(),e.JoinVipDialog.getMemberDialog("forumMembersDisalog",1005001e3)}),this._dialog.element.on("click",".get-tdou-text",function(t){t.preventDefault(),e.closeDialog(),e.requireInstance("common/widget/tcharge_dialog")})},initTdouNotEnough:function(e,t){var i=this,s=i.getTimeValue(),o={};o.month=s,o.baidu_charge=t,o.tdou_num=e,i.closeDialog();var a={};a.f_name=i.opts.current_forum_name,i.chargeFailFn($.extend({},o,a))},purchaseMember:function(e){var t=this,i={};i.open_id=e.open_id,i.order_id=e.order_id,i.timestamp=e.timestamp,i.scene_id=e.scene_id,i.pay_type=e.pay_type,i.from="\u5355\u5427\u4F1A\u5458\u4E2D\u5FC3",i.goods_name=e.goods_name,i.goods_image=e.goods_image||"",i.goods_price=e.goods_price,i.goods_amount=e.goods_amount,i.goods_unit="\u4E2A",i.goods_duration=e.goods_duration,i.free_vip_level=e.free_vip_level,i.tdou_num=e.tdou_num,i.chargeType="platform",t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&(t.closeDialog(),t.chargeSuccessFn(e.data||{}))}),t.payment.createMain(i)},initBuyMember:function(e){var t=this,i={from:"pc",tbs:t.pageData.tbs};i.props_id=t.opts.current_forum_id,i.forum_id=t.opts.current_forum_id,i.props_num=e,$.post("/celebrity/submit/genOrder",i,function(e){return 0===e.no?(t.opts.celebrity_type=e.data.celebrity_type,t.purchaseMember(e.data||{}),void 0):(t.closeDialog(),t.chargeFailFn(e),void 0)})},changeCurrentOpt:function(e,t){var i=this;i.opts.current_option&&i.opts.current_option.removeClass(t),i.opts.current_option=e,i.opts.current_option.addClass(t)},changeTdouNum:function(){var e=this;this._dialog.element.find(".sel_tdou .tdou_num").text(5e3*e.getTimeValue())},getTimeValue:function(){var e=$.trim($("#customTime").val());return this.opts.current_option&&this.opts.current_option.data("value")?this.opts.current_option.data("value"):0===e.length&&""===e?0:e},chargeFailFn:function(e){var t,i=this,s="auto";if(2270046===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro">\u60A8\u5DF2\u5F00\u901A25\u4E2A\u5427\u7684\u7279\u6743\u5305\uFF0C\u8FBE\u5230\u7279\u6743\u5305\u6570\u91CF\u4E0A\u9650</p>     <p class="sub_intro">\u7ACB\u5373\u5F00\u901A\u8D34\u5427\u4F1A\u5458\uFF0C\u5C3D\u4EAB\u8D34\u5427\u7279\u6743\u65E0\u4E0A\u9650</p>     <a class="j_charge_confirm charge_tdou btn_default btn_small" href="#">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a> </div>" '.replace(/^ "|" $/g,"")),s=216;else if(2270074===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u7528\u6237\u6700\u591A\u4E00\u6B21\u53EA\u80FD\u8D2D\u4E70120\u4E2A\u6708"}),s=216;else if(170003===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u60A8\u8FD8\u672A\u5173\u6CE8\u8BE5\u5427"}),s=216;else{if(1990018===e.no){var o=$.dialog.confirm("T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5151\u6362T\u8C46");return o.bind("onaccept",function(){i.requireInstance("common/widget/tcharge_dialog"),i.dialog.close()}),void 0}t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u5F88\u9057\u61BE\uFF0C\u8D2D\u4E70\u5931\u8D25\u4E86..."}),s=216}i.showDialog({width:537,height:s,showTitle:!1,html:t}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),i.closeDialog()})},chargeSuccessFn:function(e){var t=this,i="",s="auto";0===+e.no&&(t.opts.scores=$.extend(t.opts.scores,e.data.left_scores),t.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,i=t.buildSuccessHtml(e.data)),t.showDialog({width:708,height:s,showTitle:!1,html:i}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),t.closeDialog(),$.tb.location.reload()}),this._dialog.element.on("click",".get-exp-gift",function(){var e={};e.is_show_features=!1,e.is_show_forum=!1,e.current_forum_id=t.opts.current_forum_id,e.current_forum_name=t.opts.current_forum_name,e.scores=t.opts.scores,e.cnt_height=225,e.celebrity_type=t.opts.celebrity_type,e.isCurForumMember=t.opts.isCurForumMember,e.user=t.opts.user,t.requireInstanceAsync("tbmall/widget/exp_package_dialog",e)})},getUserName:function(){var e=this.requireInstance("user/widget/userApi",[]),t="",i=this.pageData.user,s=$.getPageData("forum.id")||this.opts.current_forum_id;return t=e.checkSuperMemberShipOf(i)?'<i class="icon-vip2-16"></i> <a class="vip-red">'+$.getPageData("user.user_name")+"</a>":e.checkSingleForumMembershipOf(i,s)?'<i class="icon-vip3-16"></i> <a class="vip-red">'+$.getPageData("user.user_name")+"</a>":$.getPageData("user.user_name")},buildInitHtml:function(){var e=this,t="";t=e.opts.is_show_forum?"\u5151\u6362"+e.forumMemberTitle:"\u5151\u6362["+e.opts.current_forum_name+"\u5427]"+e.forumMemberTitle;var i=this.getUserName(),s={};return s.title=t,s.tdou_num=5e3*e.opts.current_time_unit,s.bdRpTime=e.tplData.bdRpTime,s.p_style=e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",s.tip=e.opts.is_celebrity_forum?"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u62E5\u6709":"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743",s.tdouInUser=this.tdouInUser,s.username=i,s.forums=e.opts.forums,e.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_hd">     <p class="title">         <i class="forum-member-dialog-title-icon"></i><%- title %>         <span class="user-info">             <span class="user-name">\u5E10\u53F7\uFF1A<%- username %></span>             <span class="tdou-in-user">T\u8C46\u4F59\u989D\uFF1A<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p> </div> <div class="excharge_bd">     <div class="sel_member">         <span class="sel_label">\u9009\u62E9\u4F1A\u5458:</span>          <div class="single-forum-member">             <i class="single-forum-icon"></i>              <p class="member-label-title">\u5355\u5427\u4F1A\u5458</p>              <p>                 <span class="member-label-orange">5000</span>                 <span class="member-label-text">T\u8C46/\u6708</span>             </p>             <span class="decorate_icon"></span>         </div>         <span class="member-label-text">\u60F3\u76F4\u63A5\u5347\u7EA7\u4E3A800\u4E07\u4E2A\u5427\u7684\u5355\u5427\u4F1A\u5458\uFF1F</span>         <span class="open-super-member">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</span>     </div>     <% if($.isArray(forums)) { %>     <div class="sel_forum">         <span class="sel_label">\u9009\u62E9\u5427:</span>         <input class="select-forum-input" aria-readonly="true" readonly placeholder="\u9009\u62E9\u9700\u8981\u5F00\u901A\u4F1A\u5458\u7684\u5427"/>         <% if(!forums.length) { %>         <span style="line-height: 37px; color: #e64545;">* \u81F3\u5C11\u5173\u6CE8\u4E00\u4E2A\u5427\u624D\u80FD\u5F00\u901A\u5355\u5427\u4F1A\u5458\u54E6</span>         <% } %>         <div class="select-forum-list-container">             <div class="select-forum-list">                 <% for(var i = 0; i < forums.length; i++) { %>                 <span data-id="<%= forums[i].forum_id %>"><%= forums[i].forum_name %></span>                 <% } %>             </div>         </div>     </div>     <% } %>     <div class="sel_time">         <span class="sel_label">\u9009\u62E9\u65F6\u957F:</span>         <span class="sel_cnt">             <%for(var i = 0; i< bdRpTime.length; i++){%>             <a class="j_pertime_unit per_time_unit" data-value="<%=bdRpTime[i]%>">                 <strong><%=bdRpTime[i]%></strong>\u4E2A\u6708                 <span class="decorate_icon"></span>             </a>             <%}%>             <a class="j_customTime_unit per_time_unit custom_time">                 <input id="customTime" type="text" value="" placeholder="\u5176\u4ED6"/><span>\u4E2A\u6708</span>                 <span class="decorate_icon"></span>             </a>         </span>     </div>     <p class="long_time_warning" <%= p_style %>>\u7279\u6743\u5305\u65F6\u957F(\u7D2F\u8BA1\u8D85\u7EA7\u4F1A\u5458)\u6700\u591A\u8FDE\u7EED24\u4E2A\u6708\uFF0C\u8D85\u51FA\u90E8\u5206\u53EA\u8D60\u9001\u7ECF\u9A8C\u548C\u9053\u5177\u3002</p>     <div class="sel_tdou">         <span class="sel_label">\u8FD8\u9700\u652F\u4ED8:</span>         <span class="tdou_num"><%= tdou_num %></span>          <div class="not-enough-tbean-alert">             \u60A8\u7684T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u8BF7\u5148\u83B7\u53D6T\u8C46         </div>     </div>     <a class="j_charge_tdou btn-encourage btn-larger charge_tdou" onclick="return false;" href="#">\u7ACB\u5373\u5151\u6362</a>     <span class="get-tdou-text">\u83B7\u53D6T\u8C46</span> </div> <div class="charge_tdou_agreement">   \u8BF7\u52A1\u5FC5\u5BA1\u9605\u5E76\u63A5\u53D7   <a href="https://tieba.baidu.com/tb/vip_eula.html" target="baidu_tb_member_agreement">\u300A\u8D34\u5427\u4F1A\u5458\u670D\u52A1\u534F\u8BAE\u300B</a>   \u6240\u6709\u6761\u6B3E\uFF0C\u5426\u5219\u60A8\u65E0\u6743\u4F7F\u7528\u672C\u670D\u52A1\u3002 </div> " '.replace(/^ "|" $/g,""),s)},buildSuccessHtml:function(e){var t=this,i={celebrityType:t.opts.celebrity_type,isCurForumMember:t.opts.isCurForumMember,forumName:t.opts.current_forum_name,endTime:t.util._getDate(e.member_end_time),userName:t.getUserName(),tdouInUser:t.tdouInUser};return t.bt(' "<div class="forum-member-success-dialog">     <div class="header">         <span class="pull-left">             <i class="icon-ori"></i>             <span class="exchange">\u5151\u6362[<%= forumName %>\u5427]\u5355\u5427\u4F1A\u5458</span>         </span>         <span class="pull-right">             <span class="user-name">\u5E10\u53F7: <%- userName %></span>             <span class="tbean-scores">                 T\u8C46\u4F59\u989D: <i class="icon icon-tbean"></i> <%- tdouInUser %>             </span>         </span>         <a class="outpage_close j_close_excharge" href="javascript:"></a>     </div>     <div class="body">         <div class="title">             <%= isCurForumMember             ? (\'\u60A8\u7684[\' + forumName + \'\u5427]\u4F1A\u5458\u7EED\u8D39\u6210\u529F\')             : (\'\u606D\u559C\u60A8\u6210\u4E3A[\' + forumName + \'\u5427]\u4F1A\u5458\')             %>         </div>         <ul class="pr-list">             <li>                 <i class="icon-pr pr-crown"></i>                 <span>\u7687\u51A0\u8EAB\u4EFD</span>             </li>             <li>                 <i class="icon-pr pr-red-name"></i>                 <span>\u663E\u793A\u7EA2\u540D</span>             </li>             <li>                 <i class="icon-pr pr-sign"></i>                 <span>\u7B7E\u52306\u500D\u7ECF\u9A8C</span>             </li>             <li>                 <i class="icon-pr pr-red-title"></i>                 <span>\u7EA2\u8272\u6807\u9898</span>             </li>             <% if (celebrityType === 1) { %>             <li>                 <i class="icon-pr pr-mark"></i>                 <span>\u672C\u5427\u4E13\u5C5E\u5370\u8BB0</span>             </li>             <li>                 <i class="icon-pr pr-card-bg"></i>                 <span>\u5B9A\u5236\u540D\u7247\u80CC\u666F</span>             </li>             <li>                 <i class="icon-pr pr-top-thread"></i>                 <span>\u540D\u4EBA\u9876\u8D34</span>             </li>             <li>                 <i class="icon-pr pr-head-border"></i>                 <span>\u5B9A\u5236\u5934\u50CF\u8FB9\u6846</span>             </li>             <% } %>         </ul>         <div class="pr-tip<%= celebrityType === 0 ? \'\' : \' hidden\' %>">             <div class="tips">\u5427\u4E3B<a href="/celebrity/rankHome">\u7533\u8BF7\u540D\u4EBA\u5802</a>\u540E, \u624D\u80FD\u89E3\u9501\u4EE5\u4E0B\u7279\u6743:</div>             <ul class="pr-tip-list">                 <li>                     <i class="icon-pr-sm pr-mark"></i>                     <span>\u672C\u5427\u4E13\u5C5E\u5370\u8BB0</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-card-bg"></i>                     <span>\u5B9A\u5236\u540D\u7247\u80CC\u666F</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-top-thread"></i>                     <span>\u540D\u4EBA\u9876\u8D34</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-head-border"></i>                     <span>\u5B9A\u5236\u5934\u50CF\u8FB9\u6846</span>                 </li>             </ul>         </div>         <div class="gift-title"><span>\u83B7\u5F97\u793C\u7269</span></div>         <ul class="gift-list">             <li>                 <i class="gift-icon gift-resign"></i>                 <span>\u8865\u7B7E\u5361x1</span>             </li>             <li>                 <i class="gift-icon gift-exp-privilege"></i>                 <span>\u672C\u5427\u7ECF\u9A8C\u4E66\u8D2D\u4E70\u6743</span>             </li>         </ul>     </div>     <div class="footer">         <button class="btn-sub btn-middle j_close_excharge">\u786E\u5B9A</button>         <button class="btn-encourage btn-middle get-exp-gift">\u8D2D\u4E70\u7ECF\u9A8C\u4E66</button>     </div> </div> " '.replace(/^ "|" $/g,""),i)},showErrorForum:function(){},hideErrorForum:function(){},checkHasForum:function(e,t){var i=this,s={};s.forum_name=encodeURIComponent(e),s.tbs=i.pageData.tbs,$.post("../get/checkForum",s).done(function(e){0===e.no&&(0===e.data.forum_id&&null===e.data.forum_name?i.showErrorForum("hasNot"):(i.hideErrorForum(),$.isFunction(t)&&t(e)))})},showDialog:function(e){this._dialog=new this.Dialog(e)},closeDialog:function(){this._dialog&&this._dialog.close()},showForumError:function(e){var t=this,i=t._dialog.element.find(".sel_forum"),s={content:e||"\u8BF7\u9009\u62E9\u8981\u8D2D\u4E70\u7684\u5427",attr:"",wrap:i,closeBtn:!0};s.bubble_css={top:54,left:100,zIndex:9999},s.arrow_pos={left:10},t._dialog.forumErrorBubble=t._dialog.forumErrorBubble||new window.UiBubbleTipBase(s),t._dialog.forumErrorBubble.showBubble()},hideForumError:function(){this._dialog.forumErrorBubble&&this._dialog.forumErrorBubble.hideBubble()},_buildTipBubble:function(e){var t=this,i={content:e,attr:"",wrap:$(".sel_time"),closeBtn:!0};i.arrow_dir="up",i.bubble_css={top:54,right:45,width:133,zIndex:9999},i.arrow_pos={left:10},this.opts.tip_bubble=new window.UiBubbleTipBase(i);var s=this.opts.tip_bubble;s.showBubble(),s.bind("onclose",function(){t._closeTipBubble()})},_closeTipBubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.hideBubble()},_showTipBubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.showBubble()},_printTimeErrorInfo:function(e){this.opts.tip_bubble?this._showTipBubble():this._buildTipBubble(e)},util:{_isEmpty:function(e){return 0===$.trim(e).length},_isPositiveDigital:function(e){return/^[1-9]+[0-9]*]*$/.test(e)},_getDate:function(e){var t=new Date(1e3*e),i=t.getFullYear(),s=t.getMonth()+1,o=t.getDate();return i+"\u5E74"+s+"\u6708"+o+"\u65E5"}}}});_.Module.define({requires:["tbmall/widget/forumMemberDialog","common/widget/JoinVipDialog"],path:"pfrs/widget/FanspartyAside",sub:{initial:function(t){this.bindEvents(),this.fid=t.fid,this.options=t},bindEvents:function(){var t=this;$("#btn_cheer").on("click",function(){return t.options.isEnrollEnd?!1:PageData.user.is_login?($.post("/star/submit/go",{forum_id:t.fid,tbs:PageData.tbs},function(e){e&&t.showDialog(e.no)}),!1):(TbCom.process("User","buildLoginFrame"),!1)}),$("#link_cheer").on("click",function(){var t=new $.dialog({html:'<div class="cheer-dialog"><p class="cheerdialog-title">\u4EB2\u7231\u7684\u7C89\u4E1D\uFF0C\u4F60\u6BCF\u5929\u4F1A\u83B7\u5F973\u4E2A\u52A9\u5A01\u503C\uFF0C\u6BCF\u4E2A\u5427\u6BCF\u5929\u53EF\u4F7F\u7528\u4E00\u6B21\u3002\u622A\u6B628\u670829\u65E523\uFF1A59\u7C89\u4E1D\u8282\u5427\u699C\u5355\u6392\u540D\u524D70\u7684\u5427\u5C06\u83B7\u9080\u53C2\u5C55\u7C89\u4E1D\u8282\u5609\u5E74\u534E\uFF0C\u540C\u65F6\u5F00\u901A\u672C\u5427\u5F62\u8C61\u529F\u80FD\u3002</p><button class="btn-sub btn-middle cheerdialog-btn" id="btn_cheerdialog">\u77E5\u9053\u4E86</button></div>',title:"\u52A9\u5A01\u8BF4\u660E",width:383,height:140});return $("#btn_cheerdialog").on("click",function(){return t.close(),!1}),!1}),$(".fansparty-wrap2 .task-item").eq(1).hover(function(){$(this).css("cursor","pointer").tbattr("title","\u70B9\u51FB\u67E5\u770B\u8BE6\u60C5")}),$(".fansparty-wrap2 .task-item").eq(1).on("click",function(){window.open("/p/3981276334")})},showDialog:function(t){var e={1:{title:"\u4ECA\u65E5\u52A9\u5A01\u6210\u529F\uFF01",content:["<span style='margin-right:10px;'>\u52A9\u5A01+1</span>\u4F1A\u5458\u7279\u6743\uFF1A\u52A9\u5A01+2"],linkText:"\u5151\u6362\u672C\u5427\u4F1A\u5458",linkValue:""},2:{title:"\u4ECA\u65E5\u52A9\u5A01\u6210\u529F\uFF01",content:["<span style='margin-right:10px;'>\u52A9\u5A01+2</span>\u8D85\u7EA7\u4F1A\u5458\uFF1A\u52A9\u5A01+3"],linkText:"\u5151\u6362\u8D85\u7EA7\u4F1A\u5458",linkValue:""},3:{title:"\u4ECA\u65E5\u52A9\u5A01\u6210\u529F\uFF01",content:["\u52A9\u5A01+3"],linkText:"",linkValue:""},14:{title:"\u4EB2\uFF0C\u4E00\u5929\u4E00\u4E2A\u5427\u53EA\u80FD\u6295\u4E00\u7968\u54DF\uFF0C\u660E\u5929\u518D\u4E3A\u672C\u5427\u6295\u7968\u5427\uFF01",content:[""],linkText:"",linkValue:""},22:{title:"\u5DF2\u8FC7PK\u65F6\u95F4\uFF0C\u8BF7\u5173\u6CE8\u540E\u7EED\u7C89\u4E1D\u8282\u6D3B\u52A8\u5427\uFF01",content:[],linkText:"",linkValue:""},23:{title:"\u4EB2\uFF0C\u4F60\u6240\u4F7F\u7528\u7684IP\u4ECA\u5929\u6295\u7968\u592A\u591A\u5566\uFF0C\u660E\u5929\u518D\u8BD5\u5427\uFF01",content:[],linkText:"",linkValue:""},24:{title:"\u4EB2\uFF0C\u4E00\u5929\u6700\u591A\u6295\u4E09\u7968\u54DF\uFF0C\u660E\u5929\u518D\u6765\u5427\uFF01",content:[],linkText:"",linkValue:""}},n=e[t];n||(n={title:"\u51FA\u9519\u4E86\uFF0C\u8BF7\u518D\u8BD5\u4E00\u6B21",content:["\u9519\u8BEF\u7801\uFF1A["+t+"]"],linkText:"",linkValue:""});var i='<div class="cheer-tip">';i+='<p class="cheertip-title">'+n.title+"</p>";for(var l=0;l<n.content.length;l++)i+='<p class="cheertip-item">'+n.content[l]+"</p>";i+='<p class="cheertip-btns"><button class="btn-sub btn-middle" id="btn_cheertip">\u77E5\u9053\u4E86</button>',""!==n.linkText&&(i+='<a class="btn-default btn-middle btn_link" target="_blank" href="'+n.linkValue+'">'+n.linkText+"</a>"),i+="</p>",i+="</div>";var r=new $.dialog({html:i,title:"",width:415,height:125}),a=this;1==t&&($("#j_cheer_val").text(parseInt($("#j_cheer_val").text())+1),r.element.find(".btn_link").on("click",function(){return a.buyMember(),r.close(),!1})),2==t&&($("#j_cheer_val").text(parseInt($("#j_cheer_val").text())+2),r.element.find(".btn_link").on("click",function(){return a.buySuperMember(),r.close(),!1})),3==t&&$("#j_cheer_val").text(parseInt($("#j_cheer_val").text())+3),$("#btn_cheertip").on("click",function(){return r.close(),!1})},buyMember:function(){var t={scores_money:0,scores_other:0};this.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:PageData.forum.forum_id,current_forum_name:PageData.forum.forum_name,scores:PageData.user.Parr_scores?PageData.user.Parr_scores:t,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}})},buySuperMember:function(){var t=this.requireInstance("common/widget/JoinVipDialog");t.getMemberDialog()},playMotion:function(){var t=0,e=$("#cheer_effect"),n=function(){t++;var i=0;i=50>t?5*Math.sin(t/50*2*Math.PI):t-50,e.css({top:50-t+"px",left:150+i+"px",width:t/90*10+18,height:t/90*10+18}),90>t?(e.show(),setTimeout(n,20)):e.hide()};n()}}});_.Module.define({path:"frs/widget/stockAsideConcepts",requires:[],sub:{initial:function(t){try{this.concepts=t.concepts,this.numMap={0:"&#xe60f;",1:"&#xe601;",2:"&#xe602;",3:"&#xe603;",4:"&#xe604;",5:"&#xe605;",6:"&#xe606;",7:"&#xe607;",8:"&#xe608;",9:"&#xe609;",".":"&#xe60b;","-":"&#xe60c;","+":"&#xe60d;",up:"&#xe60e;",down:"&#xe600;",equal:"",bg:"&#xe60a;"},this.conceptsTml="#{conceptsItems}",this.initConcepts()}catch(c){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:c.message||c.description,path:"frs:widget/stock_aside_concepts/stock_aside_concepts.js",method:"",ln:35}),c}},initConcepts:function(){for(var t,c,e="",o=0;o<this.concepts.length;o++){var s,n,i,a;this.concepts[o]&&(this.concepts[o].change_ratio?(this.concepts[o].change_ratio=this.changeTwoDecimal_f(this.concepts[o].change_ratio),this.concepts[o].change_ratio>0?(s="color_01",n="up"):this.concepts[o].change_ratio<0&&(s="color_02",n="down"),this.concepts[o].change_ratio=this.concepts[o].change_ratio+"%"):0==this.concepts[o].change_ratio&&""!=this.concepts[o].change_ratio?(this.concepts[o].change_ratio="0.00%",s="color_03",n="equal"):(this.concepts[o].change_ratio="&#xe60c;&#xe60c;",s="color_03 iconfont no_data",n="equal")),this.concepts[o+1]?(this.concepts[o+1].change_ratio?(this.concepts[o+1].change_ratio=this.changeTwoDecimal_f(this.concepts[o+1].change_ratio),this.concepts[o+1].change_ratio>0?(i="color_01",a="up"):this.concepts[o+1].change_ratio<0&&(i="color_02",a="down"),this.concepts[o+1].change_ratio=this.concepts[o+1].change_ratio+"%"):0==this.concepts[o+1].change_ratio?(this.concepts[o+1].change_ratio="0.00%",i="color_03",a="equal"):(this.concepts[o+1].change_ratio="&#xe60c;&#xe60c;",i="color_03 iconfont no_data",a="equal"),e+="<dl><dt>"+this.concepts[o].concept_name.substr(0,4)+"</dt><i class='iconfont "+s+"'>"+this.numMap[n]+"</i><dd class='"+s+"'>"+this.concepts[o].change_ratio+"</dd><dt>"+(this.concepts[o+1]&&this.concepts[o+1].concept_name.substr(0,4))+"</dt><i class='iconfont "+i+"'>"+this.numMap[a]+"</i><dd class='"+i+"'>"+(this.concepts[o+1]&&this.concepts[o+1].change_ratio)+"</dd></dl>"):e+="<dl><dt>"+this.concepts[o].concept_name.substr(0,4)+"</dt><i class='iconfont "+s+"'>"+this.numMap[n]+"</i><dd class='"+s+"'>"+this.concepts[o].change_ratio+"</dd></dl>",o++}c={conceptsItems:e},t=$.tb.format(this.conceptsTml,c),$(".stock_aside_concepts_wrap .concepts_content").html(t)},changeTwoDecimal_f:function(t){var c=parseFloat(t);if(isNaN(c))return!1;c=Math.round(100*t)/100;var e=c.toString(),o=e.indexOf(".");for(0>o&&(o=e.length,e+=".");e.length<=o+2;)e+="0";return e}}});_.Module.define({path:"frs/widget/stockAsideIndexs",requires:[],sub:{initial:function(e){try{this.indexs=e.indexs,this.initIndexs()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/stock_aside_indexs/stock_aside_indexs.js",method:"",ln:13}),i}},initIndexs:function(){for(var e,i,t=0;this.indexs&&t<this.indexs.length;t++){var n=this.indexs[t];n.change=this.changeTwoDecimal_f(n.change),n.change_ratio=this.changeTwoDecimal_f(n.change_ratio),n.close=this.changeTwoDecimal_f(n.close)}e={indexs:this.indexs},i=baidu.template("stock_aside_index_template",e),$(".stock_aside_indexs .indexs_content").html(i)},changeTwoDecimal_f:function(e){var i=parseFloat(e);if(isNaN(i))return alert("function:changeTwoDecimal->parameter error"),!1;i=Math.round(100*e)/100;var t=i.toString(),n=t.indexOf(".");for(0>n&&(n=t.length,t+=".");t.length<=n+2;)t+="0";return t}}});_.Module.define({path:"frs/widget/stockAsideIndustry",requires:[],sub:{initial:function(t){try{this.industry=t.industry,this.tml="<dl><dt class='textCenter'>\u9886\u6DA8\u884C\u4E1A</dt><dd class='dd_w1 textCenter'>\u6DA8\u5E45</dd><dt class='textCenter'>\u9886\u8DCC\u884C\u4E1A</dt><dd class='dd_w2 textCenter'>\u8DCC\u5E45</dd></dl>",this.initIndustry()}catch(d){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:d.message||d.description,path:"frs:widget/stock_aside_industry/stock_aside_industry.js",method:"",ln:20}),d}},initIndustry:function(){var t,d,i,s,n,e=this.tml,r=this.industry&&this.industry.leading&&this.industry.leading.length,a=this.industry&&this.industry.leading_by&&this.industry.leading_by.length;t=a>r?r:a;for(var l=0;t>l;l++)d=this.changeTwoDecimal_f(this.industry.leading[l].change_ratio),i=this.changeTwoDecimal_f(this.industry.leading_by[l].change_ratio),s=d>0?"color_01":0==d?"color_03":"color_02",n=i>0?"color_01":0==i?"color_03":"color_02",e+="<dl><dt>"+(this.industry.leading[l]?this.industry.leading[l].industry_name.substr(0,4):"--")+"</dt><dd class='dd_w1 "+s+"'>"+d+"%</dd><dt>"+(this.industry.leading_by[l]?this.industry.leading_by[l].industry_name.substr(0,4):"--")+"</dt><dd class='dd_w2 "+n+"'>"+i+"%</dd></dl>";$(".stock_aside_industry .industry_content").html(e)},changeTwoDecimal_f:function(t){var d=parseFloat(t);if(isNaN(d))return alert("function:changeTwoDecimal->parameter error"),!1;d=Math.round(100*t)/100;var i=d.toString(),s=i.indexOf(".");for(0>s&&(s=i.length,i+=".");i.length<=s+2;)i+="0";return i}}});_.Module.define({path:"frs/widget/stockAsideFocusForum",requires:[],sub:{initial:function(){try{this.bindEvents()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/stock_aside_focus_forum/stock_aside_focus_forum.js",method:"",ln:12}),e}},bindEvents:function(){}}});_.Module.define({path:"tbmall/widget/exp_package_dialog",requires:["tbmall/widget/tbean_safe_ajax","user/widget/userApi","common/widget/Tdou/TdouViewPay","common/widget/tcharge_dialog","tbmall/widget/forumMemberDialog"],sub:{opts:{},initial:function(e){var t=this,a={is_show_features:!0,is_show_forum:!0,current_time_order:1,current_option:null,current_time_unit:3,current_forum_id:"",current_forum_name:"",isCurForumMember:!1};this.opts=$.extend({},a,e),this.opts.scores=this.opts.scores||PageData.scores,this.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,this.FORUM_MEMBER_TITLE=this.opts.is_celebrity_forum?"\u5355\u5427\u4F1A\u5458":"\u5427\u7279\u6743\u5305",this.safeAjax=this.requireInstance("tbmall/widget/tbean_safe_ajax"),this.showDialog(),this.bindEvents()},getUserName:function(){var e=this.requireInstance("user/widget/userApi",[]),t="",a=window.PageData.user,n=$.getPageData("forum.forum_id");return t=e.checkSuperMemberShipOf(a)?'<i class="icon-vip2-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":e.checkSingleForumMembershipOf(a,n)?'<i class="icon-vip3-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":$.getPageData("user.user_name")},showDialog:function(){var e=this,t=this.getUserName(),a=_.template('<div class="exp-pageckage-dialog">     <a class="outpage-close j-close-excharge" href="#"></a>     <p class="title">         <i class="forum-member-dialog-title-icon"></i>\u5151\u6362[<%= forumName %>\u5427]\u7ECF\u9A8C\u4E66         <span class="user-info">             <span class="user-name">\u5E10\u53F7\uFF1A<%= username %></span>             <span class="tdou-in-user">T\u8C46\u4F59\u989D\uFF1A<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p>     <div class="exp-package-dialog-body">         <div class="exp-package-intro">             <i class="icon-exp-package-logo"></i>             <p>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text">5000</span>/\u4E2A             </p>             <p>\uFF08\u6BCF\u4E2A\u7ECF\u9A8C\u4E66<span class="exp-orange-text">+50</span>\uFF0C\u8D2D\u4E70\u7ACB\u5373\u751F\u6548\uFF09</p>         </div>         <div class="exp-package-parchase-container">             <p class="input-container">                 <label>\u9009\u62E9\u65F6\u957F\uFF1A</label>                 <span class="controller-input-container">                     <button class="cut-btn">-</button>                     <input class="exp-num-input" type="text" value="3"/>                     <button class="add-btn">+</button>                 </span>             </p>             <p class="input-container">                 <label>\u8FD8\u9700\u652F\u4ED8\uFF1A</label>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text exp-tbean-num">15000</span>             </p>             <%             if (!isCurForumMember) {             %>             <p class="open-member-text">\u5F00\u901A                 <i class="icon-vip3-16"></i>                 <span class="orange-text j-open-single-member">\u672C\u5427\u4F1A\u5458</span>                 \u4E4B\u540E\u624D\u80FD\u5151\u6362\u7ECF\u9A8C\u4E66             </p>             <button class="btn-middle btn-encourage single-member-btn j-open-single-member">\u5F00\u901A\u5355\u5427\u4F1A\u5458</button>             <% } else { %>             <button class="btn-middle btn-encourage exp-btn">\u7ACB\u5373\u5151\u6362</button>             <% } %>         </div>     </div> </div>')({tdou_num:5e3*e.opts.current_time_unit,p_style:e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",tip:e.opts.is_celebrity_forum?"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u62E5\u6709":"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743",tdouInUser:this.tdouInUser,forumName:e.opts.current_forum_name||$.getPageData("forum.forum_name"),username:t,isCurForumMember:e.opts.isCurForumMember});this.dialog=new $.dialog({showTitle:!1,width:700,html:a})},_changeExpInputValue:function(e){e=e||0;var t=this.getExpInputValue();t+=e,t=0>t?0:t,this.$expInput.val(t)},getExpInputValue:function(){var e=parseInt(this.$expInput.val(),10)||0;return e},_updateView:function(e){this.dialog.element.find(".exp-tbean-num").html(e)},purchaseExp:function(e){var t=this,a={open_id:e.open_id,order_id:e.order_id,timestamp:e.timestamp,scene_id:e.scene_id,pay_type:e.pay_type,from:"\u5355\u5427\u4F1A\u5458\u7ECF\u9A8C\u4E66",goods_name:e.goods_name,goods_image:e.goods_image||"",goods_price:e.goods_price,goods_amount:e.goods_amount,goods_unit:"\u4E2A",goods_duration:e.goods_duration,free_vip_level:e.free_vip_level,tdou_num:e.tdou_num};$.extend(a,{chargeType:"platform"}),t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&$.tb.location.reload()}),t.payment.createMain(a)},bindEvents:function(){var e=this;this.$expInput=this.dialog.element.find(".exp-num-input"),this.dialog.element.on("click",".add-btn",function(){e._changeExpInputValue(1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".cut-btn",function(){e._changeExpInputValue(-1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".exp-btn",function(){var t=e.getExpInputValue();if(t>200)return $.dialog.alert("\u6700\u591A\u53EA\u80FD\u8D2D\u4E70200\u4E2A\u7ECF\u9A8C\u4E66"),void 0;var a={from:"pc",tbs:PageData.tbs};a.props_id=2000163,a.forum_id=$.getPageData("forum.forum_id")||e.opts.current_forum_id,a.props_num=e.getExpInputValue(),$.post("/celebrity/submit/genOrder",a,function(t){if(1990043===t.no)$.dialog.alert("\u60A8\u4E0D\u662F\u6B64\u5427\u7684\u4F1A\u5458");else if(170003===t.no)$.dialog.alert("\u60A8\u8FD8\u672A\u5173\u6CE8\u6B64\u5427");else if(1990018===t.no){var a=$.dialog.confirm("T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5151\u6362T\u8C46");a.bind("onaccept",function(){e.requireInstance("common/widget/tcharge_dialog"),e.dialog.close()})}else 0===t.no&&e.purchaseExp(t.data)})}),this.dialog.element.on("click",".j-open-single-member",function(){e.dialog.close();var t=PageData.forum,a={};a.is_show_features=!1,a.is_show_forum=!1,a.current_forum_id=t.id||e.opts.current_forum_id,a.current_forum_name=t.forum_name||e.opts.current_forum_name,a.scores=e.opts.scores,a.cnt_height=225,a.isCurForumMember=e.opts.isCurForumMember,a.callback=function(){$.tb.location.reload()},e.requireInstance("tbmall/widget/forumMemberDialog",[a])}),this.dialog.element.on("click",".j-close-excharge",function(){e.dialog.close()}),this.$expInput.keyup(function(){e._changeExpInputValue(0);var t=e.getExpInputValue();e._updateView(5e3*t)})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return void i.pay(!1);if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return void i.getTdou(!1);var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),void i.pay(!1)):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),void i.bindMainUIEvents())},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){e.confirmCount($(this).tbattr("checked")?30:0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?void o.viewUtil.OpenLoginDialog():void o.viewUtil.displayPaymentError(t?t:"\u672A\u77E5\u9519\u8BEF")}}}});_.Module.define({path:"puser/widget/celebrity_forum_dialog",requires:["tbmall/widget/forumMemberDialog"],sub:{initial:function(i){this._params=i,this._user=PageData.user,this._bindEvents()},_bindEvents:function(){var i=this._params.$root,s=this;i.on("click",function(){if(!s._user.is_login)return void s.requireInstanceAsync("pcommon/widget/LoginDialog");var i=$(this).data("forumid")||s._params.forumId||PageData.forum.id;$.post("/celebrity/submit/getForumSupport",{forum_id:i,tbs:PageData.tbs},function(i){if(i.data&&i.data.length>0){var e=s.formatForumSupportData(i.data[0]);s._showDialog(e)}})})},formatForumSupportData:function(i){var s,e=i.npc_info.level_id;return s=3>=e?"1":e>3&&5>=e?"2":e>5&&7>=e?"2_1":e>7&&9>=e?"2_2":e>9&&11>=e?"3":e>11&&13>=e?"3_1":e>13&&15>=e?"3_2":"4",i.npc_info.lvStyle=s,i},_showDialog:function(i){var s='<!-- htmlcs-disable --> <div class="celebrity_forum_dialog_wrap">  <div class="dialog_content">   <div class="dialog_left">    <div class="npc_info">     <a href="/celebrity/rankHome" target="_blank">     <img src="http://himg.baidu.com/sys/portraitm/item/<%=npc_info.npc_avatar%>" width="140" height="140" />     </a>     <div class="user_level">      <p class="uname">       <i class="icon-vip2-18"></i>       <a href="/celebrity/rankHome" target="_blank"><%=npc_info.npc_name%></a>       <i class="icon_red"></i>      </p>      <a href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank" title="\u672C\u5427\u5934\u8854<%=npc_info.level_id%>\u7EA7\uFF0C\u7ECF\u9A8C\u503C<%=npc_info.cur_score%>\uFF0C\u70B9\u51FB\u8FDB\u5165\u672C\u5427\u5934\u8854\u8BF4\u660E\u9875" class="badge_f badge badge_lv<%=npc_info.lvStyle%>">       <div class="badge_name"><%=npc_info.level_name%></div>       <div class="badge_index"><%=npc_info.level_id%></div>      </a>      <div class="exp">       <div class="exp_lable">\u7ECF\u9A8C\uFF1A</div>       <a class="exp_bar exp_bar_f" href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank">        <div class="exp_bar_current exp_bar_current_f" style="width:<%=(npc_info.cur_score * 100) / (npc_info.cur_score + npc_info.score_left)%>%;"></div>        <div class="exp_num">         <span class="exp_current_num"><%=npc_info.cur_score%></span>         <span>/<%=npc_info.cur_score + npc_info.score_left%></span>        </div>       </a>      </div>      <p>\u540D\u4EBA\u699C\u6392\u540D\uFF1A<span class="red_text"><%=npc_info.npc_rank%></span></p>      <p><a href="/celebrity/rankHome" target="_blank">\u67E5\u770B\u540D\u4EBA\u699C>></a></p>     </div>    </div>    <div class="npc_sign_info">     <div class="info_top">      \u52A9\u653B\u8BE6\u60C5     </div>     <div class="info_content">      <p class="today">\u4ECA\u65E5\u52A9\u653B\u4EBA\u6570\uFF1A<b><%=npc_info.total_person%></b></p>      <div class="detail">       <div class="col2_left">        <p class="my-orange-text"><%=user.my_continue_days%></p>        <p>\u6211\u8FDE\u7EED\u52A9\u653B</p>       </div>       <div class="col2_right">        <p class="my-orange-text"><%=user.my_total_days%></p>        <p>\u6211\u7D2F\u79EF\u52A9\u653B</p>       </div>      </div>     </div>    </div>    <div class="npc_sign">     <a href="javascript:;" data-forumid="<%=npc_info.npc_forum_id%>" data-npcid="<%=npc_info.npc_id%>" class="sign_btn j_sign_btn <% if (user.is_signed) { %> disable <% } %>"><% if (user.is_signed) { %>\u4ECA\u65E5\u5DF2\u52A9\u653B<% } else { %>\u70B9\u6211\u52A9\u653B<% } %></a>    </div>   </div>   <div class="dialog_right">    <div class="scroll_wrapper">    <ul>     <% for (var i = 0, l = props.length; i < l; i++) { %>     <li class="npc_prop_item">      <div class="item_pic">       <img src="<%=props[i].logo_picurl%>" width="70" height="70" />       <% if (props[i].is_unlock == 0) { %>        <div class="lock" style="height: <%=100 - props[i].lock_npc_percent %>%"></div>        <div class="lock_num">        <% if (props[i].lock_npc_percent == 0) { %>         <i class="icon_lock"></i>        <% } else { %>         <%= props[i].lock_npc_percent %>%        <% } %>        </div>       <% } %>      </div>      <div class="item_intro">        <h4><%=props[i].title%></h4>        <p class="title-sub-text">\u89E3\u9501\u6761\u4EF6\uFF1A         <%=npc_info[\'npc_name\']%>\u8D26\u53F7\u8FBE\u5230<b><%=props[i].lock_npc_level%></b>\u7EA7</p>        <p class="title-sub-text">\u9886\u53D6\u6761\u4EF6\uFF1A        <% if (props[i].props_category == 300) { %>         \u6BCF\u5929\u53EF\u4F7F\u75281\u6B21\uFF0C\u672C\u5427\u4F1A\u5458\u4F7F\u7528\u6B21\u6570\u4E0D\u9650        <% } else { %>         <% if (props[i].limit_sign_level == 0 && props[i].lock_need_vip == 0) { %>          \u65E0         <% }         if (props[i].limit_sign_level > 0) { %>          <%=npc_info[\'npc_fans_name\']%>\u8FDE\u7EED\u52A9\u653B<b><%=props[i].limit_sign_level%></b>\u6B21         <% }          if ( props[i].lock_need_vip == 1 ) {            if (props[i].limit_sign_level > 0) {%>\uFF0C<% } %>          <span class="red_text">\u672C\u5427\u4F1A\u5458\u4E13\u5C5E</span>         <% }         }        %>       </p>      </div>      <div class="item_action">       <% if (props[i].is_unlock == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u89E3\u9501</button>       <% } else if (props[i].can_get == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u9886\u53D6</button>       <% } else if (props[i].is_used == 0) { %>        <button class="btn_default btn_middle j_btn_get" data-propsid="<%=props[i].props_id%>">&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;</button>       <% } else if (props[i].props_category == 200 || props[i].props_category == 113 || props[i].props_category == 300) { %>        <button class="btn_sub btn_middle btn_disable" data-propsid="<%=props[i].props_id%>">\u5DF2\u83B7\u5F97</button>       <% } else { %>        <button class="btn_sub btn_middle j_btn_unuse" data-propsid="<%=props[i].props_id%>">\u53D6\u6D88\u4F7F\u7528</button>       <% } %>       </div>     </li>     <% } %>    </ul>    </div>    <div class="privilege-wrapper">     <p class="title-sub-text">\u5151\u6362\u672C\u5427\u4F1A\u5458\uFF0C\u4EAB\u53D7\u66F4\u591A\u7279\u6743</p>     <div class="privilege-container">      <div class="privilege-item">       <i class="privilege-crown privilege-icon"></i>       <br>       <span>\u7687\u51A0\u8EAB\u4EFD</span>      </div>      <div class="privilege-item">       <i class="privilege-red-name privilege-icon"></i>       <br>       <span>\u663E\u793A\u7EA2\u540D</span>      </div>      <div class="privilege-item">       <i class="privilege-sign privilege-icon"></i>       <br>       <span>\u7B7E\u5230\u516D\u500D\u7ECF\u9A8C</span>      </div>      <div class="privilege-item">       <i class="privilege-red-title privilege-icon"></i>       <br>       <span>\u53D1\u8D34\u7EA2\u8272\u6807\u9898</span>      </div>      <div class="privilege-item">       <i class="privilege-mark privilege-icon"></i>       <br>       <span>\u672C\u5427\u4E13\u5C5E\u5370\u8BB0</span>      </div>      <div class="privilege-item">       <i class="privilege-card-bg privilege-icon"></i>       <br>       <span>\u5236\u5B9A\u540D\u7247\u80CC\u666F</span>      </div>      <div class="privilege-item">       <i class="privilege-top-thread privilege-icon"></i>       <br>       <span>\u9E23\u4EBA\u81EA\u52A8\u9876\u8D34</span>      </div>      <div class="privilege-item">       <i class="privilege-head-border privilege-icon"></i>       <br>       <span>\u5236\u5B9A\u5934\u50CF\u8FB9\u6846</span>      </div>     </div>    </div>   </div>  </div>  <div class="dialog_footer">   <p>    \u666E\u901A\u7B7E\u5230,\u672C\u5427\u7ECF\u9A8C<span class="my-orange-text">+1</span>,    <%=npc_info[\'npc_name\']%>\u7ECF\u9A8C<span class="my-orange-text">+0.1</span>    &nbsp;&nbsp;    <%=npc_info[\'npc_fans_name\']%>\u4F1A\u5458\u52A9\u653B,\u672C\u5427\u7ECF\u9A8C<span class="my-orange-text">+2</span>,    <%=npc_info[\'npc_name\']%>\u7ECF\u9A8C<span class="my-orange-text">+1</span>    &nbsp;&nbsp;    <a class="btn_default btn_small j_buy_npc_member" data-fid="<%=npc_info[\'npc_forum_id\']%>" data-fname="<%=npc_info[\'npc_forum_name\']%>" href="javascript:;">\u5151\u6362\u672C\u5427\u4F1A\u5458</a>    <button class="btn-sub btn-small hide-privilege">\u6536\u8D77\u4F1A\u5458\u529F\u80FD<i class="triangle-down"></i></button>    <button class="btn-sub btn-small show-privilege">\u67E5\u770B\u4F1A\u5458\u529F\u80FD<i class="triangle-up"></i></button>   </p>  </div> </div>',e=baidu.template(s,i),a=i.npc_info||{};this._dialog=new $.dialog({holderClassName:"celebrity_forum_dialog",html:e,width:745,height:526,title:"\u52A0\u5165"+a.npc_fans_name+",\u53C2\u52A0"+a.npc_forum_name+'\u517B\u6210\u8BA1\u5212<span class="title-sub-text">\uFF08\u60A8\u7684\u5355\u5427\u4F1A\u5458\u8FD8\u6709<span class="red-text">'+this._params.memberLastDays+"</span>\u5929\u5230\u671F\uFF09</span>",draggable:!1}),this._bindDialogEvents(this._dialog)},_bindDialogEvents:function(i){var s=this,e=$(i.element);e.find(".j_sign_btn").on("click",function(){if(!$(this).hasClass("disable")){var i=$(this).data("npcid"),e=$(this).data("forumid");$.post("/celebrity/submit/support",{forum_id:e,npc_id:i,tbs:PageData.tbs},function(i){switch(i.no){case 0:s._dialog.close();var e=s.formatForumSupportData(i.data);s._showDialog(e);break;case 340027:$.dialog.alert("\u5F88\u62B1\u6B49\uFF0C\u5C01\u7981\u7528\u6237\u65E0\u6CD5\u52A9\u653B",{title:"\u63D0\u793A"});break;default:$.dialog.alert("\u62BD\u98CE\u4E86~",{title:"\u63D0\u793A"})}})}}),e.find(".j_buy_npc_member").on("click",function(){var i=$(this).data("fid"),e=$(this).data("fname"),a={scores_money:0,scores_other:0};s.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:i,current_forum_name:e,scores:s._user.Parr_scores?s._user.Parr_scores:a,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}}),s._dialog.close()}),e.on("click",".j_btn_get",function(){var i=this,s=$(this).data("propsid");$.post("/celebrity/submit/getNpcProps",{props_id:s,tbs:PageData.tbs},function(s){0==s.no?200==s.data.props_category||300==s.data.props_category||113==s.data.props_category?$(i).text("\u5DF2\u83B7\u5F97").tbattr("class","btn_sub btn_middle btn_disable"):$(i).text("\u53D6\u6D88\u4F7F\u7528").tbattr("class","btn_sub btn_middle j_btn_unuse"):$.dialog.alert("\u62BD\u98CE\u4E86")})}),e.on("click",".j_btn_unuse",function(){var i=this,s=$(this).data("propsid");$.post("/tbmall/post/closeProps",{props_id:s,tbs:PageData.tbs},function(s){0==s.no?$(i).html("&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;").tbattr("class","btn_default btn_middle j_btn_get"):$.dialog.alert("\u62BD\u98CE\u4E86")})});var a=e.find(".hide-privilege"),n=e.find(".show-privilege"),t=e.find(".privilege-wrapper");e.on("click",".hide-privilege",function(){a.hide(),n.show(),t.hide()}),e.on("click",".show-privilege",function(){a.show(),n.hide(),t.show()})}}});window._.Module.define({path:"encourage/widget/util",requires:["common/widget/LoginDialog"],sub:{tbs:null,Dialog:null,pageData:null,user:null,bt:window.baidu.template,initial:function(){this.pageData=window.PageData||{},this.tbs=this.pageData.tbs,this.user=this.pageData.user||{},this.Dialog=$.dialog},fine:function(e,t,a){var r,n,i;if(1===arguments.length){for(r in e)e.hasOwnProperty(r)&&r.indexOf("$")>-1&&(e[r.replace(/\$/g,"_")]=e[r],delete e[r]);return e}if(2===arguments.length){for(n=t.split("."),i=e,r=0;r<n.length;r++){if(t=n[r],!(i&&i.hasOwnProperty&&i.hasOwnProperty(t))){i=void 0;break}i=i[t]}return i}if(3===arguments.length){if(-1===t.indexOf("."))e[t]=a;else{n=t.split(".");var s=n.length-1;for(i=e,r=0;s>r;r++)i[n[r]]=i[n[r]]||{},i=i[n[r]];i[n[n.length-1]]=a}return e}},trimTpl:function(e){return e.replace(/^ "|" $/g,"")},parseTpl:function(e){return this.bt(this.trimTpl(e))},pad:function(e,t,a,r){if(e=String(e),t=+t||2,a=String(a||"0"),r=r||"L",e.length>=t)return e;for(var n="",i=0;t>i;i+=a.length)n+=a;var s=n.substr(0,t-e.length);return"L"===r?s+e:e+s},ucfirst:function(e){return e=String(e),e[0].toUpperCase()+e.substr(1)},checkLogin:function(e,t){return!t&&this.user.is_login?!0:(e&&this.requireInstance("common/widget/LoginDialog",["","userBar"]),!1)},formatTime:function(e,t){t=String(t||""),e=parseInt(e||0,10);var a,r,n=new Date(e),i=n.getFullYear(),s=n.getMonth()+1,g=n.getDate(),u=n.getHours(),l=n.getMinutes(),o=n.getSeconds(),c=n.getMilliseconds(),h=i,f=this.pad(s),p=this.pad(g),d=this.pad(u),b=this.pad(l),k=this.pad(o),w=this.pad(c,3);return t.replace(/[a-z\\A-Z]+/g,function(e){for(r="",a=0;a<e.length;a++)if("\\"!==e[a])switch(e[a]){case"Y":r+=h;break;case"y":r+=i;break;case"M":r+=f;break;case"m":r+=s;break;case"D":r+=p;break;case"d":r+=g;break;case"H":r+=d;break;case"h":r+=u;break;case"I":r+=b;break;case"i":r+=l;break;case"S":r+=k;break;case"s":r+=o;break;case"F":r+=w;break;case"f":r+=c;break;default:r+=e[a]}else a<e.length-1&&(r+=e[a+1]),a+=1;return r})}}});_.Module.define({path:"tbmall/component/NetProxy",requires:["tbmall/widget/TbeanSafeAjax"],sub:{_buyPropUrl:"/tbmall/post/buyprops",_mBuyPropUrl:"/tbmall/post/mbuyprops",_usePropUrl:"/tbmall/post/openProps",_mUsePropUrl:"/tbmall/post/mopenProps",_cancelPropUrl:"/tbmall/post/closeProps",initial:function(){},buyProp:function(t,o){var r=this;t.tbs=PageData.tbs;var s=this.requireInstance("tbmall/widget/TbeanSafeAjax");s.post(r._buyPropUrl,t,o)},mBuyProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mBuyPropUrl,t,o)},useProp:function(t,o){var r=this;$.tb.post(r._usePropUrl,{props_id:t,tbs:PageData.tbs},o)},mUseProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mUsePropUrl,t,o)},cancelProp:function(t,o){var r=this;$.tb.post(r._cancelPropUrl,{props_id:t,tbs:PageData.tbs},o)}}});